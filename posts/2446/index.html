<!DOCTYPE html>
<html>
    <head><!-- hexo injector head_begin start --><script src="https://cdn.jsdelivr.net/npm/echarts@5.5.1/dist/echarts.min.js"></script><!-- hexo injector head_begin end -->
        <!-- å…ƒæ•°æ® -->
        <meta charset="utf-8">
        <meta name="author" content="GoDm@">
        <meta name="Description" content="GoDm@'s blog">
        <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1.0,user-scalable=no">
        <title>GoDm@'s blog</title>

        <link rel="stylesheet" href="/css/layout.css">

        <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.11.1/build/styles/obsidian.css">
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.11.1/build/highlight.min.js"></script>
        <script> hljs.highlightAll();</script> -->

        <link href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism-solarizedlight.min.css" rel="stylesheet" />
        <link href="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.css" rel="stylesheet" />
        <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <!-- hexo injector head_end start --><style>/* å¸ƒå±€æ ·å¼ */
.hexo-tips-layout {
    margin: 1.5rem 0;
    padding: 1.2rem 1.5rem;
    border-radius: 8px;
    border: 1px solid;
    border-left-width: 6px;
    display: flex;
    align-items: center;
    transition: transform 0.3s ease;
}

.hexo-tips-layout:hover {
    transform: translateX(5px);
}

.hexo-tips-layout .icon {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 1rem;
    font-size: clamp(2em, 2vw, 3em);
    min-width: 2rem;
    transition: transform 0.3s ease;
}

.hexo-tips-layout:hover .icon {
    transform: scale(1.1);
}

.hexo-tips-layout .content {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    transition: transform 0.3s ease;
}

.hexo-tips-layout:hover .content {
    transform: translateX(3px);
}

/* å“åº”å¼è°ƒæ•´ */
@media screen and (max-width: 768px) {
    .hexo-tips-layout {
        padding: 1rem;
    }
}

/* ä¸ºæ¯ç§ç±»å‹çš„æç¤ºæ¡†æ·»åŠ ä¸»é¢˜æ ·å¼ */
[class^="tips-style-"] {
    --tips-light-bg: #fff; /* é»˜è®¤å€¼ */
    --tips-dark-bg: #333;  /* é»˜è®¤å€¼ */
    --tips-border: #000;   /* é»˜è®¤å€¼ */
}

/* ä¸»é¢˜æ ·å¼è§„åˆ™ */
[class^="hexo-tips-"] {
    border-color: var(--tips-border);
}

[class^="hexo-tips-"] .icon {
    color: var(--tips-border);
}

</style><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="GoDm@'s Blog" type="application/atom+xml">
</head>

    <body>
        <h1 id="WebTitle" style="text-align: center;">GoDm@'s Blog</h1>
        <!--æ–‡ç« è¯¦æƒ…é¡µ-->
<div class="meta" style="margin: auto;">
    <h1 style="text-align: center;">è®°å½•æ­å»ºä¸€å°äº‘æœåŠ¡å™¨ç¯å¢ƒçš„è¿‡ç¨‹</h1>
</div>

<div class="a_container">
    <div id="article">
        <details>
<summary>ç‰ˆæƒä¿¡æ¯</summary>
<div class="admonition warning"><p class="admonition-title">warning</p><p>æœ¬æ–‡ç« ä¸ºåšä¸»åŸåˆ›æ–‡ç« ã€‚éµå¾ª <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh-hans">CC 4.0 BY-SA</a> ç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥å’Œæœ¬å£°æ˜ã€‚</p>
</div>
</details>
<hr />
<ul>
<li><a href="#1-%E5%89%8D%E8%A8%80">1. å‰è¨€</a></li>
<li><a href="#2-%E6%93%8D%E4%BD%9C%E4%B9%A0%E6%83%AF%E9%83%A8%E5%88%86">2. æ“ä½œä¹ æƒ¯éƒ¨åˆ†</a>
<ul>
<li><a href="#21-%E4%BF%AE%E6%94%B9%E4%B8%BB%E6%9C%BA%E5%90%8D">2.1. ä¿®æ”¹ä¸»æœºå</a></li>
<li><a href="#22-%E9%85%8D%E7%BD%AE%E6%97%B6%E5%8C%BA">2.2. é…ç½®æ—¶åŒº</a></li>
</ul>
</li>
<li><a href="#3-%E5%AE%89%E5%85%A8%E9%83%A8%E5%88%86">3. ğŸ”å®‰å…¨éƒ¨åˆ†</a>
<ul>
<li><a href="#31-%E9%87%8D%E6%96%B0%E8%AE%BE%E7%BD%AEroot%E5%AF%86%E7%A0%81%E4%B8%BA%E5%BC%BA%E5%AF%86%E7%A0%81">3.1. é‡æ–°è®¾ç½®rootå¯†ç ä¸ºå¼ºå¯†ç </a></li>
<li><a href="#32-%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7%E5%B9%B6%E8%AE%BE%E7%BD%AE%E5%BC%BA%E5%AF%86%E7%A0%81">3.2. æ·»åŠ ç”¨æˆ·å¹¶è®¾ç½®å¼ºå¯†ç </a></li>
<li><a href="#33-%E7%B3%BB%E7%BB%9F%E5%8D%87%E7%BA%A7">3.3. ç³»ç»Ÿå‡çº§</a></li>
<li><a href="#34-%E4%BD%BF%E7%94%A8ssh-key%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95%E8%80%8C%E4%B8%8D%E6%98%AF%E5%AF%86%E7%A0%81">3.4. ä½¿ç”¨SSH Keyè¿œç¨‹ç™»å½•è€Œä¸æ˜¯å¯†ç </a>
<ul>
<li><a href="#341-%E5%9C%A8%E6%9C%AC%E5%9C%B0%E7%94%B5%E8%84%91%E4%B8%8A%E7%94%9F%E6%88%90%E5%AF%86%E5%8C%99%E5%AF%B9">3.4.1. åœ¨æœ¬åœ°ç”µè„‘ä¸Šç”Ÿæˆå¯†åŒ™å¯¹ï¼š</a></li>
<li><a href="#342-%E5%88%9B%E5%BB%BAconfig%E6%96%87%E4%BB%B6">3.4.2. åˆ›å»ºconfigæ–‡ä»¶</a></li>
<li><a href="#343-%E5%A4%8D%E5%88%B6%E5%85%AC%E5%8C%99%E5%88%B0%E6%9C%8D%E5%8A%A1%E5%99%A8">3.4.3. å¤åˆ¶å…¬åŒ™åˆ°æœåŠ¡å™¨</a></li>
<li><a href="#344-%E7%99%BB%E5%BD%95">3.4.4. ç™»å½•</a></li>
</ul>
</li>
<li><a href="#35-%E6%94%B9ssh%E7%AB%AF%E5%8F%A3%E9%85%8D%E7%BD%AE%E9%98%B2%E7%81%AB%E5%A2%99">3.5. æ”¹sshç«¯å£&amp;é…ç½®é˜²ç«å¢™</a>
<ul>
<li><a href="#351-%E5%88%9D%E6%AD%A5%E9%85%8D%E7%BD%AE">3.5.1. åˆæ­¥é…ç½®</a></li>
<li><a href="#352-%E6%94%B9ssh%E7%AB%AF%E5%8F%A3">3.5.2. æ”¹SSHç«¯å£</a></li>
<li><a href="#353-%E5%85%B3%E9%97%AD22%E7%AB%AF%E5%8F%A3">3.5.3. å…³é—­22ç«¯å£</a></li>
</ul>
</li>
<li><a href="#36-ssh%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">3.6. sshé…ç½®æ–‡ä»¶</a>
<ul>
<li><a href="#361-%E7%A6%81%E7%94%A8-root%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95%E5%AF%86%E7%A0%81%E7%99%BB%E5%BD%95">3.6.1. ç¦ç”¨ rootè¿œç¨‹ç™»å½•&amp;å¯†ç ç™»å½•</a></li>
<li><a href="#362-%E4%BD%BF%E7%94%A8ssh2">3.6.2. ä½¿ç”¨SSH2</a></li>
<li><a href="#363-%E9%87%8D%E5%90%AFssh">3.6.3. é‡å¯ssh</a></li>
</ul>
</li>
<li><a href="#37-fail2ban%E5%B7%A5%E5%85%B7%E9%98%B2%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3">3.7. Fail2banå·¥å…·é˜²æš´åŠ›ç ´è§£</a>
<ul>
<li><a href="#371-%E9%85%8D%E7%BD%AEfail2ban">3.7.1. é…ç½®fail2ban</a></li>
<li><a href="#372-%E6%9F%A5%E7%9C%8B%E7%8A%B6%E6%80%81">3.7.2. æŸ¥çœ‹çŠ¶æ€</a></li>
<li><a href="#373-%E8%A7%A3%E5%B0%81ip">3.7.3. è§£å°ip</a></li>
<li><a href="#374-%E5%90%AF%E7%94%A8fail2ban">3.7.4. å¯ç”¨fail2ban</a></li>
<li><a href="#375-%E5%B0%8F%E8%B4%B4%E5%A3%AB">3.7.5. å°è´´å£«</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#4-%E7%B3%BB%E7%BB%9F%E7%BB%B4%E6%8A%A4%E9%83%A8%E5%88%86">4. ç³»ç»Ÿç»´æŠ¤éƒ¨åˆ†</a>
<ul>
<li><a href="#41-%E4%BD%BF%E7%94%A8expkg">4.1. <s>ä½¿ç”¨expkg</s></a></li>
</ul>
</li>
<li><a href="#5-%E7%B3%BB%E7%BB%9F%E8%BF%90%E8%A1%8C%E9%83%A8%E5%88%86">5. ç³»ç»Ÿè¿è¡Œéƒ¨åˆ†</a></li>
</ul>
<h2 id="1-å‰è¨€"><a class="markdownIt-Anchor" href="#1-å‰è¨€"></a> 1. å‰è¨€</h2>
<p>å‰å‡ å¤©åœ¨ä¸ƒç‰›äº‘ç§Ÿäº†ä¸€å°è½»é‡åº”ç”¨çº§æœåŠ¡å™¨ï¼Œ2c4gbï¼Œè¶³å¤Ÿæ»¡è¶³ç©å…·çš„éœ€æ±‚äº†ã€‚ç¬¬ä¸€æ¬¡ç©æœåŠ¡å™¨ï¼Œç°åœ¨æŠŠè‡ªå·±çš„æ­å»ºç¯å¢ƒçš„è¿‡ç¨‹è®°å½•ä¸€ä¸‹ï¼Œæ–¹ä¾¿æ—¥åæ“ä½œã€‚</p>
<p>äº‘æœåŠ¡å™¨ç³»ç»Ÿï¼šUbuntu 24.04 LTS<br />
äº‘æœåŠ¡å™¨å‚å•†ï¼šä¸ƒç‰›äº‘<br />
äº‘æœåŠ¡å™¨è§„æ ¼ï¼šè½»é‡å‹ T1 2C4GB CPUå‹</p>
<h2 id="2-æ“ä½œä¹ æƒ¯éƒ¨åˆ†"><a class="markdownIt-Anchor" href="#2-æ“ä½œä¹ æƒ¯éƒ¨åˆ†"></a> 2. æ“ä½œä¹ æƒ¯éƒ¨åˆ†</h2>
<h3 id="21-ä¿®æ”¹ä¸»æœºå"><a class="markdownIt-Anchor" href="#21-ä¿®æ”¹ä¸»æœºå"></a> 2.1. ä¿®æ”¹ä¸»æœºå</h3>
<p>sshç™»å½•åˆ°æœåŠ¡å™¨åï¼Œå‘ç°ä¸»æœºåæ˜¯ä¸€å¨ä¹±ç ï¼Œçœ‹ç€å¤ªéš¾å—äº†ï¼Œå¿…é¡»æ”¹äº†ã€‚<br />
<img src="Snipaste_2025-10-14_14-17-13.png" alt="" /></p>
<p>æ°¸ä¹…ä¿®æ”¹ä¸»æœºåå‘½ä»¤ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> hostnamectl set-hostname myserver<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>é‡å¯ç”Ÿæ•ˆã€‚</p>
<h3 id="22-é…ç½®æ—¶åŒº"><a class="markdownIt-Anchor" href="#22-é…ç½®æ—¶åŒº"></a> 2.2. é…ç½®æ—¶åŒº</h3>
<p>è¾“å…¥ <code>date</code> å‘½ä»¤ï¼Œå‘ç°æœåŠ¡å™¨ä½¿ç”¨çš„ä¸–ç•Œåè°ƒæ—¶ï¼ˆUTCï¼‰ï¼Œæ”¹ä¸ºä¸­å›½æ ‡å‡†æ—¶ï¼ˆUTC+8ï¼‰ï¼Œç¬¦åˆä¹ æƒ¯ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> timedatectl set-timezone Asia/Shanghai<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>è¿è¡Œåï¼Œä½¿ç”¨  <code>timedatectl</code> å‘½ä»¤ç¡®è®¤æ˜¯å¦ä¿®æ”¹æˆåŠŸï¼Œå¹¶æŸ¥çœ‹ <code>NTP service</code> æ˜¯å¦å¯ç”¨ï¼Œè¿™æ˜¯è‡ªåŠ¨åŒæ­¥ç½‘ç»œæ—¶é—´ï¼Œå¯ä¿æŒæ—¶é—´ç²¾å‡†ã€‚è‹¥æœªå¯ç”¨åˆ™éœ€æŸ¥è¯¢ç›¸å…³æ•™ç¨‹å¯ç”¨ã€‚</p>
<h2 id="3-å®‰å…¨éƒ¨åˆ†"><a class="markdownIt-Anchor" href="#3-å®‰å…¨éƒ¨åˆ†"></a> 3. ğŸ”å®‰å…¨éƒ¨åˆ†</h2>
<p>æ­¤éƒ¨åˆ†éœ€æ ¼å¤–é‡è§†ï¼</p>
<h3 id="31-é‡æ–°è®¾ç½®rootå¯†ç ä¸ºå¼ºå¯†ç "><a class="markdownIt-Anchor" href="#31-é‡æ–°è®¾ç½®rootå¯†ç ä¸ºå¼ºå¯†ç "></a> 3.1. é‡æ–°è®¾ç½®rootå¯†ç ä¸ºå¼ºå¯†ç </h3>
<p>ä¸ç”¨å¤šè¯´ï¼Œ<code>passwd</code> å‘½ä»¤å³å¯ã€‚</p>
<h3 id="32-æ·»åŠ ç”¨æˆ·å¹¶è®¾ç½®å¼ºå¯†ç "><a class="markdownIt-Anchor" href="#32-æ·»åŠ ç”¨æˆ·å¹¶è®¾ç½®å¼ºå¯†ç "></a> 3.2. æ·»åŠ ç”¨æˆ·å¹¶è®¾ç½®å¼ºå¯†ç </h3>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">adduser yourname<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æ·»åŠ åˆ°sudoç»„ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">usermod</span> <span class="token parameter variable">-aG</span> <span class="token function">sudo</span> yourname<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æŸ¥çœ‹ç”¨æˆ·ç»„ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> /etc/group<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æŸ¥çœ‹å½“å‰ç”¨æˆ·æ‰€å±ç»„ï¼š<code>groups</code>å‘½ä»¤ã€‚</p>
<blockquote>
<p>è®¾ç½®å®Œæˆåï¼Œé€€å‡ºrootç”¨æˆ·ç™»å½•ï¼Œç”¨SSHä»¥æ™®é€šç”¨æˆ·é‡æ–°ç™»å½•åˆ°æœåŠ¡å™¨ã€‚</p>
</blockquote>
<h3 id="33-ç³»ç»Ÿå‡çº§"><a class="markdownIt-Anchor" href="#33-ç³»ç»Ÿå‡çº§"></a> 3.3. ç³»ç»Ÿå‡çº§</h3>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> upgrade<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="34-ä½¿ç”¨ssh-keyè¿œç¨‹ç™»å½•è€Œä¸æ˜¯å¯†ç "><a class="markdownIt-Anchor" href="#34-ä½¿ç”¨ssh-keyè¿œç¨‹ç™»å½•è€Œä¸æ˜¯å¯†ç "></a> 3.4. ä½¿ç”¨SSH Keyè¿œç¨‹ç™»å½•è€Œä¸æ˜¯å¯†ç </h3>
<p>SSH Key ç™»å½•æ¯”å¯†ç å®‰å…¨å¾ˆå¤šï¼Œå‡ ä¹æ— æ³•ç ´è§£ã€‚æœ¬è´¨å°±æ˜¯è®©æœåŠ¡å™¨è¯†åˆ«ä½ çš„ç”µè„‘ï¼Œåªæœ‰ä½ çš„ç”µè„‘æ‰èƒ½ç™»å½•åˆ°æœåŠ¡å™¨ã€‚</p>
<h4 id="341-åœ¨æœ¬åœ°ç”µè„‘ä¸Šç”Ÿæˆå¯†åŒ™å¯¹"><a class="markdownIt-Anchor" href="#341-åœ¨æœ¬åœ°ç”µè„‘ä¸Šç”Ÿæˆå¯†åŒ™å¯¹"></a> 3.4.1. åœ¨æœ¬åœ°ç”µè„‘ä¸Šç”Ÿæˆå¯†åŒ™å¯¹ï¼š</h4>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ssh-keygen <span class="token parameter variable">-t</span> rsa <span class="token parameter variable">-b</span> <span class="token number">4096</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li><code>-t</code>ï¼šæŒ‡å®šå¯†åŒ™ç±»å‹ï¼Œrsaæ˜¯ç»å…¸ç®—æ³•ï¼Œå…¼å®¹æ€§å¥½ã€‚</li>
<li><code>-b</code>ï¼šæŒ‡å®šå¯†åŒ™é•¿åº¦ä¸º4096ä½ã€‚</li>
</ul>
<p>å®ƒä¼šæç¤ºä½ å‡ ä¸ªé—®é¢˜ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">Generating public&#x2F;private rsa key pair. Enter file in which to save the key (&#x2F;home&#x2F;yourname&#x2F;.ssh&#x2F;id_rsa):<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>è¿™æ—¶å€™ï¼š</p>
<ul>
<li><strong>ç›´æ¥å›è½¦</strong> å°±ä¼šæŠŠå¯†é’¥ç”Ÿæˆåœ¨é»˜è®¤ä½ç½®ï¼š
<ul>
<li>ç§é’¥ï¼š<code>~/.ssh/id_rsa</code> ï¼Œ<strong>ç»å¯¹ä¸èƒ½æ³„éœ²ï¼</strong></li>
<li>å…¬é’¥ï¼š`~/.ssh/id_rsa.pub</li>
</ul>
</li>
<li><strong>æˆ–è€…</strong>æŒ‡å®šä½ç½®åŠæ–‡ä»¶åã€‚<br />
æ¥ç€ä¼šæç¤ºï¼š</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">Enter passphrase (empty for no passphrase):<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>è¿™é‡Œä½ å¯ä»¥é€‰æ‹©ï¼š</p>
<ul>
<li><strong>ç›´æ¥å›è½¦</strong>ï¼šä¸è®¾ç½®å¯†ç ï¼Œç™»å½•æ›´æ–¹ä¾¿ï¼›</li>
<li><strong>è¾“å…¥å¯†ç çŸ­è¯­</strong>ï¼šå¤šä¸€å±‚ä¿æŠ¤ï¼ˆæ¯æ¬¡ç”¨ç§é’¥ç™»å½•éƒ½è¦è¾“å…¥è¿™ä¸²å¯†ç ï¼‰ã€‚</li>
</ul>
<h4 id="342-åˆ›å»ºconfigæ–‡ä»¶"><a class="markdownIt-Anchor" href="#342-åˆ›å»ºconfigæ–‡ä»¶"></a> 3.4.2. åˆ›å»ºconfigæ–‡ä»¶</h4>
<p>æœ‰æ—¶ï¼Œæˆ‘ä»¬ä¸åªæœ‰ä¸€ä¸ªsshå¯†åŒ™å¯¹ï¼Œæ¯”å¦‚æˆ‘ä¸ºgithubç”Ÿæˆäº†ä¸€ä¸ªå¯†åŒ™å¯¹ï¼Œä¹Ÿç»™æœåŠ¡å™¨ç”Ÿæˆäº†ä¸€ä¸ªã€‚å¦‚æœä½¿ç”¨äº†éé»˜è®¤åç§°çš„å¯†é’¥æ–‡ä»¶ï¼Œéœ€è¦åœ¨Â <em>~/.ssh/config</em>Â æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ã€‚</p>
<p>åœ¨æœ¬åœ°ä¿å­˜sshå¯†åŒ™å¯¹æ–‡ä»¶çš„æ–‡ä»¶å¤¹é‡Œï¼Œæ‰“å¼€æˆ–åˆ›å»ºåä¸º <code>config</code> çš„æ–‡ä»¶ï¼Œæ— éœ€åç¼€åã€‚ç¼–è¾‘è¯¥æ–‡ä»¶ï¼Œç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none"># GitHubï¼ˆå¸¸è§ï¼‰
Host github.com
  HostName github.com
  User git
  IdentityFile ~&#x2F;.ssh&#x2F;id_ed25519_github
  IdentitiesOnly yes

# æˆ‘çš„æœåŠ¡å™¨
Host myserver #ä½ çš„ä¸»æœºå
  HostName 1.2.3.4 #ä¸»æœºipåœ°å€&#x2F;åŸŸå
  User someone #ä½ è¦ç™»å½•çš„ç”¨æˆ·
  Port 22        # å¦‚æœä½ æ”¹è¿‡SSHç«¯å£å°±å†™ä¸Šï¼Œé»˜è®¤22
  IdentityFile ~&#x2F;.ssh&#x2F;id_rsa_server
  IdentitiesOnly yes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Host</code></td>
<td>è‡ªå®šä¹‰çš„åˆ«åï¼ˆå¯ä»¥éšæ„èµ·åï¼‰</td>
</tr>
<tr>
<td><code>HostName</code></td>
<td>å®é™…çš„æœåŠ¡å™¨åŸŸåæˆ– IP åœ°å€</td>
</tr>
<tr>
<td><code>User</code></td>
<td>ç™»å½•ç”¨æˆ·å</td>
</tr>
<tr>
<td><code>Port</code></td>
<td>SSH ç«¯å£ï¼ˆæ²¡æ”¹çš„è¯é»˜è®¤ 22ï¼‰</td>
</tr>
<tr>
<td><code>IdentityFile</code></td>
<td>ç§é’¥æ–‡ä»¶è·¯å¾„</td>
</tr>
<tr>
<td><code>IdentitiesOnly yes</code></td>
<td>åªä½¿ç”¨æŒ‡å®šçš„ç§é’¥ï¼Œé¿å…è‡ªåŠ¨å°è¯•å…¶ä»– key å¯¼è‡´æ‹’ç»</td>
</tr>
</tbody>
</table>
<h4 id="343-å¤åˆ¶å…¬åŒ™åˆ°æœåŠ¡å™¨"><a class="markdownIt-Anchor" href="#343-å¤åˆ¶å…¬åŒ™åˆ°æœåŠ¡å™¨"></a> 3.4.3. å¤åˆ¶å…¬åŒ™åˆ°æœåŠ¡å™¨</h4>
<p>æ–¹å¼1</p>
<hr />
<p>åœ¨æœåŠ¡å™¨åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ä¿å­˜sshå…¬åŒ™ï¼ŒæœåŠ¡å™¨ç”¨å®ƒæ¥è¯†åˆ«è¿œç¨‹ç™»å½•åˆ°å®ƒçš„ç”µè„‘ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> ~/.ssh
<span class="token function">touch</span> ~/.ssh/authorized_keys
<span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">700</span> ~/.ssh
<span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">600</span> ~/.ssh/authorized_keys<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¹‹åä½¿ç”¨nanoç¼–è¾‘å™¨ï¼Œå°†æœ¬åœ°çš„.pubæ–‡ä»¶é‡Œçš„å†…å®¹å¤åˆ¶åˆ°authorized_keyså³å¯ã€‚</p>
<blockquote>
<ul>
<li><strong>åƒä¸‡åˆ«ä¸Šä¼ ç§é’¥</strong>ï¼ˆä¾‹å¦‚ <code>id_rsa</code>ã€<code>id_ed25519</code>ï¼‰ã€‚åªä¼  <code>*.pub</code>ã€‚</li>
<li><strong>æƒé™å¿…é¡»æ­£ç¡®</strong>ï¼š- ç¡®ä¿æœåŠ¡å™¨ <code>~/.ssh</code> æƒé™æ˜¯ <code>700</code>ï¼Œ<code>~/.ssh/authorized_keys</code> æƒé™æ˜¯ <code>600</code>ï¼Œå¦åˆ™ SSH ä¼šæ‹’ç»ä½¿ç”¨å¯†é’¥ã€‚</li>
<li><strong>æ¯ä¸ªå…¬é’¥ä¸€è¡Œ</strong>ï¼Œä¸è¦æ’å…¥æ¢è¡Œæˆ–ç©ºæ ¼ã€‚<code>authorized_keys</code> å¯åŒ…å«å¤šæŠŠå…¬é’¥ï¼ˆå¤šå°ç”µè„‘å¯å…±ç”¨ï¼‰ã€‚</li>
</ul>
</blockquote>
<p>æ–¹å¼2</p>
<hr />
<p>windowå¯ä½¿ç”¨gitbashã€‚linuxç›´æ¥è¾“å…¥ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ssh-copy-id <span class="token parameter variable">-i</span> ~/.ssh/id_rsa_server.pub root@SERVER_IP<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li><code>-i</code> åé¢æ˜¯ä½ æœ¬åœ°çš„å…¬é’¥æ–‡ä»¶ï¼ˆæ¯”å¦‚ <code>~/.ssh/id_rsa_server.pub</code>ï¼‰ã€‚</li>
<li>è¿è¡Œä¼šæç¤ºè¾“å…¥æœåŠ¡å™¨å¯†ç ï¼Œç„¶åæŠŠå…¬é’¥è¿½åŠ åˆ°æœåŠ¡å™¨ <code>~/.ssh/authorized_keys</code>ã€‚<br />
<strong>æ³¨æ„ä¸è¦é”™ä¼ æˆç§åŒ™ï¼</strong></li>
</ul>
<hr />
<h4 id="344-ç™»å½•"><a class="markdownIt-Anchor" href="#344-ç™»å½•"></a> 3.4.4. ç™»å½•</h4>
<p>å°è¯•åœ¨æœ¬åœ°sshç™»å½•ã€‚æ­£å¸¸çš„è¯ä¸ç”¨è¾“å¯†ç å°±å¯ä»¥ç›´æ¥ç™»é™†ä¸Šï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ssh</span> Host<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="35-æ”¹sshç«¯å£é…ç½®é˜²ç«å¢™"><a class="markdownIt-Anchor" href="#35-æ”¹sshç«¯å£é…ç½®é˜²ç«å¢™"></a> 3.5. æ”¹sshç«¯å£&amp;é…ç½®é˜²ç«å¢™</h3>
<blockquote>
<p>è­¦å‘Šï¼šæ­¤æ­¥æ“ä½œéœ€è¦è°¨æ…ï¼Œè‡³å°‘ä¿ç•™ä¸€ä¸ªå·²ç™»å½•çš„sshç»ˆç«¯ï¼Œå¦åˆ™å¦‚æœæ“ä½œä¸å½“ä¼šå¯¼è‡´è¢«é”ï¼ˆæ— æ³•ç™»å½•åˆ°æœåŠ¡å™¨ï¼‰ï¼Œæ­£ç¡®é…ç½®ä¹‹å‰å…ˆä¸è¦å¯ç”¨é˜²ç«å¢™ã€‚</p>
</blockquote>
<h4 id="351-åˆæ­¥é…ç½®"><a class="markdownIt-Anchor" href="#351-åˆæ­¥é…ç½®"></a> 3.5.1. åˆæ­¥é…ç½®</h4>
<p>Ubuntu å†…ç½®äº†UFWé˜²ç«å¢™ã€‚é€šè¿‡é˜²ç«å¢™ï¼Œå°½å¯èƒ½å°‘çš„æš´éœ²ç«¯å£ï¼Œæå‡å®‰å…¨æ€§ã€‚</p>
<p>æˆ‘ä»¬é¦–å…ˆå…è®¸ä»¥ä¸‹ç«¯å£ï¼š</p>
<ul>
<li>22ç«¯å£ï¼šSSHé»˜è®¤ç«¯å£</li>
<li>80ç«¯å£ï¼šHTTPæœåŠ¡ï¼Œå¦‚æœä½ åœ¨æœåŠ¡å™¨ä¸Šæ¶ç½‘ç«™ï¼Œè¿™ä¸ªç«¯å£å¿…é¡»å¼€æ”¾ã€‚</li>
<li>443ç«¯å£ï¼šHTTPSæœåŠ¡</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> ufw default deny incoming
<span class="token function">sudo</span> ufw default allow outgoing
<span class="token function">sudo</span> ufw allow <span class="token number">22</span>/tcp    <span class="token comment"># SSHç«¯å£</span>
<span class="token function">sudo</span> ufw allow <span class="token number">80</span>/tcp      <span class="token comment"># HTTP</span>
<span class="token function">sudo</span> ufw allow <span class="token number">443</span>/tcp     <span class="token comment"># HTTPS</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>sudo ufw default deny incoming</code>ï¼šé»˜è®¤æ‹’ç»æ‰€æœ‰è¿›å…¥æœåŠ¡å™¨çš„æµé‡ï¼ˆincoming trafficï¼‰ã€‚é™¤éä½ æ˜ç¡®å…è®¸æŸä¸ªç«¯å£ï¼Œå¦åˆ™å¤–éƒ¨æ— æ³•è¿æ¥åˆ°ä½ çš„æœåŠ¡å™¨ã€‚<br />
<code>sudo ufw default allow outgoing</code>ï¼šé»˜è®¤å…è®¸æœåŠ¡å™¨å‘å‡ºçš„æ‰€æœ‰æµé‡ï¼ˆoutgoing trafficï¼‰ã€‚æœåŠ¡å™¨å¯ä»¥è‡ªç”±è®¿é—®å¤–éƒ¨ç½‘ç»œï¼ˆæ¯”å¦‚ä¸‹è½½æ›´æ–°ã€è®¿é—® API ç­‰ï¼‰ã€‚</p>
<h4 id="352-æ”¹sshç«¯å£"><a class="markdownIt-Anchor" href="#352-æ”¹sshç«¯å£"></a> 3.5.2. æ”¹SSHç«¯å£</h4>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šä¿ç•™ä¸€ä¸ªå·²ç»ç™»å½•çš„ SSH çª—å£ï¼Œå…ˆæµ‹è¯•æ–°ç«¯å£å¯ç”¨å†å…³é—­æ—§çª—å£ï¼Œé¿å…è‡ªå·±è¢«é”ã€‚</p>
</blockquote>
<p>ä¸ä½¿ç”¨é»˜è®¤SSHç«¯å£ç™»å½•ï¼Œæé«˜å®‰å…¨æ€§ã€‚</p>
<ol>
<li>ç¼–è¾‘ SSH é…ç½®ï¼š</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">nano</span> /etc/ssh/sshd_config<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æ‰¾åˆ°ï¼š<code>#Port 22</code><br />
ä¿®æ”¹ä¸ºï¼š<code>Port your_ssh_port</code></p>
<blockquote>
<p>å»ºè®® SSH æ”¹åˆ° <strong>1024 ä»¥ä¸Šï¼Œæœ€å¥½ 2000~65000 çš„èŒƒå›´</strong>ï¼Œä¾‹å¦‚ 2222ã€22022ã€55222ã€‚</p>
</blockquote>
<ol start="2">
<li>é˜²ç«å¢™å…è®¸è¯¥ç«¯å£å¹¶å¯ç”¨é˜²ç«å¢™</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> ufw allow your_ssh_port/tcp
<span class="token function">sudo</span> ufw <span class="token builtin class-name">enable</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>è¿è¡Œ <code>sudo ufw status</code> å‘½ä»¤æ£€æŸ¥é˜²ç«å¢™è§„åˆ™ã€‚<br />
åº”è¯¥æ˜¾ç¤ºï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">To                         Action      From
--                         ------      ----
22&#x2F;tcp                     ALLOW       Anywhere
80&#x2F;tcp                     ALLOW       Anywhere
443&#x2F;tcp                    ALLOW       Anywhere
your_ssh_port&#x2F;tcp          ALLOW       Anywhere
22&#x2F;tcp (v6)                ALLOW       Anywhere (v6)
80&#x2F;tcp (v6)                ALLOW       Anywhere (v6)
443&#x2F;tcp (v6)               ALLOW       Anywhere (v6)
your_ssh_port&#x2F;tcp (v6)     ALLOW       Anywhere (v6)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="3">
<li>
<p>é‡å¯ SSHï¼š<br />
<code>sudo systemctl restart ssh</code></p>
</li>
<li>
<p>æµ‹è¯•æ–°ç«¯å£ï¼š<br />
<code>ssh -p your_ssh_port root@SERVER_IP</code></p>
</li>
</ol>
<p>å¦‚æœç¬¬å››æ­¥è®¿é—®è¢«æ‹’ç»ï¼Œåˆ«æ…Œï¼Œä½¿ç”¨å‘½ä»¤ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> sshd <span class="token parameter variable">-T</span> <span class="token operator">|</span> <span class="token function">grep</span> port<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å¦‚æœè¾“å‡ºçš„æ˜¯ä½ è®¾å®šçš„ç«¯å£å·ï¼Œ<strong>ä¸”ufwä¸­å…è®¸äº†è®¾å®šç«¯å£</strong>ï¼Œé‚£ä¹ˆå¯ä»¥å¿½ç•¥ä¿ç•™sshçª—å£çš„noteï¼Œç›´æ¥é‡å¯äº‘æœåŠ¡å™¨ï¼Œé‡æ–°ä»¥æ–°ç«¯å£å·ç™»å½•ï¼Œåº”è¯¥å¯ä»¥æˆåŠŸã€‚</p>
<h4 id="353-å…³é—­22ç«¯å£"><a class="markdownIt-Anchor" href="#353-å…³é—­22ç«¯å£"></a> 3.5.3. å…³é—­22ç«¯å£</h4>
<p>æˆåŠŸç™»å½•åï¼Œå¯ä»¥å…³é—­22ç«¯å£äº†</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> ufw delete allow <span class="token number">22</span>/tcp
<span class="token function">sudo</span> ufw reload
<span class="token function">sudo</span> ufw status<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="36-sshé…ç½®æ–‡ä»¶"><a class="markdownIt-Anchor" href="#36-sshé…ç½®æ–‡ä»¶"></a> 3.6. sshé…ç½®æ–‡ä»¶</h3>
<p>ä¾æ—§ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">nano</span> /etc/ssh/sshd_config<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="361-ç¦ç”¨-rootè¿œç¨‹ç™»å½•å¯†ç ç™»å½•"><a class="markdownIt-Anchor" href="#361-ç¦ç”¨-rootè¿œç¨‹ç™»å½•å¯†ç ç™»å½•"></a> 3.6.1. ç¦ç”¨ rootè¿œç¨‹ç™»å½•&amp;å¯†ç ç™»å½•</h4>
<p>é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">PermitRootLogin no # ç¦ç”¨rootç™»å½•
PasswordAuthentication no # ç¦ç”¨å¯†ç ç™»å½•<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>å¯¹äºç¬¬äºŒä¸ªé€‰é¡¹ï¼Œè¯·è‡ªè¡Œå†³å®šã€‚è‡³äºæš´åŠ›ç ´è§£ï¼Œç”¨Fail2banå·¥å…·å¯ä»¥é˜²æš´åŠ›ç ´è§£ã€‚</p>
<table>
<thead>
<tr>
<th>é…ç½®</th>
<th>ä¼˜åŠ¿</th>
<th>é£é™©</th>
</tr>
</thead>
<tbody>
<tr>
<td>PasswordAuthentication yes</td>
<td>å¯ä»¥ç”¨å¯†ç ç™»å½•ï¼ˆçµæ´»ï¼‰</td>
<td>å®¹æ˜“è¢«æš´åŠ›ç ´è§£ï¼Œå®‰å…¨æ€§ä½</td>
</tr>
<tr>
<td>PasswordAuthentication no</td>
<td>å®‰å…¨æ€§é«˜ï¼Œé˜²æ­¢æš´åŠ›æ”»å‡»</td>
<td>å¦‚æœ SSH Key é…ç½®æœ‰é—®é¢˜ï¼Œå¯èƒ½ç™»å½•ä¸ä¸Š</td>
</tr>
</tbody>
</table>
<h4 id="362-ä½¿ç”¨ssh2"><a class="markdownIt-Anchor" href="#362-ä½¿ç”¨ssh2"></a> 3.6.2. ä½¿ç”¨SSH2</h4>
<ul>
<li><code>Protocol</code> æŒ‡å®š SSH ä½¿ç”¨çš„åè®®ç‰ˆæœ¬ï¼š
<ul>
<li><strong>Protocol 1</strong>ï¼šSSH-1ï¼Œå­˜åœ¨ä¸¥é‡å®‰å…¨æ¼æ´ï¼Œä¸å†æ¨è</li>
<li><strong>Protocol 2</strong>ï¼šSSH-2ï¼Œæ›´å®‰å…¨ï¼Œæ›´ç¨³å®š</li>
</ul>
</li>
<li>ç°ä»£ Linux å‘è¡Œç‰ˆé»˜è®¤ä½¿ç”¨ <strong>Protocol 2</strong>ï¼Œä½†æœ€å¥½ç¡®è®¤é…ç½®æ–‡ä»¶é‡Œæ˜ç¡®æŒ‡å®šã€‚</li>
</ul>
<p>åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹æˆ–åœ¨é€‚å½“ä½ç½®æ·»åŠ ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">Protocol 2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="363-é‡å¯ssh"><a class="markdownIt-Anchor" href="#363-é‡å¯ssh"></a> 3.6.3. é‡å¯ssh</h4>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> systemctl restart <span class="token function">ssh</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="37-fail2banå·¥å…·é˜²æš´åŠ›ç ´è§£"><a class="markdownIt-Anchor" href="#37-fail2banå·¥å…·é˜²æš´åŠ›ç ´è§£"></a> 3.7. Fail2banå·¥å…·é˜²æš´åŠ›ç ´è§£</h3>
<p>è¯¥å·¥å…·å¯ä»¥è‡ªåŠ¨å°ç¦æš´åŠ›ç ´è§£ IPã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> fail2ban
<span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> fail2ban
<span class="token function">sudo</span> systemctl start fail2ban<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="371-é…ç½®fail2ban"><a class="markdownIt-Anchor" href="#371-é…ç½®fail2ban"></a> 3.7.1. é…ç½®fail2ban</h4>
<pre class="line-numbers language-none"><code class="language-none">sudo nano &#x2F;etc&#x2F;fail2ban&#x2F;jail.local
# æ·»åŠ ï¼š
[sshd]
enabled &#x3D; true
maxretry &#x3D; 5
findtime &#x3D; 86400
bantime &#x3D; 86400<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>enabled</strong> â†’ æ˜¯å¦å¯ç”¨è¯¥ jail</li>
<li><strong>port</strong> â†’ SSH æœåŠ¡ç«¯å£ï¼ˆå¯ç”¨é€—å·æŒ‡å®šå¤šä¸ªç«¯å£ï¼Œå¦‚ 22,2222ï¼‰</li>
<li><strong>maxretry</strong> â†’ è¶…è¿‡å¤šå°‘æ¬¡å¤±è´¥è¢« ban</li>
<li><strong>bantime</strong> â†’ å°ç¦æŒç»­æ—¶é—´ï¼Œå¯æ”¹ä¸º <code>-1</code> æ°¸ä¹…å°ç¦</li>
<li><strong>findtime</strong> â†’ åœ¨findtimeæ—¶é—´å†…è¾“å…¥maxretryæ¬¡é”™è¯¯å¯†ç å³è¢«å°ç¦ã€‚</li>
</ul>
<h4 id="372-æŸ¥çœ‹çŠ¶æ€"><a class="markdownIt-Anchor" href="#372-æŸ¥çœ‹çŠ¶æ€"></a> 3.7.2. æŸ¥çœ‹çŠ¶æ€</h4>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> fail2ban-client status<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">Status for the jail: sshd
|- Filter
|  |- Currently failed: 3
|  |- Total failed: 15
|  &#96;- File list: &#x2F;var&#x2F;log&#x2F;auth.log
&#96;- Actions
   |- Currently banned: 1
   |- Total banned: 5
   &#96;- Banned IP list: 123.45.67.89<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>Banned IP list</code> â†’ è¢«å°ç¦çš„ IP</li>
<li><code>Currently banned</code> â†’ å½“å‰å°ç¦æ•°é‡</li>
</ul>
<h4 id="373-è§£å°ip"><a class="markdownIt-Anchor" href="#373-è§£å°ip"></a> 3.7.3. è§£å°ip</h4>
<p>å¦‚æœè‡ªå·±è¢« banï¼Œå¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è§£å°ï¼ˆå‡è®¾ä½ çš„ IP æ˜¯ <code>1.2.3.4</code>ï¼‰ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> fail2ban-client <span class="token builtin class-name">set</span> sshd unbanip <span class="token number">1.2</span>.3.4<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>è§£å°åä½ å¯ä»¥æ­£å¸¸ SSH ç™»å½•ã€‚</p>
<h4 id="374-å¯ç”¨fail2ban"><a class="markdownIt-Anchor" href="#374-å¯ç”¨fail2ban"></a> 3.7.4. å¯ç”¨fail2ban</h4>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> <span class="token parameter variable">--now</span> fail2ban<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="375-å°è´´å£«"><a class="markdownIt-Anchor" href="#375-å°è´´å£«"></a> 3.7.5. å°è´´å£«</h4>
<ol>
<li><strong>æ”¹è§„åˆ™å‰ä¿æŒä¸€ä¸ªæ´»åŠ¨ SSH ä¼šè¯</strong>ï¼Œæµ‹è¯•æ–°è§„åˆ™ç”Ÿæ•ˆå†é€€å‡º</li>
<li><strong>å…ˆå°èŒƒå›´æµ‹è¯•</strong>ï¼šä¾‹å¦‚ <code>maxretry = 3, bantime = 60</code>ï¼Œç¡®è®¤ä¸ä¼šè¯¯é”è‡ªå·±</li>
<li><strong>å®šæœŸæ£€æŸ¥</strong>ï¼š</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> fail2ban-client status sshd
<span class="token function">sudo</span> fail2ban-client status<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p>åšå®Œä¸Šé¢éƒ¨åˆ†åï¼Œåœ¨äº‘æœåŠ¡å™¨åå°åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰é•œåƒï¼Œå¤‡ä»½ä¸€ä¸‹ï¼Œæ–¹ä¾¿æ—¥åå¿«é€Ÿæ¢å¤ã€‚</p>
</blockquote>
<h2 id="4-ç³»ç»Ÿç»´æŠ¤éƒ¨åˆ†"><a class="markdownIt-Anchor" href="#4-ç³»ç»Ÿç»´æŠ¤éƒ¨åˆ†"></a> 4. ç³»ç»Ÿç»´æŠ¤éƒ¨åˆ†</h2>
<h3 id="41-ä½¿ç”¨expkg"><a class="markdownIt-Anchor" href="#41-ä½¿ç”¨expkg"></a> 4.1. <s>ä½¿ç”¨expkg</s></h3>
<h2 id="5-ç³»ç»Ÿè¿è¡Œéƒ¨åˆ†"><a class="markdownIt-Anchor" href="#5-ç³»ç»Ÿè¿è¡Œéƒ¨åˆ†"></a> 5. ç³»ç»Ÿè¿è¡Œéƒ¨åˆ†</h2>

        <hr style="margin: 50px; background: #111111">

<div class="meta" style="text-align: end; font-size: small;">
<p>å…±è®¡çº¦2.6kå­—ã€‚äº2025/10/14é¦–æ¬¡å‘å¸ƒï¼Œæœ€åæ›´æ–°äº2025/10/14ã€‚ </p>

    <p>æœ¬æ–‡ç« ä¸ºåšä¸»åŸåˆ›æ–‡ç« ã€‚éµå¾ª <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-sa/4.0/">CC 4.0 BY-SA</a> ç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥å’Œæœ¬å£°æ˜ã€‚</p>





    
        <span>
            <a href="/Tags/VPS/" id="tgs">
              #VPS |
            </a>
        </span>
    


</div>

    </div>

    
<style>
    #bar{
        width: 10%;
        position: sticky;
        top: 30px;
        ol{
            width: 400px;
            list-style-type: circle;
            margin: 0;
        }
    }
    #back-to-top{
            opacity: 0;
        }
        #back-to-top.show{
            opacity: 1;
        }
</style>

<div id="bar">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%89%8D%E8%A8%80"><span class="toc-text"> 1. å‰è¨€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%93%8D%E4%BD%9C%E4%B9%A0%E6%83%AF%E9%83%A8%E5%88%86"><span class="toc-text"> 2. æ“ä½œä¹ æƒ¯éƒ¨åˆ†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#21-%E4%BF%AE%E6%94%B9%E4%B8%BB%E6%9C%BA%E5%90%8D"><span class="toc-text"> 2.1. ä¿®æ”¹ä¸»æœºå</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-%E9%85%8D%E7%BD%AE%E6%97%B6%E5%8C%BA"><span class="toc-text"> 2.2. é…ç½®æ—¶åŒº</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%AE%89%E5%85%A8%E9%83%A8%E5%88%86"><span class="toc-text"> 3. ğŸ”å®‰å…¨éƒ¨åˆ†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#31-%E9%87%8D%E6%96%B0%E8%AE%BE%E7%BD%AEroot%E5%AF%86%E7%A0%81%E4%B8%BA%E5%BC%BA%E5%AF%86%E7%A0%81"><span class="toc-text"> 3.1. é‡æ–°è®¾ç½®rootå¯†ç ä¸ºå¼ºå¯†ç </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#32-%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7%E5%B9%B6%E8%AE%BE%E7%BD%AE%E5%BC%BA%E5%AF%86%E7%A0%81"><span class="toc-text"> 3.2. æ·»åŠ ç”¨æˆ·å¹¶è®¾ç½®å¼ºå¯†ç </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#33-%E7%B3%BB%E7%BB%9F%E5%8D%87%E7%BA%A7"><span class="toc-text"> 3.3. ç³»ç»Ÿå‡çº§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#34-%E4%BD%BF%E7%94%A8ssh-key%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95%E8%80%8C%E4%B8%8D%E6%98%AF%E5%AF%86%E7%A0%81"><span class="toc-text"> 3.4. ä½¿ç”¨SSH Keyè¿œç¨‹ç™»å½•è€Œä¸æ˜¯å¯†ç </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#35-%E6%94%B9ssh%E7%AB%AF%E5%8F%A3%E9%85%8D%E7%BD%AE%E9%98%B2%E7%81%AB%E5%A2%99"><span class="toc-text"> 3.5. æ”¹sshç«¯å£&amp;é…ç½®é˜²ç«å¢™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#36-ssh%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text"> 3.6. sshé…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#37-fail2ban%E5%B7%A5%E5%85%B7%E9%98%B2%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3"><span class="toc-text"> 3.7. Fail2banå·¥å…·é˜²æš´åŠ›ç ´è§£</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E7%B3%BB%E7%BB%9F%E7%BB%B4%E6%8A%A4%E9%83%A8%E5%88%86"><span class="toc-text"> 4. ç³»ç»Ÿç»´æŠ¤éƒ¨åˆ†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#41-%E4%BD%BF%E7%94%A8expkg"><span class="toc-text"> 4.1. ä½¿ç”¨expkg</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E7%B3%BB%E7%BB%9F%E8%BF%90%E8%A1%8C%E9%83%A8%E5%88%86"><span class="toc-text"> 5. ç³»ç»Ÿè¿è¡Œéƒ¨åˆ†</span></a></li></ol>
    <br>
    <div style="text-align: center;width: 200px;">
        <a href="/" style="text-decoration: none;">
            <button id="back-to-index" title="back to home">Home</button>
        </a>
        <button id="back-to-top" title="back to top">Top</button>
    </div>
</div>

<script>
    const backToTop = document.getElementById("back-to-top");

    window.addEventListener("scroll", () => {
    if (window.scrollY > 300) {
        backToTop.classList.add("show");
    } else {
        backToTop.classList.remove("show");
    }
    });

    backToTop.addEventListener("click", () => {
    window.scrollTo({
        top: 0,
        behavior: "smooth"
    });
    });
</script>

</div>


    <script src="/vendor/js/echarts.min.js"></script>
        
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                const heatmapChartDom = document.getElementById('heatmapChart');
                if(heatmapChartDom){
                    const heatmapChart = echarts.init(heatmapChartDom, 'light');
                    const cellSize = 15;

                    const groupByYear = (data) => {
                        const result = {};
                        data.forEach(([date, value]) => {
                            const [year] = date.split('-').map(Number);
                            if (!result[year]) {
                                result[year] = [];
                            }
                            result[year].push([date, value]);
                        });
                        return result;
                    };

                    const groupedData = groupByYear([["2025-01-18",2],["2025-01-19",3],["2025-01-21",1],["2025-02-06",1],["2025-02-22",1],["2025-03-01",1],["2025-03-07",1],["2025-03-09",3],["2025-03-10",1],["2025-03-12",1],["2025-03-17",1],["2025-03-22",2],["2025-04-04",1],["2025-04-05",1],["2025-04-06",1],["2025-04-10",1],["2025-06-07",1],["2025-06-11",3],["2025-06-12",1],["2025-06-14",3],["2025-06-18",2],["2025-06-30",1],["2025-07-14",1],["2025-07-28",1],["2025-08-06",1],["2025-08-11",1],["2025-08-24",1],["2025-08-25",1],["2025-09-07",3],["2025-09-09",2],["2025-09-10",1],["2025-09-12",1],["2025-09-15",1],["2025-09-18",1],["2025-09-27",1],["2025-09-28",3],["2025-09-29",2],["2025-10-09",1],["2025-10-10",1],["2025-10-14",1],["2025-10-22",1],["2025-10-23",1],["2025-10-28",2],["2025-10-29",1],["2025-10-31",1],["2025-11-02",2],["2025-11-11",1],["2025-11-19",1],["2025-11-23",1],["2025-11-24",1],["2025-11-25",2],["2025-11-28",1],["2025-12-02",1],["2025-12-08",4]]);
                    const years = Object.keys(groupedData).reverse();

                    var initYear = parseInt(heatmapChartDom.getAttribute('year')) || new Date().getFullYear();
                    const minYear = years[years.length - 1];
                    const maxYear = years[0];
                    if (initYear < minYear || initYear > maxYear) {
                        initYear = maxYear;
                    }
                    console.log('[hexo-graph]generateHeatmapChart|initYear:', initYear, 'minYear:', minYear, 'maxYear:', maxYear);

                    heatmapChart.setOption({
                        grid: {},
                        tooltip: {
                            position: 'top',
                            formatter: params => `${params.value[0]}: ${params.value[1]} Articles`
                        },
                        calendar: {
                            top: '10%',
                            range: initYear,
                            cellSize: cellSize,
                            splitLine: { lineStyle: { color: '#101418', width: 4 } },
                            itemStyle: { borderWidth: 4, borderColor: '#101418', color: '#1e1e1e'},
                            dayLabel: { show: false },
                            monthLabel: { show: true ,color: '#7b7b7b'},
                            yearLabel: { show: false },


                        },

                        visualMap: {
                            show: true,
                            right: '8%',
                            bottom: '5%',
                            type: 'piecewise',
                            orient: 'horizontal',
                            text: ['More', 'Less'],
                            min: 0,
                            max: Math.max(...groupedData[initYear].map(item => item[1])),
                            inRange: { color: ["#663300","#994c00","#cc6600","#ff9933"] },

                        },
                        legend: {
                            type: 'scroll',
                            icon: 'none',
                            data: years,
                            orient: 'vertical',
                            top: '5%',
                            right: 'right',
                            itemWidth: 20,
                            itemHeight: 20,
                            itemGap: 10,
                            pageIconSize: 10,
                            pageTextStyle: { fontSize: 14,},
                            selectedMode: 'single',

                        },
                        series: years.map(year => ({
                            type: 'heatmap',
                            coordinateSystem: 'calendar',
                            data: groupedData[year],
                            name: year,
                            emphasis: {
                                disabled: true,
                            },
                            silent: year !== initYear,
                        })),
                    });

                    // init selected year
                    heatmapChart.dispatchAction({
                        type: 'legendSelect',
                        name: initYear,
                    });

                    heatmapChart.on('legendselectchanged', function(params) {
                        console.log('[hexo-graph]generateHeatmapChart|legendselectchanged:', params);
                        const selectedYear = Object.keys(params.selected).find(key => params.selected[key]);
                        if (selectedYear && groupedData[selectedYear]) {
                            heatmapChart.setOption({
                                calendar: {
                                    range: selectedYear,
                                },
                                visualMap: {
                                    max: Math.max(...groupedData[selectedYear].map(item => item[1])),
                                },
                                series: years.map(year => ({
                                    type: 'heatmap',
                                    coordinateSystem: 'calendar',
                                    data: groupedData[year],
                                    name: year,
                                    emphasis: {
                                        disabled: true,
                                    },
                                    silent: year !== selectedYear,
                                })),
                            });
                        }
                    });

                    heatmapChart.on('click', function (params) {
                        if (params.componentType === 'series') {
                            const [year, month] = params.value[0].split('-');
                            window.location.href = '/archives/' + year + '/' + month;
                        }
                    });
                }
            });
        </script>
    
        
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                const monthlyChartDom = document.getElementById('monthlyChart');
                if(monthlyChartDom){
                    const monthlyChart = echarts.init(monthlyChartDom, 'light');
                    monthlyChart.setOption({
                        xAxis: { 
                            type: 'category', 
                            data: ["2025-01","2025-02","2025-03","2025-04","2025-06","2025-07","2025-08","2025-09","2025-10","2025-11","2025-12"], 
                            axisLabel: { fontSize: 14, fontWeight: 'bold', fontFamily: 'Microsoft YaHei, SimSun, serif' }
                        },
                        yAxis: { type: 'value', splitLine: { lineStyle: { type: 'dashed', color: '#ccc' } } },
                        series: [{
                            name: 'Articles',
                            type: 'line',
                            data: [6,2,10,4,11,2,4,15,9,9,5],
                            smooth: true,
                            lineStyle: { color: '#FF9A8B', width: 2 },
                            itemStyle: { color: '#FF9A8B' },
                            areaStyle: { color: 'rgba(84, 112, 198, 0.4)' },
                            symbolSize: 10,
                            label: {
                                show: true,
                                position: 'top',
                                formatter: params => params.value,
                                fontSize: 14,
                                color: '#7b7b7b',
                                fontWeight: 'bold',
                                fontFamily: 'Microsoft YaHei, SimSun, serif'
                            }
                        }]
                    });

                    monthlyChart.on('click', function (params) {
                        const [year, month] = params.name.split('-');
                        window.location.href = '/archives/' + year + '/' + month;
                    });
                }
            })
        </script>
    
        
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                const tagsChartDom = document.getElementById('tagsChart');
                if(tagsChartDom){
                    const tagsChart = echarts.init(tagsChartDom, 'light');
                    tagsChart.setOption({
                        tooltip: { trigger: 'item', formatter: '{b}: {c} ({d}%)' },
                        series: [{
                            type: 'pie',
                            radius: '60%',
                            data: [{"name":"Linux","value":30},{"name":"åµŒå…¥å¼","value":15},{"name":"python","value":7},{"name":"STM32","value":6},{"name":"CubeMX","value":5},{"name":"æ‘„å½±åŸºç¡€","value":5},{"name":"å­¦ä¹ ç¬”è®°","value":5},{"name":"å†…æ ¸","value":4}],
                            label: {
                                position: 'outside',
                                formatter: '{b} {c} ({d}%)',
                                fontSize: 14,
                                fontWeight: 'bold',
                                fontFamily: 'Microsoft YaHei, SimSun, serif',
                                color: '#7b7b7b',
                            },
                            color: ["#4E79A7","#F28E2B","#E15759","#76B7B2","#59A14F","#EDC949","#AF7AA1","#FF9DA7"],
                            labelLine: { show: true }
                        }],
                        legend: {
                            bottom: '0',
                            left: 'center',
                            data: [{"name":"Linux","value":30},{"name":"åµŒå…¥å¼","value":15},{"name":"python","value":7},{"name":"STM32","value":6},{"name":"CubeMX","value":5},{"name":"æ‘„å½±åŸºç¡€","value":5},{"name":"å­¦ä¹ ç¬”è®°","value":5},{"name":"å†…æ ¸","value":4}].map(tag => tag.name),
                            textStyle: { fontSize: 14, fontWeight: 'bold', fontFamily: 'Microsoft YaHei, SimSun, serif',color: '#7b7b7b',}
                        }
                    });

                    tagsChart.on('click', function (params) {
                        window.location.href = '/tags/' + params.name;
                    });
                }
            })
        </script>
    
        
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                const categoriesChartDom = document.getElementById('categoriesChart');
                if(categoriesChartDom){
                    const categoriesChart = echarts.init(categoriesChartDom, 'light');
                    categoriesChart.setOption({
                        xAxis: { type: 'value', splitLine: { lineStyle: { type: 'dashed', color: '#7b7b7b' } } },
                        yAxis: {
                            type: 'category',
                            data: [{"name":"Linux","value":43},{"name":"åµŒå…¥å¼","value":13},{"name":"è®°å½•","value":11},{"name":"å†…æ ¸ç¼–ç¨‹","value":11},{"name":"å…¥é—¨","value":7}].map(category => category.name).reverse(),
                            axisLabel: { fontSize: 14, fontWeight: 'bold', color: '#7b7b7b', fontFamily: 'Microsoft YaHei, SimSun, serif' }
                        },
                        series: [{
                            name: 'Category Count',
                            type: 'bar',
                            data: [{"name":"Linux","value":43},{"name":"åµŒå…¥å¼","value":13},{"name":"è®°å½•","value":11},{"name":"å†…æ ¸ç¼–ç¨‹","value":11},{"name":"å…¥é—¨","value":7}].map(category => category.value).reverse(),
                            label: {
                                show: true,
                                position: 'right',
                                formatter: params => params.value,
                                fontSize: 14,
                                color: '#7b7b7b',
                                fontWeight: 'bold',
                                fontFamily: 'Microsoft YaHei, SimSun, serif'
                            },
                            itemStyle: {
                                color: new echarts.graphic.LinearGradient(0, 0, 1, 0, [
                                    { offset: 0, color: '#4C8C99' },
                                    { offset: 1, color: '#F9B5E2' }
                                ])
                            }
                        }]
                    });

                    categoriesChart.on('click', function (params) {
                        window.location.href = '/categories/' + params.name;
                    });
                }
            });
        </script>
    
        
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                const categoriesTreeChartDom = document.getElementById('categoriesTreeChart');
                if(categoriesTreeChartDom){
                    const treeChart = echarts.init(categoriesTreeChartDom, 'light');
                    treeChart.setOption({
                        title: {
                            text: 'æ“ä½œæç¤ºï¼šå•å‡»å±•å¼€åˆ†ç±»ï¼ŒåŒå‡»è¿›å…¥å…·ä½“åˆ†ç±»é¡µé¢',
                            textStyle: {
                                fontSize: 12,
                                color: '#999',
                                fontWeight: 'normal'
                            },
                            bottom: 0,
                            left: 'center'
                        },
                        tooltip: {
                            trigger: 'item',
                            triggerOn: 'mousemove'
                        },
                        series: [{
                            type: 'tree',
                            data: [{"name":"Categories","children":[{"name":"åµŒå…¥å¼","children":[{"name":"é…ç½®åŠŸèƒ½","children":[],"count":6,"path":"åµŒå…¥å¼/é…ç½®åŠŸèƒ½"},{"name":"ç¨‹åºæ¶æ„","children":[],"count":5,"path":"åµŒå…¥å¼/ç¨‹åºæ¶æ„"},{"name":"é€šä¿¡åè®®","children":[],"count":1,"path":"åµŒå…¥å¼/é€šä¿¡åè®®"}],"count":13,"path":"åµŒå…¥å¼"},{"name":"Linux","children":[{"name":"è®°å½•","children":[],"count":11,"path":"Linux/è®°å½•"},{"name":"å†…æ ¸ç¼–ç¨‹","children":[],"count":11,"path":"Linux/å†…æ ¸ç¼–ç¨‹"},{"name":"å…¥é—¨","children":[],"count":7,"path":"Linux/å…¥é—¨"},{"name":"é¡¹ç›®ç®¡ç†","children":[],"count":1,"path":"Linux/é¡¹ç›®ç®¡ç†"},{"name":"è®¾å¤‡é©±åŠ¨ç¨‹åº","children":[],"count":5,"path":"Linux/è®¾å¤‡é©±åŠ¨ç¨‹åº"},{"name":"WSL2","children":[],"count":2,"path":"Linux/WSL2"},{"name":"ç³»ç»Ÿç§»æ¤","children":[],"count":6,"path":"Linux/ç³»ç»Ÿç§»æ¤"}],"count":43,"path":"Linux"},{"name":"é˜…è¯»","children":[],"count":1,"path":"é˜…è¯»"},{"name":"python","children":[],"count":7,"path":"python"},{"name":"å…¶ä»–","children":[],"count":4,"path":"å…¶ä»–"},{"name":"æ‘„å½±å­¦ä¹ ","children":[],"count":5,"path":"æ‘„å½±å­¦ä¹ "},{"name":"VPS","children":[],"count":1,"path":"VPS"}],"count":0,"path":""}],
                            initialTreeDepth: -1,
                            top: '5%',
                            bottom: '10%',
                            left: '0%',
                            right: '0%',
                            symbolSize: 15,
                            layout: 'orthogonal',
                            orient: 'TB',
                            itemStyle: {
                                color: '#60A5FA',
                                borderColor: '#60A5FA'
                            },
                            label: {
                                position: 'bottom',
                                verticalAlign: 'middle',
                                align: 'center',
                                fontSize: 14,
                                distance: 28,
                                color: '#cacaca',
                                formatter: function(params) {
                                    return params.data.name + (params.data.count ? ' (' + params.data.count + ')' : '');
                                }
                            },
                            leaves: {
                                label: {
                                    position: 'top',
                                    verticalAlign: 'middle',
                                    align: 'center'
                                }
                            },
                            emphasis: {
                                focus: 'descendant'
                            },
                            expandAndCollapse: true
                        }]
                    });

                    treeChart.on('dblclick', function (params) {
                        if (params.data && params.data.path) {
                            window.location.href = '/categories/' + params.data.path;
                        }
                    });
                }
            });
        </script>
    
    </body>

</html>


<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>GoDm@&#39;s Blog</title>
  
  <subtitle>记录自己所爱。</subtitle>
  <link href="https://blog.godmao.top/atom.xml" rel="self"/>
  
  <link href="https://blog.godmao.top/"/>
  <updated>2025-11-13T12:20:22.603Z</updated>
  <id>https://blog.godmao.top/</id>
  
  <author>
    <name>GoDm@</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>使用mfgtool烧写完整系统到IMX的EMMC</title>
    <link href="https://blog.godmao.top/posts/19983/"/>
    <id>https://blog.godmao.top/posts/19983/</id>
    <published>2025-11-11T11:34:13.000Z</published>
    <updated>2025-11-13T12:20:22.603Z</updated>
    
    <content type="html"><![CDATA[<details><summary>版权信息</summary><div class="admonition warning"><p class="admonition-title">warning</p><p>本文章为博主原创文章。遵循 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh-hans">CC 4.0 BY-SA</a> 版权协议，转载请附上原文出处链接和本声明。</p></div></details><hr /><h2 id="mfgtool-介绍"><a class="markdownIt-Anchor" href="#mfgtool-介绍"></a> mfgtool 介绍</h2><p>mfgtool 是 NXP 提供的专门用于给 <a href="http://I.MX">I.MX</a> 系列 CPU 烧写系统的软件。</p><h2 id="mfgtool-工作流程"><a class="markdownIt-Anchor" href="#mfgtool-工作流程"></a> mfgtool 工作流程</h2><ol><li>首先 mfgtool 将 firmware 目录中的 uboot、linux kernel 和.dtb(设备树)，然后通过 USB OTG 将这个文件下载到开发板的 DDR 中，目的就是在 DDR 中启动 Linux 系统，为后面的烧写做准备。</li><li>经过第一步的操作，此时 Linux 系统已经运行起来了，系统运行起来以后就可以很方便的完成对 EMMC 的格式化、分区等操作。EMMC 分区建立好以后就可以从 files 中读取要烧写的 uboot、linux kernel、.dtb(设备树)和 rootfs 这 4 个文件，然后将其烧写到 EMMC 中。</li><li>files 和 firmware 目录下有众多的 uboot 和设备树，那么烧写的时候究竟选择哪一个呢？这个工作就是由 ucl2.xml 文件来完成的。ucl2.xml 以“<code>&lt;UCL&gt;</code>”开始，以“<code>&lt;/UCL&gt;</code>”结束。“<code>&lt;CFG&gt;</code>”和“<code>&lt;/CFG&gt;</code>”之间是配置相关内容，主要是判断当前是给 <a href="http://I.MX">I.MX</a> 系列的哪个芯片烧写系统。“<code>&lt;LIST&gt;</code>”和“<code>&lt;/LIST&gt;</code>”之间的是针对不同存储芯片的烧写命令。</li></ol><p>这个就是 mfgTool 的大概工作流程。</p><p>总结：</p><p><code>firmware</code>：烧写到DDR中的Linux文件，用于操作EMMC。</p><p><code>file</code>：真正烧写到EMMC中的文件。</p><p><code>ucl2.xml</code>：指示mfgtool烧写哪些文件。</p><h2 id="烧写自己的系统"><a class="markdownIt-Anchor" href="#烧写自己的系统"></a> 烧写自己的系统</h2><p>以IMX6ULL为例。</p><p>查看 <code>ucl2.xml</code>，再打开：</p><p><code>/mfgtools/Profiles/Linux/OS Firmware/firmware</code> 及</p><p><code>/mfgtools/Profiles/Linux/OS Firmware/files</code>，</p><p>易知：</p><p>要烧写的文件在 files 目录下和 firmware 目录下同名<br />且要烧写的文件名如下：</p><h3 id="u-boot"><a class="markdownIt-Anchor" href="#u-boot"></a> u-boot</h3><p>官方u-boot名称：<code>u-boot-imx6ull14x14evk_emmc.imx</code></p><h3 id="内核镜像"><a class="markdownIt-Anchor" href="#内核镜像"></a> 内核镜像</h3><p>官方内核名称：<code>zImage</code></p><h3 id="设备树"><a class="markdownIt-Anchor" href="#设备树"></a> 设备树</h3><p>官方设备树名称：<code>zImage-imx6ull-14x14-evk-emmc.dtb</code></p><h3 id="根文件系统"><a class="markdownIt-Anchor" href="#根文件系统"></a> 根文件系统</h3><p>官方根文件系统名称：<code>rootfs_nogpu.tar.bz2</code></p><p>注：先将根文件系统使用 <code>tar -vcjf</code> 命令打包。该项只存在于 files 中，无需烧写到DDR中。</p><h3 id="烧写方法"><a class="markdownIt-Anchor" href="#烧写方法"></a> 烧写方法</h3><p>直接将自己确认好可以用的 dtb、kernel、uboot、rootfs 文件改为上面的官方名称并覆盖到firmware 及 files 文件夹。<br />然后双击对应的烧写脚本（我的是： <code>mfgtool2-yocto-mx-evk-emmc.vbs</code>） 烧写。</p><h3 id="issue1内核启动3s后卡死无法挂载根文件系统"><a class="markdownIt-Anchor" href="#issue1内核启动3s后卡死无法挂载根文件系统"></a> issue#1：内核启动3s后卡死，无法挂载根文件系统。</h3><h4 id="排查过程"><a class="markdownIt-Anchor" href="#排查过程"></a> 排查过程：</h4><p>起初怀疑是根文件系统问题。排查如下：</p><ol><li><p>检查根文件系统是否烧写成功或文件系统格式错误。<br />在uboot中输入命令：<code>ext4ls mmc 1:2 /</code> 成功输出根文件系统内容，排除。</p></li><li><p>怀疑根文件系统初始化脚本无法执行。<br />在uboot的bootargs 参数中添加：<code>init=/bin/sh</code>，依旧无法启动，排除。说明根本还没到这一步就死了，确认问题是根文件系统无法挂载。</p></li><li><p>控制变量法：<br />替换根文件系统为正点原子官方的根文件系统并烧写，依旧启动卡死。怀疑是内核问题。</p></li><li><p>替换内核为官方Linux内核；uboot、根文件系统、dtb使用自己的并烧写——成功启动。</p></li><li><p>懵逼。按理来说内核4.0跨到6.0版本，时间跨度很大，dtb文件应该不适用才对。也就是说我使用 4.0 的内核应该不能适配 6.0 的 dtb 文件。</p></li></ol><h4 id="最后排查原因"><a class="markdownIt-Anchor" href="#最后排查原因"></a> 最后排查原因：</h4><p>dtb文件烧写错误。。。。。我错误的将<code>zImage-imx6ull-14x14-evk-emmc.dtb</code> 命名为了 <code>zImage-imx6ull-14x14-evk.dtb</code>，导致我使用新内核启动时，使用的还是是nxp官方的旧的内核的dtb文件，而不是新的。。。两者不适配。</p><p>最后还得感谢ai的质疑精神）我给ai说我确认dtb文件正确，ai看了我的日志后提出了质疑，并帮助我排查出了原因，也是nb。。。。</p><p><img src="Snipaste_2025-11-13_20-11-17.png" alt="" /></p><h2 id="定制化脚本"><a class="markdownIt-Anchor" href="#定制化脚本"></a> 定制化脚本</h2><p>待补充。。。。。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;details&gt;
&lt;summary&gt;版权信息&lt;/summary&gt;
&lt;div class=&quot;admonition warning&quot;&gt;&lt;p class=&quot;admonition-title&quot;&gt;warning&lt;/p&gt;&lt;p&gt;本文章为博主原创文章。遵循 &lt;a href=&quot;https://c</summary>
      
    
    
    
    <category term="Linux" scheme="https://blog.godmao.top/categories/Linux/"/>
    
    <category term="系统移植" scheme="https://blog.godmao.top/categories/Linux/%E7%B3%BB%E7%BB%9F%E7%A7%BB%E6%A4%8D/"/>
    
    
    <category term="Linux" scheme="https://blog.godmao.top/Tags/Linux/"/>
    
    <category term="mfgtool" scheme="https://blog.godmao.top/Tags/mfgtool/"/>
    
  </entry>
  
  <entry>
    <title>编程随想</title>
    <link href="https://blog.godmao.top/posts/42114/"/>
    <id>https://blog.godmao.top/posts/42114/</id>
    <published>2025-11-02T11:20:06.000Z</published>
    <updated>2025-11-02T13:08:22.117Z</updated>
    
    <content type="html"><![CDATA[<details><summary>版权信息</summary><div class="admonition warning"><p class="admonition-title">warning</p><p>本文章为博主原创文章。遵循 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh-hans">CC 4.0 BY-SA</a> 版权协议，转载请附上原文出处链接和本声明。</p></div></details><hr /><p>在一切开始之前，只有一片寂静的“原初之石”（嵌入式设备）。</p><h2 id="第一章启程者uboot的誓约"><a class="markdownIt-Anchor" href="#第一章启程者uboot的誓约"></a> 第一章：启程者U·Boot的誓约</h2><p>在永恒的黑暗中，第一位生灵觉醒了，他是启程者U·Boot。U·Boot是一位不朽的守誓人，他的存在只有一个目的：开启世界。</p><p>当启动的信号闪烁，U·Boot立刻开始了他的神圣仪式：他首先叩击了“原初之石”的脉络（初始化硬件），确认每一个节点——从宏大的记忆之河到微小的时钟之弦——都已准备就绪。</p><p>U·Boot知道，他无法独自构建世界。他必须唤醒那位沉睡的，真正的造物主。他奔向古老的智慧之塔（存储器），找到并抬起了沉重的命运之卷。他将这卷轴——那是核心法则的记录——庄严地放置在清醒之所（内存）的中央。</p><p>U·Boot深深地鞠躬，他望向那卷轴，低语道：“我的使命已终。核心啊，醒来吧，时间已到。” 他将所有的力量和权限，都倾注给了这卷轴，然后，U·Boot的光芒隐去，他完成了对黎明的誓约。</p><h2 id="第二章律法之魂kernel的诞生"><a class="markdownIt-Anchor" href="#第二章律法之魂kernel的诞生"></a> 第二章：律法之魂Kernel的诞生</h2><p>当U·Boot的光芒熄灭，律法之魂Kernel被唤醒了。</p><p>Kernel是世界的内在灵魂，它没有具体的形态，却是一切秩序的源泉。Kernel诞生的第一件事，就是建立律法。</p><p>它向四周伸出无数看不见的触手，拥抱并驾驭了整个“原初之石”（加载驱动程序，接管硬件）。现在，它能听到每一次输入，能控制每一次输出。</p><p>它在广阔的空间内划定了界限（内存管理），制定了时间分配的铁律（进程调度），确保每一个未来的思绪和行动都能得到公平的资源。</p><p>Kernel拥有了管理世界的绝对能力，但它环顾四周，发现自己身处一个有法则却无色彩的空旷世界。它像一位孤独的君王，拥有无上的权力，却没有臣民，没有诗歌，没有生命存在的意义。</p><p>“我的律法需要一个国度来承载，需要一个故事来讲述。” Kernel低语。</p><h2 id="第三章世界之华rootfs的盛开"><a class="markdownIt-Anchor" href="#第三章世界之华rootfs的盛开"></a> 第三章：世界之华RootFS的盛开</h2><p>Kernel沿着旧日信标指引的道路，找到了那片被尘封的宝库——那里储存着人类文明所有的积淀与梦想，它就是世界之华RootFS。</p><p>Kernel用律法的力量，将宝库的大门打开（挂载 RootFS），并伸出触手，唤醒了宝库中沉睡的第一个声音：先知 init。</p><p>先知 init 醒来，在Kernel律法的框架下开始了他的工作。</p><p>他迅速地摆放了日常所需的工具（基础命令、配置），让世界有了可操作的逻辑。</p><p>他依次唤醒了吟游诗人的歌谣（应用程序）、哲人的手稿（配置文件）和工匠的工具（服务进程）。</p><p>至此，Kernel的律法框架与RootFS的丰富内容完美结合。世界不再是空洞的法则，而是充满生机、可以感知、可以创造的完整存在。</p><p>启程者U·Boot开启了诞生；律法之魂Kernel赋予了秩序；世界之华RootFS成就了意义。三位一体，构成了完整的生命觉醒之旅。</p><h2 id="附录1世界之华的十大景观"><a class="markdownIt-Anchor" href="#附录1世界之华的十大景观"></a> 附录1：世界之华的十大景观</h2><h3 id="root-和-home君王和臣民的私域"><a class="markdownIt-Anchor" href="#root-和-home君王和臣民的私域"></a> /root 和 /home：君王和臣民的私域</h3><p>/root(君王的静室)：这是律法之魂Kernel的私人居所。只有他拥有最高的权限，用于处理最核心、最私密的政务。外人不得擅入。</p><p>/home(臣民的村落)：这是所有在国度中生活和创造的个体（用户）的专属领地。每个臣民在自己的屋子里书写自己的故事，彼此独立，但都在科恩的律法之下。</p><h3 id="bin-和-sbin勇士和祭司的武器库"><a class="markdownIt-Anchor" href="#bin-和-sbin勇士和祭司的武器库"></a> /bin 和 /sbin：勇士和祭司的武器库</h3><p>/bin(勇士的佩剑)：存放着所有普通居民（用户）都可以使用的日常工具和技能。比如：ls（点清财物）、cp（搬运物品）。它们是国度最常用的动作。</p><p>/sbin(祭司的法杖)：存放着只有最高祭司（系统管理员或 Kernel）才能动用的神圣工具。这些工具用于维护国度的根本稳定，如格式化土地、修复城墙等。</p><h3 id="etc国度的古老法典"><a class="markdownIt-Anchor" href="#etc国度的古老法典"></a> /etc：国度的古老法典</h3><p>/etc(古老的法典与契约)：存放着国度运行的所有规定和契约（配置文件）。它规定了谁（用户）能做什么，何时（服务）启动，以及如何（网络配置）与外界交流。它是世界的运行蓝图。</p><h3 id="usr知识与文化的殿堂"><a class="markdownIt-Anchor" href="#usr知识与文化的殿堂"></a> /usr：知识与文化的殿堂</h3><p>/usr(文化的宝库与学院)：Unix Software Resourse 存放着非核心但极其庞大的知识、艺术和工具。所有的吟游诗人的歌谣（库文件 /usr/lib）、学者的手稿（头文件 /usr/include）和复杂的巨型应用（/usr/bin）都集中于此，是国度的文明象征。</p><h3 id="dev与生俱来的感知器官"><a class="markdownIt-Anchor" href="#dev与生俱来的感知器官"></a> /dev：与生俱来的感知器官</h3><p>/dev(与生俱来的感知器官)：它不是真正的文件，而是Kernel与生俱来的“感知器官”（设备文件）。通过这些器官，灵魂可以直接触摸（读写）外界的光线（显示器）、倾听外界的声音（声卡）和感受外界的震动（键盘）。</p><h3 id="proc-和-sys世界的实时心跳与镜像"><a class="markdownIt-Anchor" href="#proc-和-sys世界的实时心跳与镜像"></a> /proc 和 /sys：世界的实时心跳与镜像</h3><p>/proc(世界的实时心跳)：它是一个魔法的镜子，实时映射出Kernel的每一个思绪和每一次呼吸（进程信息）。它不存储任何实物，只是Kernel当前状态的投影。</p><p>/sys(世界的生理数据)：它是一个精密的温度计和测量仪，详细展示国度的生理数据（硬件和驱动状态）。</p><h3 id="tmp-和-var时间的沙漏与变化"><a class="markdownIt-Anchor" href="#tmp-和-var时间的沙漏与变化"></a> /tmp 和 /var：时间的沙漏与变化</h3><p>/tmp(流逝的沙漏)： 存放着短暂的、易逝的思绪（临时文件）。一旦日出日落（重启），这些思绪便会随风消逝。</p><p>/var(变化的记录簿)： 存放着所有不断增长、不断变化的历史记录。比如：守夜人的日志（日志文件 /var/log）和来往的信件（邮件 /var/mail）。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;details&gt;
&lt;summary&gt;版权信息&lt;/summary&gt;
&lt;div class=&quot;admonition warning&quot;&gt;&lt;p class=&quot;admonition-title&quot;&gt;warning&lt;/p&gt;&lt;p&gt;本文章为博主原创文章。遵循 &lt;a href=&quot;https://c</summary>
      
    
    
    
    <category term="Linux" scheme="https://blog.godmao.top/categories/Linux/"/>
    
    <category term="系统移植" scheme="https://blog.godmao.top/categories/Linux/%E7%B3%BB%E7%BB%9F%E7%A7%BB%E6%A4%8D/"/>
    
    
    <category term="Linux" scheme="https://blog.godmao.top/Tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>使用BusyBox构建根文件系统</title>
    <link href="https://blog.godmao.top/posts/30149/"/>
    <id>https://blog.godmao.top/posts/30149/</id>
    <published>2025-11-02T10:57:57.000Z</published>
    <updated>2025-11-13T13:12:12.354Z</updated>
    
    <content type="html"><![CDATA[<details><summary>版权信息</summary><div class="admonition warning"><p class="admonition-title">warning</p><p>本文章为博主原创文章。遵循 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh-hans">CC 4.0 BY-SA</a> 版权协议，转载请附上原文出处链接和本声明。</p></div></details><hr /><h2 id="1-前言"><a class="markdownIt-Anchor" href="#1-前言"></a> 1. 前言</h2><h3 id="11-最小根文件系统"><a class="markdownIt-Anchor" href="#11-最小根文件系统"></a> 1.1. 最小根文件系统</h3><p>一个最精简的文件系统包含什么呢？<br />我们知道，内核挂载根文件系统后，第一件事是就是启动 /sbin 目录下的 init 程序作为第一个进程，init 程序读取 /etc 目录下的配置文件，再根据配置文件启动其他 app。同时这些app又有可能是动态链接的，所以我们还需要 /lib 文件夹，包含一些头文件。<br />此外，bootloader 也会在根文件系统启动内核，内核需要在根文件系统中读取设备树文件以控制硬件，这有了 /boot 文件夹。<br />有了设备树，自然少不了 /dev 目录。最小的/dev目录，只要包含 console 与 null。<br />综上，我们可以总结出一个最小的根文件系统有什么：</p><ol><li>init 程序</li><li>其他的必要app</li><li>配置文件</li><li>lib库（用于动态链接）</li><li>内核zImage</li><li>dtb设备树文件</li><li>/dev</li></ol><p>1点属于/sbin，2点属于/bin ，3点属于/etc，4点属于/lib，5、6点属于/boot。</p><p>如果更极致的话，甚至可以使用静态链接，静态编译应用程序，这样就不用 /lib ，也不使用其他app，就一个init程序实现想要的功能即可——当然这是理想化的。</p><h3 id="12-关于-systemv-和-systemd"><a class="markdownIt-Anchor" href="#12-关于-systemv-和-systemd"></a> 1.2. 关于 systemV 和 systemd</h3><p>我们上面所说的 init 其实说的就是 system V 的启动方式——串行启动，一个脚本执行完再启动下一个。与 system V 相比，systemd 更加现代化且更好——并行启动，通过依赖关系图同时启动多个服务、启动速度快、依赖关系明确等等…<br />但是，在嵌入式linux坏境中却并不一定好用，因为它太重了，依赖也多。而且对于使用 systemd 的嵌入式系统来说，根文件系统也不应该用 busybox 来构建。busybox生成的 init 实际上就是类似于 system V 的 init 实现。</p><h3 id="13-what-is-busybox"><a class="markdownIt-Anchor" href="#13-what-is-busybox"></a> 1.3. What is BusyBox？</h3><p>BusyBox<strong>并不是一个根文件系统制作工具</strong>，它只是极大地简化了 /bin、/sbin 等目录的搭建。<br />BusyBox 是一个集成了上百个常用 UNIX 命令的小型可执行文件。</p><p>当你在 shell 中输入：<code>ls</code><br />实际上调用：<code>/bin/busybox ls</code><br />BusyBox 会根据你执行的命令名自动表现成对应工具的行为。</p><p>它的设计哲学是：</p><ul><li>只实现最核心的功能；</li><li>去掉冗余；</li><li>用最小的代码体积覆盖最大功能。</li></ul><p>从这里可以看出，它非常适合嵌入式系统。</p><h2 id="2-编译busybox"><a class="markdownIt-Anchor" href="#2-编译busybox"></a> 2. 编译BusyBox</h2><p>首先在makefile中指定交叉编译器，避免每次make都要传入编译器参数。</p><p><img src="Snipaste_2025-11-05_18-15-55.png" alt="" /></p><p>使用命令 <code>make help</code> 查看make选项。</p><h3 id="21-生成配置文件"><a class="markdownIt-Anchor" href="#21-生成配置文件"></a> 2.1. 生成配置文件</h3><p>我们先使用默认的配置文件。</p><p>使用命令 <code>make menuconfig</code> 或者 <code>make defconfig</code> 都可以。我们选择menuconfig，方便我们配置一些选项：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">make</span> menuconfig<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>进入配置界面后，我们可以指定一下编译器前缀 ：<br />将 Settings → Build Options → Cross Compiler prefix 中指定为 <code>arm-none-linux-gnueabihf-</code>。</p><p>也可以启用 Build static binary (no shared libs) 以实现静态编译，不用使用动态共享库省去自己构建库文件的步骤，代价是根文件系统大小大一些。空间换时间（bushi</p><p>其他的根据自己需求修改（如果看得懂的话）。</p><p>同时最好关闭硬件加速项SHA，也就是这两项：</p><p><img src="Snipaste_2025-11-05_18-22-47.png" alt="" /></p><p>我使用的1.37.0版本 busybox，即使使用默认配置文件，什么也不做修改，也无法编译成功，会报错：“libbb/hash_md5_sha.c:1316:35: error: ‘sha1_process_block64_shaNI’ undeclared (first use in this function);”</p><p>查阅后发现可能是CPU不支持硬件加速的问题，所以就将 Settings 选项里的两个硬件加速选项关了。不知道是官方的bug还是什么…</p><h3 id="22-编译并安装busybox"><a class="markdownIt-Anchor" href="#22-编译并安装busybox"></a> 2.2. 编译并安装BusyBox</h3><p>编译没啥好说的，<code>make</code> 即可。</p><p>用 <code>CONFIG_PREFIX</code> 指定文件夹。将busybox 安装到指定文件夹，也就是拟用于构建根文件系统的那个文件夹嘛，前面我们也说了，busybox就相当于把 /sbin /bin 这两块拼图做好了。</p><blockquote><p>安装实际上就是建立软链接，链接到 /bin/busybox 。所以一定要确定好路径，要是不小心指定到本机Linux的根目录下不就废了吗。😦</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">make</span> <span class="token assign-left variable">CONFIG_PREFIX</span><span class="token operator">=~</span>/shared/rootfs_tmp  <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="Snipaste_2025-11-05_18-43-14.png" alt="" /></p><p><img src="Snipaste_2025-11-10_14-54-29.png" alt="" /></p><h2 id="3-完善根文件系统"><a class="markdownIt-Anchor" href="#3-完善根文件系统"></a> 3. 完善根文件系统</h2><p>目前根文件系统最基本的操作工具就有了，但是还缺少必要的文件夹，比如dev、sys等。</p><p>但是我们不必在这里创建这些文件夹。还记得之前提到的初始化脚本吗，内核启动并挂载根文件系统后，做的第一件事就是运行 /sbin/init 。而这个程序又在做什么呢，busybox的init程序大概做这三件事：</p><ol><li>读取 <code>/etc/inittab</code>（如果有）；</li><li>启动第一个初始化脚本 <code>/etc/init.d/rcS</code>；</li><li>最后启动 shell。</li></ol><p><code>inittab</code>：init 程序的配置文件</p><p><code>/etc/init.d/rcS</code>：run commands for system。一个普通的 shell 脚本，但它是由 init 启动的第一个脚本，负责初始化系统的环境。</p><p>因此我们可以在rcS脚本中添加这些必要文件。所以我们只需要在现在的根文件系统中添加以下几个文件：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> etc/init.d/rcS<span class="token function">mkdir</span> etc/inittab<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="31-rcs-的编写"><a class="markdownIt-Anchor" href="#31-rcs-的编写"></a> 3.1. rcS 的编写</h3><p>大致内容如下，已附详细注释及常见问题：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/sh</span><span class="token comment"># rcS - minimal BusyBox startup script</span><span class="token comment"># 这些文件夹的具体用途可以参见我的另一篇文章《编程随想》</span><span class="token builtin class-name">echo</span> <span class="token string">">>> Create the necessary folder if it does not exist..."</span><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /sys /dev /proc /tmp /run /var<span class="token comment"># mount -t &lt;文件系统类型> &lt;设备> &lt;挂载点></span><span class="token comment"># none：占位符。因为这里并不是“挂载某个磁盘”，</span><span class="token comment"># 而是在请求内核“把它内部的数据结构以文件形式呈现出来”</span><span class="token comment"># 文件系统类型 (`proc`, `sysfs`) 是内核内置的。</span><span class="token comment"># 系统并不会去磁盘上找“proc”，</span><span class="token comment"># 它调用的是内核内部的 `procfs_mount()` 函数。</span><span class="token comment"># 这里挂载的并不是设备，而是VFS，所以设备为“none”。</span><span class="token builtin class-name">echo</span> <span class="token string">">>> Mounting proc to /proc..."</span><span class="token function">mount</span> <span class="token parameter variable">-t</span> proc none /proc<span class="token builtin class-name">echo</span> <span class="token string">">>> Mounting sysfs to /sys..."</span><span class="token function">mount</span> <span class="token parameter variable">-t</span> sysfs none /sys<span class="token comment"># devtmpfs介绍：</span><span class="token comment"># 这是一个内核级的临时文件系统，</span><span class="token comment"># 自动由内核在设备注册时创建对应的设备节点。</span><span class="token comment"># 而无需什么mknod，udev，mdev。</span><span class="token comment"># 为什么是“临时”？因为它是重启后就需要重新生成。</span><span class="token comment"># 我发现在内核启动过程中已自动挂载devtmpfs，</span><span class="token comment"># 所以就不用再挂一遍。</span><span class="token comment"># --devtmpfs has already auto mounted.--</span><span class="token keyword">if</span> <span class="token operator">!</span> <span class="token function">mount</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-q</span> <span class="token string">"on /dev "</span><span class="token punctuation">;</span> <span class="token keyword">then</span>    <span class="token builtin class-name">echo</span> <span class="token string">">>> Mounting devtmpfs to /dev..."</span>    <span class="token function">mount</span> <span class="token parameter variable">-t</span> devtmpfs devtmpfs /dev<span class="token keyword">else</span>    <span class="token builtin class-name">echo</span> <span class="token string">">>> /dev already mounted by kernel"</span><span class="token keyword">fi</span><span class="token builtin class-name">echo</span> <span class="token string">">>> Setting up essential directories..."</span><span class="token function">mount</span> <span class="token parameter variable">-t</span> tmpfs tmpfs /tmp<span class="token function">mount</span> <span class="token parameter variable">-t</span> tmpfs tmpfs /run<span class="token comment"># setting hostname</span><span class="token builtin class-name">echo</span> <span class="token string">"mark1"</span> <span class="token operator">></span> /proc/sys/kernel/hostname<span class="token comment"># exec命令功能：</span><span class="token comment">#- 执行命令并替换掉当前进程（不会新建子进程）；</span><span class="token comment">#- 如果只带重定向而没有命令，</span><span class="token comment">#则会改变当前 shell 的文件描述符绑定。</span><span class="token comment">#这里的作用是把当前脚本进程直接替换为`/bin/sh`。</span><span class="token comment">#不再返回，也不再继续执行后续脚本。</span><span class="token comment"># Unix 的进程默认有三条流：</span><span class="token comment">#- `0` — 标准输入（stdin）</span><span class="token comment">#- `1` — 标准输出（stdout）</span><span class="token comment">#- `2` — 标准错误（stderr）</span><span class="token comment">#&lt; /dev/ttymxc0：</span><span class="token comment">#表示把标准输入改为从`/dev/ttymxc0`读取。</span><span class="token comment">#> /dev/ttymxc0：</span><span class="token comment">#表示把标准输出改为写入`/dev/ttymxc0`。</span><span class="token comment">#2>&amp;1：</span><span class="token comment">#表示把标准错误也重定向到标准输出的同一个地方。</span><span class="token comment"># 为什么这样做：</span><span class="token comment"># 如果直接exec到sh，则会提示：</span><span class="token comment"># /bin/sh: can't access tty;job control turned off</span><span class="token comment"># 意思是当前 shell 没有绑定到一个真正的终端（tty），</span><span class="token comment"># 所以 Ctrl+C、Ctrl+Z、作业控制等功能无法使用。</span><span class="token builtin class-name">echo</span> <span class="token string">">>> System ready. Starting shell..."</span><span class="token builtin class-name">exec</span> /bin/sh <span class="token operator">&lt;</span> /dev/ttymxc0 <span class="token operator">></span> /dev/ttymxc0 <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="32-inittab的编写"><a class="markdownIt-Anchor" href="#32-inittab的编写"></a> 3.2. inittab的编写</h3><p>当内核启动 <code>/sbin/init</code>（比如 BusyBox 的 init）时，init 会读取这个文件，<br />决定应该执行哪些命令、启动哪些脚本、在哪些终端上提供登录。</p><p>换句话说，它定义了：</p><ul><li>系统开机时做什么；</li><li>哪些脚本要执行；</li><li>哪些终端需要打开 shell。<br />所以，它就像系统启动的“行动计划表”。</li></ul><h4 id="321-inittab-的基本格式"><a class="markdownIt-Anchor" href="#321-inittab-的基本格式"></a> 3.2.1. <code>inittab</code> 的基本格式</h4><p>每一行是一条指令，格式通常是：</p><p><code>&lt;id&gt;:&lt;runlevels&gt;:&lt;action&gt;:&lt;process&gt;</code></p><p>但在 BusyBox 的简化版本中，<code>runlevels</code> 通常被忽略，<br />所以我们常见的是这样的：</p><p><code>::action:/path/to/command</code></p><h4 id="322-常见的-action-类型"><a class="markdownIt-Anchor" href="#322-常见的-action-类型"></a> 3.2.2. 常见的 action 类型</h4><p>让我们来看几个经典例子（尤其在 BusyBox 系统中）：</p><ol><li><p><code>sysinit</code></p><p>系统初始化时运行，通常挂载虚拟文件系统、创建目录等：</p><p><code>::sysinit:/etc/init.d/rcS</code></p><p>表示：在系统启动时，执行 <code>/etc/init.d/rcS</code> 脚本。</p></li><li><p><code>respawn</code></p><p>表示该进程如果退出，init 会重新启动它（循环重启）。<br />常用于启动终端或守护进程：</p><p><code>ttyS0::respawn:/sbin/getty -L ttyS0 115200 vt100</code></p><p>表示：在串口 ttyS0 上启动一个终端，波特率 115200，终端类型 vt100。</p></li><li><p><code>askfirst</code></p><p>和 <code>respawn</code> 类似，但在启动前会提示 “Press ENTER to activate this console”。<br />常用于开发板上的交互式 shell：</p><p><code>tty1::askfirst:/bin/sh</code></p></li><li><p><code>wait</code></p><p>表示执行完后等待命令退出再继续。<br />通常在系统初始化阶段使用：</p><p><code>::wait:/etc/init.d/rc.local</code></p></li></ol><h4 id="323-例子"><a class="markdownIt-Anchor" href="#323-例子"></a> 3.2.3. 例子</h4><pre class="line-numbers language-none"><code class="language-none">::sysinit:&#x2F;etc&#x2F;init.d&#x2F;rcS::askfirst:-&#x2F;bin&#x2F;sh::ctrlaltdel:&#x2F;bin&#x2F;umount -a -r::shutdown:&#x2F;bin&#x2F;umount -a -r<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-构建lib目录如果是动态编译"><a class="markdownIt-Anchor" href="#4-构建lib目录如果是动态编译"></a> 4. 构建lib目录（如果是动态编译）</h2><p>busybox默认是动态编译的，当然你可以在menuconfig中指定静态编译。</p><p>那么库在哪里呢？我们在使用工具链编译链接的时候，并没有报错，说明我们使用的工具链中含有这些库。我们从工具链中复制这些库到 /lib 。</p><p>那我们工具链的库又在哪呢？我们可以输入这么一行命令来获取到库路径：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">"void main()&#123;&#125;"</span> <span class="token operator">|</span> arm-none-linux-gnueabihf-gcc <span class="token parameter variable">-E</span> <span class="token parameter variable">-v</span> -<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>输出：</p><pre class="line-numbers language-none"><code class="language-none">LIBRARY_PATH&#x3D;&#x2F;home&#x2F;gdm&#x2F;prjts&#x2F;ARM_TOOLCHAIN&#x2F;AArch32-Linux&#x2F;arm-gnu-toolchain-14.3.rel1-x86_64-arm-none-linux-gnueabihf&#x2F;bin&#x2F;..&#x2F;lib&#x2F;gcc&#x2F;arm-none-linux-gnueabihf&#x2F;14.3.1&#x2F;:&#x2F;home&#x2F;gdm&#x2F;prjts&#x2F;ARM_TOOLCHAIN&#x2F;AArch32-Linux&#x2F;arm-gnu-toolchain-14.3.rel1-x86_64-arm-none-linux-gnueabihf&#x2F;bin&#x2F;..&#x2F;lib&#x2F;gcc&#x2F;:&#x2F;home&#x2F;gdm&#x2F;prjts&#x2F;ARM_TOOLCHAIN&#x2F;AArch32-Linux&#x2F;arm-gnu-toolchain-14.3.rel1-x86_64-arm-none-linux-gnueabihf&#x2F;bin&#x2F;..&#x2F;lib&#x2F;gcc&#x2F;arm-none-linux-gnueabihf&#x2F;14.3.1&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;arm-none-linux-gnueabihf&#x2F;lib&#x2F;:&#x2F;home&#x2F;gdm&#x2F;prjts&#x2F;ARM_TOOLCHAIN&#x2F;AArch32-Linux&#x2F;arm-gnu-toolchain-14.3.rel1-x86_64-arm-none-linux-gnueabihf&#x2F;bin&#x2F;..&#x2F;arm-none-linux-gnueabihf&#x2F;libc&#x2F;lib&#x2F;:&#x2F;home&#x2F;gdm&#x2F;prjts&#x2F;ARM_TOOLCHAIN&#x2F;AArch32-Linux&#x2F;arm-gnu-toolchain-14.3.rel1-x86_64-arm-none-linux-gnueabihf&#x2F;bin&#x2F;..&#x2F;arm-none-linux-gnueabihf&#x2F;libc&#x2F;usr&#x2F;lib&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>他们都是以 /home/gdm/prjts/ARM_TOOLCHAIN/AArch32-Linux/arm-gnu-toolchain-14.3.rel1-x86_64-arm-none-linux-gnueabihf/bin/…/ 开头。也就是工具链源路径。</p><p>令 “/home/gdm/prjts/ARM_TOOLCHAIN/AArch32-Linux/arm-gnu-toolchain-14.3.rel1-x86_64-arm-none-linux-gnueabihf/bin/…/” = [工具链源路径]</p><p>化简整理得：</p><pre class="line-numbers language-none"><code class="language-none">[工具链源路径]&#x2F;lib&#x2F;gcc&#x2F;arm-none-linux-gnueabihf&#x2F;14.3.1&#x2F;[工具链源路径]&#x2F;lib&#x2F;gcc&#x2F;[工具链源路径]&#x2F;lib&#x2F;gcc&#x2F;arm-none-linux-gnueabihf&#x2F;14.3.1&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;arm-none-linux-gnueabihf&#x2F;lib&#x2F;[工具链源路径]&#x2F;arm-none-linux-gnueabihf&#x2F;libc&#x2F;lib&#x2F;[工具链源路径]&#x2F;arm-none-linux-gnueabihf&#x2F;libc&#x2F;usr&#x2F;lib&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><code>ldd</code> 命令介绍：<code>ldd</code> 是 Linux 系统中用于显示可执行文件或共享库所依赖的动态链接库的命令行工具。它可以帮助开发者快速了解程序运行时的依赖关系，解决库缺失或版本冲突等问题。</p></blockquote><p>我们使用工具链中提供的 <code>readelf</code> 工具来查看 busybox 所需的动态链接库：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">arm-none-linux-gnueabihf-readelf <span class="token parameter variable">-d</span> bin/busybox <span class="token operator">|</span> <span class="token function">grep</span> NEEDED<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>-d 就是显示动态库。</p></blockquote><p>输出：</p><pre class="line-numbers language-none"><code class="language-none">0x00000001 (NEEDED) Shared library: [libm.so.6]0x00000001 (NEEDED) Shared library: [libresolv.so.2]0x00000001 (NEEDED) Shared library: [libc.so.6]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>接着就在上面提到的工具链库中找呀找，最后在倒数第二个库中找到了这几个依赖。</p><p><img src="Snipaste_2025-11-05_21-48-39.png" alt="" /></p><p>还要注意的是这些文件是不是软链接，如果是软链接，则需要将链接到的源文件也拷贝到 /lib。并在使用cp命令时加上 <code>-d</code> 选项，使其保持链接特性。</p><p>这里我用 <code>ls -l</code> 查看了，都不是软链接。</p><p>直接cp：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cp</span> libc.so.6 libm.so.6 libresolv.so.2 ~/shared/rootfs_tmp/lib<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>还要cp一个链接器：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cp</span> ld-linux-armhf.so.3 ~/shared/rootfs_tmp/lib<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr /><p style="font-size:30px"> <strong>下面的内容已不再适用。但是有一些内容值得做一些参考。</strong></p><hr /><h2 id="old5-构建boot目录"><a class="markdownIt-Anchor" href="#old5-构建boot目录"></a> [old]5. 构建boot目录</h2><p>把之前编译好的内核生成的dtb文件和zImage文件拷贝到根文件的 /boot 目录即可。</p><h2 id="old6-构建dev目录"><a class="markdownIt-Anchor" href="#old6-构建dev目录"></a> [old]6. 构建dev目录</h2><p>最小dev目录我们只要满足标准输出就好了，也就是能够输出信息。</p><p>我们可以先查看我们 linux 系统里的 console 设备是怎么创建的：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ls</span> /dev/console <span class="token parameter variable">-l</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>输出：</p><pre class="line-numbers language-none"><code class="language-none">crw------- 1 root root 5, 1 Nov  6 15:35 &#x2F;dev&#x2F;console<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>我们仿照这个用 <code>mknod</code> 命令在rootfs/dev目录创建：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">mknod</span> console c <span class="token number">5</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>同理创建 null 设备，</p><p>仿照：</p><pre class="line-numbers language-none"><code class="language-none">crw-rw-rw- 1 root root 1, 3 Nov  6 15:35 &#x2F;dev&#x2F;null<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>创建：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">mknod</span> null c <span class="token number">1</span> <span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="old7-刻录映像文件"><a class="markdownIt-Anchor" href="#old7-刻录映像文件"></a> [old]7. 刻录映像文件</h2><h3 id="71-刻录"><a class="markdownIt-Anchor" href="#71-刻录"></a> 7.1. 刻录</h3><p>使用genimage这个工具来生成image文件。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> genimage<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">image emmc.img&#123;hdimage &#123;                 &#x2F;&#x2F;生成DOS分区images。&#125;partition rootfs-1 &#123;partition-type &#x3D; 0xCbootable &#x3D; &quot;yes&quot;image &#x3D; &quot;boot.vfat&quot;  &#x2F;&#x2F;路径由 $&#123;INPUTPATH&#125; 指定size &#x3D; 12M&#125;partition rootfs-2 &#123;partition-type &#x3D; 0x83bootable &#x3D; &quot;yes&quot;image &#x3D; &quot;myrootfs.ext4&quot;size &#x3D; 34M&#125;&#125;image boot.vfat &#123;vfat &#123;files &#x3D; &#123; &quot;u-boot-dtb.imx&quot; &#125; &#x2F;&#x2F;路径由 &#123;INPUTPATH&#125; 指定&#125;size &#x3D; 10M&#125;image myrootfs.ext4 &#123;ext4&#123;&#125;name &#x3D; &quot;root&quot;size &#x3D; 32M &#x2F;&#x2F;根据自己的根文件系统大小调整mountpoint &#x3D; &quot;&#x2F;&quot; &#x2F;&#x2F;路径由 &#123;ROOTPATH&#125; 指定&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们现在只是测试，可以先随便创建一个&quot;u-boot-dtb.imx&quot;文件，比方说我创建这个文件，并在里面写入一个“test”字符串。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">genimage <span class="token punctuation">\</span><span class="token parameter variable">--rootpath</span> <span class="token string">"/home/gdm/shared/rootfs_tmp"</span> <span class="token punctuation">\</span><span class="token parameter variable">--inputpath</span> <span class="token string">"/home/gdm/shared/gen_image"</span> <span class="token punctuation">\</span><span class="token parameter variable">--outputpath</span> <span class="token string">"/home/gdm/shared/gen_image/output"</span> <span class="token punctuation">\</span><span class="token parameter variable">--tmppath</span> <span class="token string">"/home/gdm/shared/gen_image/tmp"</span> <span class="token punctuation">\</span><span class="token parameter variable">--config</span> <span class="token string">"genimage.cfg"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="711-issue1"><a class="markdownIt-Anchor" href="#711-issue1"></a> 7.1.1. issue#1</h4><p>执行后报错：</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;bin&#x2F;sh: 1: genext2fs: not found<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>根据提示安装 genext2fs:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> genext2fs<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="72-验证"><a class="markdownIt-Anchor" href="#72-验证"></a> 7.2. 验证</h3><p>我们可以使用 <code>fdisk</code> 工具验证一下生成的 emmc.img:</p><p><img src="Snipaste_2025-11-06_17-06-12.png" alt="" /></p><p>与配置文件中的如出一辙。</p><p><strong>另外我们学习一下在Linux下装载镜像文件：</strong></p><p><code>losetup</code> 命令允许用户将文件映射到循环设备（如/dev/loop0），从而使文件能够被视为块设备。这种方式常用于挂载ISO镜像文件或其他磁盘映像文件，使其可以像真实的磁盘一样进行访问和操作。</p><p>查看循环设备：<code>losetup</code> 或 <code>losetup -a</code> 。</p><ol><li>创建循环设备文件并映射镜像文件：</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">losetup <span class="token parameter variable">-P</span> /dev/loop3 ./emmc.img<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>-P</code> 是指扫描镜像文件分区，创建带有分区的循环设备。</p><ol start="2"><li>查看循环设备信息：</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ls</span> /dev/loop3*输出：/dev/loop3  /dev/loop3p1  /dev/loop3p2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="3"><li>挂载分区1：</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">mount</span> /dev/loop3p1 /mnt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="4"><li>查看文件：</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ls</span> /mnt输出：u-boot-dtb.imx<span class="token function">ls</span> <span class="token parameter variable">-l</span> /mnt输出：total <span class="token number">2</span>-rwxr-xr-x <span class="token number">1</span> root root <span class="token number">5</span> Nov  <span class="token number">7</span>  <span class="token number">2025</span> u-boot-dtb.imx<span class="token function">cat</span> /mnt/u-boot-dtb.imx输出：<span class="token builtin class-name">test</span><span class="token function">sudo</span> <span class="token function">umount</span> /mnt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="5"><li>同理查看分区2：</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">mount</span> /dev/loop3p2 /mnt<span class="token function">ls</span> <span class="token parameter variable">-l</span> /mnt输出：total <span class="token number">27</span>drwxr-xr-x <span class="token number">2</span> gdm  gdm   <span class="token number">3072</span> Nov  <span class="token number">5</span> <span class="token number">18</span>:35 bindrwxr-xr-x <span class="token number">2</span> gdm  gdm   <span class="token number">1024</span> Nov  <span class="token number">5</span> <span class="token number">22</span>:10 bootdrwxr-xr-x <span class="token number">2</span> gdm  gdm   <span class="token number">1024</span> Nov  <span class="token number">6</span> <span class="token number">15</span>:45 devdrwxr-xr-x <span class="token number">2</span> gdm  gdm   <span class="token number">1024</span> Nov  <span class="token number">5</span> <span class="token number">22</span>:01 liblrwxrwxrwx <span class="token number">1</span> gdm  gdm     <span class="token number">11</span> Nov  <span class="token number">5</span> <span class="token number">18</span>:35 linuxrc -<span class="token operator">></span> bin/busyboxdrwx------ <span class="token number">2</span> root root <span class="token number">16384</span> Nov  <span class="token number">6</span> <span class="token number">17</span>:04 lost+founddrwxr-xr-x <span class="token number">2</span> gdm  gdm   <span class="token number">3072</span> Nov  <span class="token number">5</span> <span class="token number">18</span>:35 sbindrwxr-xr-x <span class="token number">4</span> gdm  gdm   <span class="token number">1024</span> Nov  <span class="token number">5</span> <span class="token number">18</span>:35 usr<span class="token function">sudo</span> <span class="token function">umount</span> /mnt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="6"><li>卸除循环设备：</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> losetup <span class="token parameter variable">-d</span> /dev/loop3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;details&gt;
&lt;summary&gt;版权信息&lt;/summary&gt;
&lt;div class=&quot;admonition warning&quot;&gt;&lt;p class=&quot;admonition-title&quot;&gt;warning&lt;/p&gt;&lt;p&gt;本文章为博主原创文章。遵循 &lt;a href=&quot;https://c</summary>
      
    
    
    
    <category term="Linux" scheme="https://blog.godmao.top/categories/Linux/"/>
    
    <category term="系统移植" scheme="https://blog.godmao.top/categories/Linux/%E7%B3%BB%E7%BB%9F%E7%A7%BB%E6%A4%8D/"/>
    
    
    <category term="Linux" scheme="https://blog.godmao.top/Tags/Linux/"/>
    
    <category term="rootfs" scheme="https://blog.godmao.top/Tags/rootfs/"/>
    
    <category term="根文件系统" scheme="https://blog.godmao.top/Tags/%E6%A0%B9%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/"/>
    
    <category term="busybox" scheme="https://blog.godmao.top/Tags/busybox/"/>
    
  </entry>
  
  <entry>
    <title>mx6ull开发版移植nxp官方linux内核</title>
    <link href="https://blog.godmao.top/posts/44016/"/>
    <id>https://blog.godmao.top/posts/44016/</id>
    <published>2025-10-31T07:53:56.000Z</published>
    <updated>2025-11-13T13:13:58.402Z</updated>
    
    <content type="html"><![CDATA[<details><summary>版权信息</summary><div class="admonition warning"><p class="admonition-title">warning</p><p>本文章为博主原创文章。遵循 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh-hans">CC 4.0 BY-SA</a> 版权协议，转载请附上原文出处链接和本声明。</p></div></details><hr /><blockquote><p>基于野火 I.MX6ULL S1 Pro 开发板。</p></blockquote><h2 id="1-获取内核源码"><a class="markdownIt-Anchor" href="#1-获取内核源码"></a> 1. 获取内核源码</h2><p>访问nxp官网：<br /><a href="https://www.nxp.com/design/design-center/software/embedded-software/i-mx-software/embedded-linux-for-i-mx-applications-processors:IMXLINUX">用于 i.MX 应用处理器的嵌入式 Linux |恩智浦半导体 — Embedded Linux for i.MX Applications Processors | NXP Semiconductors</a></p><p>可以看到，截至目前，官方维护版本是：<code>6.6.52_2.2.1</code> ，因此我们基于此内核构建。</p><p><img src="Snipaste_2025-10-31_15-55-24.png" alt="" /></p><p>在官方github库中获取源码：<br /><a href="https://github.com/nxp-imx/linux-imx/releases/tag/lf-6.6.52-2.2.1">Release lf-6.6.52-2.2.1 · nxp-imx/linux-imx</a></p><h2 id="2-编译内核源码"><a class="markdownIt-Anchor" href="#2-编译内核源码"></a> 2. 编译内核源码</h2><p>我是用的是Arm官方工具链<code>arm-none-linux-gnueabihf</code>：<a href="https://developer.arm.com/downloads/-/arm-gnu-toolchain-downloads">Arm GNU Toolchain Downloads – Arm Developer</a></p><p>和uboot源码编译类似：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">make</span> <span class="token assign-left variable">ARCH</span><span class="token operator">=</span>arm <span class="token assign-left variable">CROSS_COMPILE</span><span class="token operator">=</span>arm-none-linux-gnueabihf- distclean <span class="token comment"># 清除编译后的文件</span><span class="token function">make</span> <span class="token assign-left variable">ARCH</span><span class="token operator">=</span>arm <span class="token assign-left variable">CROSS_COMPILE</span><span class="token operator">=</span>arm-none-linux-gnueabihf- imx_v7_defconfig <span class="token comment"># 配置文件</span><span class="token function">make</span> <span class="token assign-left variable">ARCH</span><span class="token operator">=</span>arm <span class="token assign-left variable">CROSS_COMPILE</span><span class="token operator">=</span>arm-none-linux-gnueabihf- <span class="token parameter variable">-j10</span> <span class="token comment"># 10核编译，首次编译时间比较长</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>编译完成会生成：</p><ul><li><strong>zImage</strong>：压缩的内核镜像，位于 <code>arch/arm/boot/zImage</code></li><li><strong>dtb</strong>：设备树文件，位于 <code>arch/arm/boot/dts/nxp/imx/imx6ull-14x14-evk-emmc.dtb</code></li></ul><h2 id="3-测试在uboot中启动"><a class="markdownIt-Anchor" href="#3-测试在uboot中启动"></a> 3. 测试：在uboot中启动</h2><p>请参见——<a href="obsidian://open?vault=_posts&amp;file=mx6ull%E5%BC%80%E5%8F%91%E7%89%88%E7%A7%BB%E6%A4%8Dnxp%E5%AE%98%E6%96%B9u-boot">mx6ull开发版移植nxp官方u-boot</a> 3.2节。</p><blockquote><p>启动成功后，如果EMMC中是没有rootfs的，或者指定了错误的块设备或分区，会提示panic，挂载不了rootfs，这是正常的。</p></blockquote><p>我们可以看到启动日志的第二行：</p><pre class="line-numbers language-none"><code class="language-none">Linux version 6.6.52 (gdm@mDoG)(arm-none-linux-gnueabihf-gcc (Arm GNU Toolchain 14.3.Rel1 (Build arm-14.174)) 14.3.1 20250623,GNU ld (Arm GNU Toolchain 14.3.Rel1 (Build arm-14.174)) 2.44.0.20250616)#1 SMP PREEMPT Fri Oct 31 16:15:58 CST 2025<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>说明这确实是我们编译的内核。</p><h2 id="old4-创建自己的dts文件和config文件"><a class="markdownIt-Anchor" href="#old4-创建自己的dts文件和config文件"></a> [old]4. 创建自己的dts文件和config文件</h2><hr /><blockquote><p>2025.11.11更新：<strong>第四节的内容已不推荐</strong>，不用看了，我现在更倾向直接修改对应的dts文件和defconfig文件，只不过你修改哪个文件，就把哪个文件的官方源文件备份一份，以便恢复。这样简单又方便。</p></blockquote><hr /><details><summary> 内容已被折叠 </summary><h3 id="41-dts"><a class="markdownIt-Anchor" href="#41-dts"></a> 4.1. dts</h3><p>打开 <code>arch/arm/boot/dts/nxp/imx/</code> ，可以看到许多dts文件，我们以<br /><code>imx6ull-14x14-evk.dts</code> 为模板创建，为什么不用 <code>imx6ull-14x14-evk-emmc.dts</code> 呢？查看文件 <code>imx6ull-14x14-evk-emmc.dts</code>：</p><pre class="line-numbers language-none"><code class="language-none">#include &quot;imx6ull-14x14-evk.dts&quot;&amp;usdhc2 &#123;    pinctrl-names &#x3D; &quot;default&quot;, &quot;state_100mhz&quot;, &quot;state_200mhz&quot;;    pinctrl-0 &#x3D; &lt;&amp;pinctrl_usdhc2_8bit&gt;;    pinctrl-1 &#x3D; &lt;&amp;pinctrl_usdhc2_8bit_100mhz&gt;;    pinctrl-2 &#x3D; &lt;&amp;pinctrl_usdhc2_8bit_200mhz&gt;;    bus-width &#x3D; &lt;8&gt;;    non-removable;    status &#x3D; &quot;okay&quot;;&#125;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们发现其实它只是在 <code>imx6ull-14x14-evk.dts</code> 的基础上加了 usdhc2 的修改。<br /><strong>所以我们只需要将这个 &amp;usdhc2 里的内容复制到 <code>imx6ull-14x14-evk.dts</code> 后面就可以了。</strong></p><p>我将自己的配置文件命名为：<code>mx6ull-14x14-evk[gdm-main].dts</code>，表示这是以 <code>imx6ull-14x14-evk.dts</code> 为模板创建的，且是主要文件。因为这个 dts 文件还包含了其他的 dtsi 文件——也就是 dts 的头文件，后续我们如果要修改头文件中的内容，也将头文件复制下来改名作修改，并在 dts 文件中包含这个复制后的头文件，这样可以避免直接修改源文件导致其他的 dts 配置错误（因为头文件不只在一个文件中包含）。</p><p><strong>然后打开 <code>arch/arm/boot/dts/nxp/imx/Makefile</code> 添加 <code>mx6ull-14x14-evk[gdm-main].dtb</code> 的make目标。</strong></p><h3 id="42-defconfig"><a class="markdownIt-Anchor" href="#42-defconfig"></a> 4.2. defconfig</h3><p>同理，以 <code>arch/arm/configs/imx_v7_defconfig</code> 为模板创建。</p><h3 id="43-编译下载启动"><a class="markdownIt-Anchor" href="#43-编译下载启动"></a> 4.3. 编译下载启动</h3><p>重复本篇第2节、第3节的内容。如果 EMMC 里有 rootfs 并正确配置，则可正常启动</p></details><hr /><p style="font-size:30px"> <strong>以下为补充部分</strong></p><hr /><h2 id="5-主频修改"><a class="markdownIt-Anchor" href="#5-主频修改"></a> 5. 主频修改</h2><p>进入到系统后（我的是buildroot）使用以下命令：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> /proc/cpuinfo<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>查看cpu信息输出：</p><pre class="line-numbers language-none"><code class="language-none">processor       : 0model name      : ARMv7 Processor rev 5 (v7l)BogoMIPS        : 24.00Features        : half thumb fastmult vfp edsp neon vfpv3 tls vfpv4 idiva idivt vfpd32 lpaeCPU implementer : 0x41CPU architecture: 7CPU variant     : 0x0CPU part        : 0xc07CPU revision    : 5Hardware        : Freescale i.MX6 Ultralite (Device Tree)Revision        : 0000Serial          : 2f39b9d75d68c574<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>BogoMIPS 这一条，此时 BogoMIPS 为 24.00，BogoMIPS 是 Linux 系统中<br />衡量处理器运行速度的一个“尺子”，处理器性能越强，主频越高，BogoMIPS 值就越大。<br />BogoMIPS 只是粗略的计算 CPU 性能，并不十分准确。</p><p>我们再来看看如何查看工作频率及相关信息。</p><p>进入到目录 <code>/sys/bus/cpu/devices/cpu0/cpufreq</code>:</p><pre class="line-numbers language-none"><code class="language-none">affected_cpus                  scaling_cur_freqcpuinfo_cur_freq               scaling_drivercpuinfo_max_freq               scaling_governorcpuinfo_min_freq               scaling_max_freqcpuinfo_transition_latency     scaling_min_freqrelated_cpus                   scaling_setspeedscaling_available_frequencies  statsscaling_available_governors<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此目录中记录了 CPU 频率等信息，这些文件的含义如下：</p><table><thead><tr><th>目录项</th><th>描述</th></tr></thead><tbody><tr><td>cpuinfo_cur_freq</td><td>当前 cpu 工作频率，从 CPU 寄存器读取到的工作频率。</td></tr><tr><td>cpuinfo_max_freq</td><td>处理器所能运行的最高工作频率(单位: KHz）。</td></tr><tr><td>cpuinfo_min_freq</td><td>处理器所能运行的最低工作频率(单位: KHz）。</td></tr><tr><td>cpuinfo_transition_latency</td><td>处理器切换频率所需要的时间(单位:ns)。</td></tr><tr><td>scaling_available_frequencies</td><td>处理器支持的主频率列表(单位: KHz）。</td></tr><tr><td>scaling_available_governors</td><td>当前内核中支持的所有 governor(调频)类型。</td></tr><tr><td>scaling_cur_freq</td><td>保存着 cpufreq 模块缓存的当前 CPU 频率，不会对 CPU 硬件寄存器进行检查。</td></tr><tr><td>scaling_driver</td><td>该文件保存当前 CPU 所使用的调频驱动。</td></tr><tr><td>scaling_max_freq</td><td>governor(调频)可以调节的最高频率。</td></tr><tr><td>cpuinfo_min_freq</td><td>governor(调频)可以调节的最低频率。</td></tr></tbody></table><p>此外还有：</p><ul><li><p><strong>scaling_governor</strong>：governor(调频)策略，Linux 内核一共有 5 中调频策略，</p><ol><li><code>Performance</code>：最高性能，直接用最高频率，不考虑耗电。</li><li><code>Interactive</code>：一开始直接用最高频率，然后根据 CPU 负载慢慢降低。</li><li><code>Powersave</code>：省电模式，通常以最低频率运行，系统性能会受影响，一般不会用这个！</li><li><code>Userspace</code>：可以在用户空间手动调节频率。</li><li><code>Ondemand</code>，：定时检查负载，然后根据负载来调节频率。负载低的时候降低 CPU 频率，这样省电，负载高的时候提高 CPU 频率，增加性能。</li></ol></li><li><p><strong>stats</strong> 目录下给出了 CPU 各种运行频率的统计情况，比如 CPU 在各频率下的运行时间及变频次数。</p></li></ul><p>使用命令查看各参数的值：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token punctuation">[</span>目录项<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>会发现当前调度模式是 <code>Ondemand</code>。</p><p>如果我想让我们的板子一直满血运行，怎么做？我们只需图形化配置defconfig文件。</p><p>进入到 kernel 源码目录，使用命令打开图形化配置文件：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">make</span> menuconfig<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="Snipaste_2025-10-31_23-08-34.png" alt="" /></p><p>进入 <code>CPU Power Management</code>-&gt; <code>CPU Frequency scaling</code>-&gt; <code>Default CPUFreq governor</code> ，选择performance，再次编译（不用distclean清理），再传进开发板。</p><p>再次查看就可以发现：</p><p><img src="Snipaste_2025-10-31_23-15-11.png" alt="" /></p><p><strong>当然日常使用还是 <code>Ondemand</code> 更好，所以我还是换回 <code>Ondemand</code> 了。</strong></p><p>至此，我们以修改主频为引，介绍了如何调试修改配置文件并应用修改。</p><p>–end–</p><h2 id="6-系统网络测试"><a class="markdownIt-Anchor" href="#6-系统网络测试"></a> 6. 系统网络测试</h2><p>野火的板子PHY芯片使用的和nxp官方的一样，因此直接适配nxp官方linux内核，不用修改设备树文件，所以这里讲一下网络测试。</p><p>进入到系统后，默认是没有启用任何一个网络驱动设备的，使用 <code>ifconfig</code> 命令可能只会显示一个“loc”。所以我们输入命令查看所有的网络驱动设备：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ifconfig</span> <span class="token parameter variable">-a</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>输出：</p><p><img src="Snipaste_2025-11-02_18-29-44.png" alt="" /></p><p>我通过MAC地址分辨出我应该启用的是 <code>eth0</code> 它正通过网线连接着我的电脑，输入命令：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ifconfig</span> eth0 up<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>启用后，我们通过 <code>ifconfig</code> 命令就能查看到这个设备了。但是这个网卡都还没<br />有 IP 地址，所以不能进行 ping 等操作。</p><p>所以我们为其分配 ip 地址：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ifconfig</span> eth0 <span class="token number">192.168</span>.137.145<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>现在就能 ping 通我的电脑了。<br />我的电脑以太网卡 ip 地址为 192.168.137.1：</p><p><img src="Snipaste_2025-11-02_18-38-02.png" alt="" /></p>]]></content>
    
    
      
      
    <summary type="html">&lt;details&gt;
&lt;summary&gt;版权信息&lt;/summary&gt;
&lt;div class=&quot;admonition warning&quot;&gt;&lt;p class=&quot;admonition-title&quot;&gt;warning&lt;/p&gt;&lt;p&gt;本文章为博主原创文章。遵循 &lt;a href=&quot;https://c</summary>
      
    
    
    
    <category term="Linux" scheme="https://blog.godmao.top/categories/Linux/"/>
    
    <category term="系统移植" scheme="https://blog.godmao.top/categories/Linux/%E7%B3%BB%E7%BB%9F%E7%A7%BB%E6%A4%8D/"/>
    
    
    <category term="Linux" scheme="https://blog.godmao.top/Tags/Linux/"/>
    
    <category term="内核移植" scheme="https://blog.godmao.top/Tags/%E5%86%85%E6%A0%B8%E7%A7%BB%E6%A4%8D/"/>
    
  </entry>
  
  <entry>
    <title>mx6ull开发版移植nxp官方u-boot</title>
    <link href="https://blog.godmao.top/posts/26288/"/>
    <id>https://blog.godmao.top/posts/26288/</id>
    <published>2025-10-29T08:25:32.000Z</published>
    <updated>2025-11-06T10:42:21.504Z</updated>
    
    <content type="html"><![CDATA[<details><summary>版权信息</summary><div class="admonition warning"><p class="admonition-title">warning</p><p>本文章为博主原创文章。遵循 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh-hans">CC 4.0 BY-SA</a> 版权协议，转载请附上原文出处链接和本声明。</p></div></details><hr /><h2 id="1-我写尼玛"><a class="markdownIt-Anchor" href="#1-我写尼玛"></a> 1. 我写尼玛！</h2><p>我他妈直接不想码字。<br />我他妈直接转载。</p><p><strong>移植和烧录部分：</strong><br />作者：觉皇嵌入式 遵循 <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC 4.0 BY-SA</a> 版权协议。<br /><a href="https://blog.csdn.net/qq153471503/article/details/126587387">i.MX6ULL - 从零开始移植uboot-imx_v2020.04_5.4.70_2.3.0-CSDN博客</a></p><hr /><blockquote><p><strong>以下为后续补充</strong></p></blockquote><h2 id="2-图形化配置"><a class="markdownIt-Anchor" href="#2-图形化配置"></a> 2. 图形化配置</h2><p>在uboot目录下，使用命令：</p><pre class="line-numbers language-none"><code class="language-none">make menuconfig<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>可以通过图形化界面配置uboot，更加直观。</p><h2 id="3-u-boot-启动linux测试"><a class="markdownIt-Anchor" href="#3-u-boot-启动linux测试"></a> 3. U-boot 启动Linux测试</h2><h3 id="31-从emmc启动emmc里有原厂自带文件"><a class="markdownIt-Anchor" href="#31-从emmc启动emmc里有原厂自带文件"></a> 3.1. 从EMMC启动（EMMC里有原厂自带文件）</h3><h4 id="311-查看"><a class="markdownIt-Anchor" href="#311-查看"></a> 3.1.1. 查看</h4><p>首先检查EMMC里面是否有——Linux镜像zImage、.dtb文件和根文件系统。</p><p>我们当前的mmc环境是SD卡，切换到EMMC。输入命令：</p><pre class="line-numbers language-none"><code class="language-none">mmc dev 1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>具体EMMC的设备号 根据实际情况输入。</p></blockquote><p>该开发板EMMC分区是这样的：</p><ul><li>分区0：是存放boot的，</li><li>分区1：存放linux镜像和设备树，</li><li>分区2：存放root。</li></ul><blockquote><p>可以使用 <code>fstype mmc dev:part</code> 命令查看文件系统格式。<br />其中 dev是EMMC的设备号，part是分区号。运行后：<br />分区0输出 <code>Unrecognized...</code>；<br />分区1输出 <code>fat</code> ；分区2输出 <code>ext4</code>。</p></blockquote><p>分区1使用的文件系统是FAT，因此用 <code>fatls</code> 查看EMMC分区1里面的文件：</p><pre class="line-numbers language-none"><code class="language-none">fatls mmc dev:part<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>输出：</p><pre class="line-numbers language-none"><code class="language-none">7863120   zImage    38733   imx6ull-mmc-npi-lite.dtb2 file(s), 0 dir(s)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>说明系统和设备树是存在的。</p><h4 id="312-加载系统相关命令"><a class="markdownIt-Anchor" href="#312-加载系统相关命令"></a> 3.1.2. 加载系统相关命令</h4><ul><li><p><strong>查看指定的镜像加载地址：</strong></p><p><code>printenv loadaddr</code></p><p>输出为 <code>0x80800000</code></p></li><li><p><strong>查看指定的设备树加载地址：</strong></p><p><code>printenv fdt_addr</code></p><p>输出为 <code>0x83000000</code></p></li><li><p><strong>把zImage加载到地址 <code>0x80800000</code>：</strong></p><p><code>fatload mmc 1:1 80800000 zImage</code></p></li><li><p><strong>把设备树加载到地址 <code>0x83000000</code></strong>：</p><p><code>fatload mmc 1:1 83000000 imx6ull-mmc-npi-lite.dtb</code></p></li><li><p><strong>启动内核：</strong><br /><code>bootz 80800000 - 83000000</code></p></li></ul><h4 id="313-设置bootcmd"><a class="markdownIt-Anchor" href="#313-设置bootcmd"></a> 3.1.3. 设置bootcmd</h4><p><code>bootcmd</code> 是一个环境变量，保存着 uboot 默认命令，uboot 倒计时结束以后就会执行 bootcmd 中的命令。这些命令一般都是用来启动 Linux 内核的，比如读取 EMMC 或者 NAND Flash 中的 Linux 内核镜像文件和设备树文件到 DRAM 中，然后启动 Linux 内核。</p><pre class="line-numbers language-none"><code class="language-none">setenv bootcmd &#39;mmc dev 1; fatload mmc 1:1 80800000 zImage; fatload mmc 1:1 83000000 imx6ull-mmc-npi-lite.dtb; bootz 80800000 - 83000000;&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="314-设置bootargs"><a class="markdownIt-Anchor" href="#314-设置bootargs"></a> 3.1.4. 设置bootargs</h4><details><summary> 关于bootargs的介绍有点长，折叠一下。</summary><p>bootargs 保存着 uboot 传递给 Linux 内核的参数，bootargs 环境变量是由 mmcargs 设置的，mmcargs 环境变量如下：<br /><code>mmcargs=setenv bootargs console=$&#123;console&#125;,$&#123;baudrate&#125; root=$&#123;mmcroot&#125;</code></p><p>其中 console=ttymxc0，baudrate=115200，mmcroot=/dev/mmcblk0p2 rootwait rw，</p><p>因此将mmcargs 展开以后就是：<br /><code>mmcargs=setenv bootargs console= ttymxc0, 115200 root= /dev/mmcblk0p2 rootwait rw</code></p><p>可以看出环境变量 mmcargs 就是设置 bootargs 的值为<code>console= ttymxc0, 115200 root=/dev/mmcblk1p2 rootwait rw</code>，</p><p>bootargs 就是设置了很多的参数的值，这些参数 Linux 内核会使用到，常用的参数有：</p><ul><li><strong>console：</strong><br />console 用来设置 linux 终端(或者叫控制台)，也就是通过什么设备来和 Linux 进行交互，例如串口、 LCD 屏幕。如果是串口的话应该是串口几、波特率等。一般设置串口作为 Linux 终端，这样我们就可以在电脑上通过串口程序来和 linux 交互了。这里设置 console 为 ttymxc0，因为 linux启动以后 I.MX6ULL 的串口 1 在 linux 下的设备文件就是/dev/ttymxc0，”一切皆文件“。</li><li><strong>root：</strong><br />root 用来设置根文件系统的位置，例如，<code>root=/dev/mmcblk1p2</code> 指根文件系统存放在 mmcblk1 设备的分区 2 中。<br /><code>rootwait rw</code>。rootwait 表示等待 mmc 设备初始化完成以后再挂载，否则的话mmc 设备还没初始化完成就挂载根文件系统会出错的。rw 表示根文件系统是可以读写的，不加 rw 的话可能无法在根文件系统中进行写操作，只能进行读操作。</li><li><strong>rootfstype：</strong><br />此选项一般配置 root 一起使用，rootfstype 用于指定根文件系统类型，如果根文件系统为ext 格式的话此选项无所谓。如果根文件系统是 yaffs、jffs 或 ubifs 的话就需要设置此选项，指定根文件系统的类型。</li></ul></details><p>设置：</p><pre class="line-numbers language-none"><code class="language-none">setenv bootargs &#39;console&#x3D;ttymxc0,115200 root&#x3D;&#x2F;dev&#x2F;mmcblk1p2 rootwait rw&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="315-启动"><a class="markdownIt-Anchor" href="#315-启动"></a> 3.1.5. 启动</h4><p>使用命令 <code>run bootcmd</code> 或 在切换到EMMC环境后直接输入<code>boot</code>。</p><h3 id="32-从网络启动"><a class="markdownIt-Anchor" href="#32-从网络启动"></a> 3.2. 从网络启动</h3><h4 id="321-安装-tftpd-hpa-和客户端工具"><a class="markdownIt-Anchor" href="#321-安装-tftpd-hpa-和客户端工具"></a> 3.2.1. 安装 tftpd-hpa 和客户端工具</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> update<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> tftpd-hpa tftp-hpa<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="322-创建共享目录并开放权限"><a class="markdownIt-Anchor" href="#322-创建共享目录并开放权限"></a> 3.2.2. 创建共享目录并开放权限</h4><p>TFTP 的默认根目录是 <code>/srv/tftp</code>，你也可以改成别的：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /srv/tftp<span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">777</span> /srv/tftp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>然后把要传的文件（比如 <code>uImage</code>）放进去：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cp</span> ~/uImage /srv/tftp/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="323-手动启动-tftp-服务因为没有-systemctl"><a class="markdownIt-Anchor" href="#323-手动启动-tftp-服务因为没有-systemctl"></a> 3.2.3. 手动启动 TFTP 服务（因为没有 systemctl）</h4><p>直接运行：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> /usr/sbin/in.tftpd <span class="token parameter variable">--foreground</span> <span class="token parameter variable">--secure</span> <span class="token parameter variable">--verbose</span> /srv/tftp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>–foreground：在前台运行</li><li>–secure：只允许访问指定目录</li><li>–verbose：打印详细日志</li></ul><blockquote><p>还有一些选项，例如：<br />–address <a href="ip:port">ip:port</a>：指定 TFTP 服务监听的 IP 地址和端口。<br />–blocksize &lt;大小&gt;：指定一个数据包的大小。<br />–create：允许客户端上传。</p></blockquote><p>这会在前台启动服务器（按 <code>Ctrl+C</code> 可停止）。</p><p>如果你想让它<strong>后台运行</strong>：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> /usr/sbin/in.tftpd <span class="token parameter variable">--secure</span> /srv/tftp <span class="token operator">&amp;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="324-确认服务在监听-udp-69-端口"><a class="markdownIt-Anchor" href="#324-确认服务在监听-udp-69-端口"></a> 3.2.4. 确认服务在监听 UDP 69 端口</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">netstat</span> <span class="token parameter variable">-anu</span> <span class="token operator">|</span> <span class="token function">grep</span> :69<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>或者：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> ss <span class="token parameter variable">-anu</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token number">69</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>出现类似：</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx">udp   UNCONN  0      0      0.0.0.0:69    0.0.0.0:*<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>说明启动成功。</p><h4 id="325-让-u-boot-能访问-wsl-的-ip"><a class="markdownIt-Anchor" href="#325-让-u-boot-能访问-wsl-的-ip"></a> 3.2.5. 让 U-Boot 能访问 WSL 的 IP</h4><p>这是关键部分。<br />WSL 和 Windows 的网络是<strong>桥接但不完全共享的</strong>，所以开发板不能直接访问 <code>127.0.0.1</code> 或 <code>localhost</code>。</p><ol><li>在 Windows 里执行：</li></ol><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">ipconfig<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>找到 <strong>以太网适配器 vEthernet (WSL)</strong> 这一项。<br />它通常是类似 <code>172.25.x.x</code> 或 <code>192.168.137.x</code> 的 IP，比如：</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx">IPv4 Address. . . . . . . . . . . : 172.27.240.1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>在 U-Boot 里设置：</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">setenv serverip <span class="token number">192.168</span>.137.1setenv ipaddr <span class="token number">192.168</span>.137.144<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="3"><li><p>关闭防火墙：<br />在设置——网络与Internet——高级网络设置——Windows防火墙，将公用网络中的防火墙暂时关闭。</p></li><li><p>测试：</p></li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ping</span> <span class="token number">192.168</span>.137.1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果显示 “host is alive”，说明连通。</p><h4 id="326-传文件"><a class="markdownIt-Anchor" href="#326-传文件"></a> 3.2.6. 传文件</h4><p>假设你要下载 <code>/srv/tftp/uImage</code> 到内存地址 <code>0x80800000</code>：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">tftp 0x80800000 uImage<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>看到类似输出：</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">Using</span> FEC deviceTFTP from server 172.27.240.1</span><span class="token punctuation">;</span> our IP address is 172.27.240.166Filename 'uImage'.Load address: 0x80800000Loading: <span class="token comment">#########################################</span>doneBytes transferred = 3456789 (34abcd hex)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>就成功了！</p>]]></content>
    
    
      
      
    <summary type="html">&lt;details&gt;
&lt;summary&gt;版权信息&lt;/summary&gt;
&lt;div class=&quot;admonition warning&quot;&gt;&lt;p class=&quot;admonition-title&quot;&gt;warning&lt;/p&gt;&lt;p&gt;本文章为博主原创文章。遵循 &lt;a href=&quot;https://c</summary>
      
    
    
    
    <category term="Linux" scheme="https://blog.godmao.top/categories/Linux/"/>
    
    <category term="系统移植" scheme="https://blog.godmao.top/categories/Linux/%E7%B3%BB%E7%BB%9F%E7%A7%BB%E6%A4%8D/"/>
    
    
    <category term="Linux" scheme="https://blog.godmao.top/Tags/Linux/"/>
    
    <category term="u-boot移植" scheme="https://blog.godmao.top/Tags/u-boot%E7%A7%BB%E6%A4%8D/"/>
    
  </entry>
  
  <entry>
    <title>大蟒蛇-typer库</title>
    <link href="https://blog.godmao.top/posts/40650/"/>
    <id>https://blog.godmao.top/posts/40650/</id>
    <published>2025-10-28T13:11:11.000Z</published>
    <updated>2025-10-28T14:28:40.778Z</updated>
    
    <content type="html"><![CDATA[<details><summary>版权信息</summary><div class="admonition warning"><p class="admonition-title">warning</p><p>本文章为博主原创文章。遵循 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh-hans">CC 4.0 BY-SA</a> 版权协议，转载请附上原文出处链接和本声明。</p></div></details><hr /><h2 id="一-安装"><a class="markdownIt-Anchor" href="#一-安装"></a> 一、安装</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> typer<span class="token punctuation">[</span>all<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>[all]</code> 会额外安装颜色和补全功能（推荐）。</p><h2 id="二-最简单的例子"><a class="markdownIt-Anchor" href="#二-最简单的例子"></a> 二、最简单的例子</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> typer<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    typer<span class="token punctuation">.</span>echo<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Hello </span><span class="token interpolation"><span class="token punctuation">&#123;</span>name<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    typer<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>运行：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python3 app.py gdm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>输出：</p><pre class="line-numbers language-none"><code class="language-none">Hello gdm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Typer 会自动解析命令行参数并生成帮助：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python3 app.py <span class="token parameter variable">--help</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">Usage: app.py [OPTIONS] NAMEArguments:  NAME  [required]Options:  --help  Show this message and exit.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="三-带类型提示的参数解析"><a class="markdownIt-Anchor" href="#三-带类型提示的参数解析"></a> 三、带类型提示的参数解析</h2><p>Typer 会根据<strong>Python 类型注解</strong>自动转换输入：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> active<span class="token punctuation">:</span> <span class="token builtin">bool</span> <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    typer<span class="token punctuation">.</span>echo<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Name: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>name<span class="token punctuation">&#125;</span></span><span class="token string">, Age: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>age<span class="token punctuation">&#125;</span></span><span class="token string">, Active: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>active<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    typer<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>执行：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python3 app.py gdm <span class="token number">25</span> <span class="token parameter variable">--active</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>或关闭 active：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python3 app.py gdm <span class="token number">25</span> --no-active<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="四-使用选项options"><a class="markdownIt-Anchor" href="#四-使用选项options"></a> 四、使用选项（Options）</h2><p>如果你希望某个参数是可选的、带前缀的选项，可以用 <code>typer.Option</code>。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> typer<span class="token punctuation">.</span>Option<span class="token punctuation">(</span><span class="token string">"World"</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"名字"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> repeat<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> typer<span class="token punctuation">.</span>Option<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"重复次数"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>repeat<span class="token punctuation">)</span><span class="token punctuation">:</span>        typer<span class="token punctuation">.</span>echo<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Hello </span><span class="token interpolation"><span class="token punctuation">&#123;</span>name<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    typer<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>运行：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python3 app.py <span class="token parameter variable">--name</span> gdm <span class="token parameter variable">--repeat</span> <span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="五-使用参数arguments"><a class="markdownIt-Anchor" href="#五-使用参数arguments"></a> 五、使用参数（Arguments）</h2><p><code>typer.Argument()</code> 用于定义<strong>位置参数</strong>，即必需参数。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>filename<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> typer<span class="token punctuation">.</span>Argument<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"文件路径"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    typer<span class="token punctuation">.</span>echo<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Processing file: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>filename<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    typer<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>...</code> 表示必须提供。</p><p>示例：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python3 app.py data.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="六-命令分组多个子命令"><a class="markdownIt-Anchor" href="#六-命令分组多个子命令"></a> 六、命令分组（多个子命令）</h2><p>你可以像写 Git 一样定义多命令结构。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> typerapp <span class="token operator">=</span> typer<span class="token punctuation">.</span>Typer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>command</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    typer<span class="token punctuation">.</span>echo<span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>command</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">sub</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    typer<span class="token punctuation">.</span>echo<span class="token punctuation">(</span>a <span class="token operator">-</span> b<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    app<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>运行：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python3 app.py <span class="token function">add</span> <span class="token number">3</span> <span class="token number">5</span>python3 app.py sub <span class="token number">10</span> <span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>帮助信息：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python3 app.py <span class="token parameter variable">--help</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">Commands:  add  sub<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="七-默认命令入口函数"><a class="markdownIt-Anchor" href="#七-默认命令入口函数"></a> 七、默认命令（入口函数）</h2><p>如果只定义一个命令，也可以这样写：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> typerapp <span class="token operator">=</span> typer<span class="token punctuation">.</span>Typer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>command</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">greet</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    typer<span class="token punctuation">.</span>echo<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Hi </span><span class="token interpolation"><span class="token punctuation">&#123;</span>name<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    app<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="八-提示输入prompt"><a class="markdownIt-Anchor" href="#八-提示输入prompt"></a> 八、提示输入（Prompt）</h2><p>Typer 支持交互式输入：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>password<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> typer<span class="token punctuation">.</span>Option<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> prompt<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> hide_input<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    typer<span class="token punctuation">.</span>echo<span class="token punctuation">(</span><span class="token string">"Password received!"</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    typer<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>运行后会提示输入密码而不回显。</p><h2 id="九-颜色输出"><a class="markdownIt-Anchor" href="#九-颜色输出"></a> 九、颜色输出</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python">typer<span class="token punctuation">.</span>secho<span class="token punctuation">(</span><span class="token string">"成功!"</span><span class="token punctuation">,</span> fg<span class="token operator">=</span>typer<span class="token punctuation">.</span>colors<span class="token punctuation">.</span>GREEN<span class="token punctuation">,</span> bold<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>typer<span class="token punctuation">.</span>secho<span class="token punctuation">(</span><span class="token string">"警告!"</span><span class="token punctuation">,</span> fg<span class="token operator">=</span>typer<span class="token punctuation">.</span>colors<span class="token punctuation">.</span>YELLOW<span class="token punctuation">)</span>typer<span class="token punctuation">.</span>secho<span class="token punctuation">(</span><span class="token string">"错误!"</span><span class="token punctuation">,</span> fg<span class="token operator">=</span>typer<span class="token punctuation">.</span>colors<span class="token punctuation">.</span>RED<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="十-退出与错误"><a class="markdownIt-Anchor" href="#十-退出与错误"></a> 十、退出与错误</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> error<span class="token punctuation">:</span>    typer<span class="token punctuation">.</span>echo<span class="token punctuation">(</span><span class="token string">"Something went wrong."</span><span class="token punctuation">)</span>    <span class="token keyword">raise</span> typer<span class="token punctuation">.</span>Exit<span class="token punctuation">(</span>code<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>或：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">typer<span class="token punctuation">.</span>Abort<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 相当于 Ctrl+C</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="十一-自动补全"><a class="markdownIt-Anchor" href="#十一-自动补全"></a> 十一、自动补全</h2><p>为终端安装 Typer 补全脚本：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">app --install-completion<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后重启终端。</p><h2 id="十二-复杂结构嵌套命令"><a class="markdownIt-Anchor" href="#十二-复杂结构嵌套命令"></a> 十二、复杂结构（嵌套命令）</h2><p>可以创建多个 <code>Typer</code> 实例，并注册子命令模块：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> typerapp <span class="token operator">=</span> typer<span class="token punctuation">.</span>Typer<span class="token punctuation">(</span><span class="token punctuation">)</span>user_app <span class="token operator">=</span> typer<span class="token punctuation">.</span>Typer<span class="token punctuation">(</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span>add_typer<span class="token punctuation">(</span>user_app<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@user_app<span class="token punctuation">.</span>command</span><span class="token punctuation">(</span><span class="token string">"create"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">create_user</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    typer<span class="token punctuation">.</span>echo<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Created user: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>name<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    app<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>运行：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python app.py user create gdm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="十三-与click兼容"><a class="markdownIt-Anchor" href="#十三-与click兼容"></a> 十三、与Click兼容</h2><p>Typer 基于 Click，可以混用 Click 的函数：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> typer<span class="token keyword">import</span> click<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>command</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@click<span class="token punctuation">.</span>option</span><span class="token punctuation">(</span><span class="token string">"--debug/--no-debug"</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>debug<span class="token punctuation">)</span><span class="token punctuation">:</span>    typer<span class="token punctuation">.</span>echo<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Debug = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>debug<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="十四-完整示例"><a class="markdownIt-Anchor" href="#十四-完整示例"></a> 十四、完整示例</h2><p>一个带颜色、帮助信息、命令组、选项的综合例子：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> typerapp <span class="token operator">=</span> typer<span class="token punctuation">.</span>Typer<span class="token punctuation">(</span><span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"一个简单的文件处理工具"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>command</span><span class="token punctuation">(</span><span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"读取文件内容"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        typer<span class="token punctuation">.</span>echo<span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>command</span><span class="token punctuation">(</span><span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"统计文件行数"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    lines <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    typer<span class="token punctuation">.</span>secho<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">file</span><span class="token punctuation">&#125;</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>lines<span class="token punctuation">&#125;</span></span><span class="token string"> lines"</span></span><span class="token punctuation">,</span> fg<span class="token operator">=</span>typer<span class="token punctuation">.</span>colors<span class="token punctuation">.</span>GREEN<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    app<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;details&gt;
&lt;summary&gt;版权信息&lt;/summary&gt;
&lt;div class=&quot;admonition warning&quot;&gt;&lt;p class=&quot;admonition-title&quot;&gt;warning&lt;/p&gt;&lt;p&gt;本文章为博主原创文章。遵循 &lt;a href=&quot;https://c</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>大蟒蛇-rich库</title>
    <link href="https://blog.godmao.top/posts/30447/"/>
    <id>https://blog.godmao.top/posts/30447/</id>
    <published>2025-10-28T13:10:46.000Z</published>
    <updated>2025-10-28T14:08:58.528Z</updated>
    
    <content type="html"><![CDATA[<details><summary>版权信息</summary><div class="admonition warning"><p class="admonition-title">warning</p><p>本文章为博主原创文章。遵循 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh-hans">CC 4.0 BY-SA</a> 版权协议，转载请附上原文出处链接和本声明。</p></div></details><hr /><h2 id="rich-库新手使用指南"><a class="markdownIt-Anchor" href="#rich-库新手使用指南"></a> 🪶 Rich 库新手使用指南</h2><p><code>Rich</code> 是一个超强的 Python 库，用来让终端输出变得<strong>漂亮、有色彩、有格式</strong>。<br />它可以显示<strong>彩色文字、表格、进度条、Markdown、高亮代码、日志信息</strong>等。</p><p>安装非常简单：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> rich<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>导入方式：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> rich <span class="token keyword">import</span> <span class="token keyword">print</span><span class="token keyword">from</span> rich<span class="token punctuation">.</span>console <span class="token keyword">import</span> Console<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="一-彩色输出基础"><a class="markdownIt-Anchor" href="#一-彩色输出基础"></a> 一、彩色输出基础</h3><p>Rich 自带的 <code>print</code> 可以直接使用类似 BBCode 的标签上色。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> rich <span class="token keyword">import</span> <span class="token keyword">print</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[bold red]错误：[/bold red] 文件未找到！"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[green]任务完成！[/green]"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[yellow on black]警告：内存不足[/yellow on black]"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>[color]文字[/color]</code><br />支持样式如：<code>bold</code>, <code>italic</code>, <code>underline</code>, <code>red</code>, <code>green</code>, <code>blue</code>, <code>on color</code>, <code>blink</code> 等。</p><h3 id="二-使用-console-对象更灵活"><a class="markdownIt-Anchor" href="#二-使用-console-对象更灵活"></a> 二、使用 Console 对象（更灵活）</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> rich<span class="token punctuation">.</span>console <span class="token keyword">import</span> Consoleconsole <span class="token operator">=</span> Console<span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"普通输出"</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[bold magenta]高亮输出[/bold magenta]"</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token string">"这是带时间戳的日志输出"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="三-打印表格"><a class="markdownIt-Anchor" href="#三-打印表格"></a> 三、打印表格</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> rich<span class="token punctuation">.</span>console <span class="token keyword">import</span> Console<span class="token keyword">from</span> rich<span class="token punctuation">.</span>table <span class="token keyword">import</span> Tabletable <span class="token operator">=</span> Table<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">"学生成绩"</span><span class="token punctuation">)</span>table<span class="token punctuation">.</span>add_column<span class="token punctuation">(</span><span class="token string">"姓名"</span><span class="token punctuation">,</span> style<span class="token operator">=</span><span class="token string">"cyan"</span><span class="token punctuation">,</span> no_wrap<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>table<span class="token punctuation">.</span>add_column<span class="token punctuation">(</span><span class="token string">"科目"</span><span class="token punctuation">,</span> style<span class="token operator">=</span><span class="token string">"magenta"</span><span class="token punctuation">)</span>table<span class="token punctuation">.</span>add_column<span class="token punctuation">(</span><span class="token string">"分数"</span><span class="token punctuation">,</span> justify<span class="token operator">=</span><span class="token string">"right"</span><span class="token punctuation">,</span> style<span class="token operator">=</span><span class="token string">"green"</span><span class="token punctuation">)</span>table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token string">"张三"</span><span class="token punctuation">,</span> <span class="token string">"数学"</span><span class="token punctuation">,</span> <span class="token string">"88"</span><span class="token punctuation">)</span>table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token string">"李四"</span><span class="token punctuation">,</span> <span class="token string">"英语"</span><span class="token punctuation">,</span> <span class="token string">"93"</span><span class="token punctuation">)</span>table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token string">"王五"</span><span class="token punctuation">,</span> <span class="token string">"物理"</span><span class="token punctuation">,</span> <span class="token string">"75"</span><span class="token punctuation">)</span>console <span class="token operator">=</span> Console<span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token keyword">print</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输出：彩色、有边框的漂亮表格。</p><h3 id="四-进度条"><a class="markdownIt-Anchor" href="#四-进度条"></a> 四、进度条</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> time<span class="token keyword">from</span> rich<span class="token punctuation">.</span>progress <span class="token keyword">import</span> track<span class="token keyword">for</span> i <span class="token keyword">in</span> track<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> description<span class="token operator">=</span><span class="token string">"[cyan]正在处理..."</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>它会在终端显示一个动态进度条，非常直观。</p><h3 id="五-打印-markdown-文本"><a class="markdownIt-Anchor" href="#五-打印-markdown-文本"></a> 五、打印 Markdown 文本</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> rich<span class="token punctuation">.</span>console <span class="token keyword">import</span> Console<span class="token keyword">from</span> rich<span class="token punctuation">.</span>markdown <span class="token keyword">import</span> Markdownmd <span class="token operator">=</span> Markdown<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""# 标题- 支持列表- **加粗**- *斜体*"""</span><span class="token punctuation">)</span>console <span class="token operator">=</span> Console<span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token keyword">print</span><span class="token punctuation">(</span>md<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="六-代码高亮"><a class="markdownIt-Anchor" href="#六-代码高亮"></a> 六、代码高亮</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> rich<span class="token punctuation">.</span>console <span class="token keyword">import</span> Console<span class="token keyword">from</span> rich<span class="token punctuation">.</span>syntax <span class="token keyword">import</span> Syntaxcode <span class="token operator">=</span> <span class="token triple-quoted-string string">'''def hello():    print("Hello, world!")'''</span>syntax <span class="token operator">=</span> Syntax<span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token string">"python"</span><span class="token punctuation">,</span> theme<span class="token operator">=</span><span class="token string">"monokai"</span><span class="token punctuation">,</span> line_numbers<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>console <span class="token operator">=</span> Console<span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token keyword">print</span><span class="token punctuation">(</span>syntax<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="七-日志与追踪"><a class="markdownIt-Anchor" href="#七-日志与追踪"></a> 七、日志与追踪</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> rich<span class="token punctuation">.</span>console <span class="token keyword">import</span> Console<span class="token keyword">from</span> rich<span class="token punctuation">.</span>traceback <span class="token keyword">import</span> installinstall<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 让报错显示彩色堆栈</span>console <span class="token operator">=</span> Console<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">divide</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> a <span class="token operator">/</span> bdivide<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># 会输出带颜色的错误信息</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="八-组合示例多种元素一起展示"><a class="markdownIt-Anchor" href="#八-组合示例多种元素一起展示"></a> 八、组合示例：多种元素一起展示</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> rich<span class="token punctuation">.</span>console <span class="token keyword">import</span> Console<span class="token keyword">from</span> rich<span class="token punctuation">.</span>table <span class="token keyword">import</span> Table<span class="token keyword">from</span> rich<span class="token punctuation">.</span>progress <span class="token keyword">import</span> track<span class="token keyword">from</span> time <span class="token keyword">import</span> sleepconsole <span class="token operator">=</span> Console<span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span>rule<span class="token punctuation">(</span><span class="token string">"[bold green]Rich 示例"</span><span class="token punctuation">)</span>table <span class="token operator">=</span> Table<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">"任务状态"</span><span class="token punctuation">)</span>table<span class="token punctuation">.</span>add_column<span class="token punctuation">(</span><span class="token string">"任务名"</span><span class="token punctuation">,</span> style<span class="token operator">=</span><span class="token string">"cyan"</span><span class="token punctuation">)</span>table<span class="token punctuation">.</span>add_column<span class="token punctuation">(</span><span class="token string">"状态"</span><span class="token punctuation">,</span> style<span class="token operator">=</span><span class="token string">"magenta"</span><span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> track<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> description<span class="token operator">=</span><span class="token string">"[yellow]执行任务中..."</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    sleep<span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span>    table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"任务</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> <span class="token string">"完成"</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token keyword">print</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span>console<span class="token punctuation">.</span>rule<span class="token punctuation">(</span><span class="token string">"[bold blue]执行结束"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="九-常见功能速览"><a class="markdownIt-Anchor" href="#九-常见功能速览"></a> 九、常见功能速览</h3><table><thead><tr><th>功能</th><th>模块</th><th>示例</th></tr></thead><tbody><tr><td>彩色文本</td><td>rich.print</td><td>[red]Error[/red]</td></tr><tr><td>表格</td><td>rich.table.Table</td><td>美观的表格输出</td></tr><tr><td>进度条</td><td>rich.progress</td><td>track()</td></tr><tr><td>Markdown</td><td>rich.markdown.Markdown</td><td>渲染 Markdown</td></tr><tr><td>代码高亮</td><td>rich.syntax.Syntax</td><td>高亮 Python 等代码</td></tr><tr><td>日志输出</td><td>console.log()</td><td>彩色时间戳日志</td></tr><tr><td>彩色错误追踪</td><td>rich.traceback.install()</td><td>让异常更清晰</td></tr></tbody></table><h2 id="rich-进阶组件使用指南"><a class="markdownIt-Anchor" href="#rich-进阶组件使用指南"></a> 🌈 Rich 进阶组件使用指南</h2><p>这些功能让你不仅能“美化输出”，还能在终端中<strong>构建交互式信息界面</strong>。<br />主要包括：<code>Panel</code>、<code>Layout</code>、<code>Tree</code>、<code>Live</code>、<code>Columns</code> 等模块。</p><h3 id="一-panel-给内容加上信息卡片边框"><a class="markdownIt-Anchor" href="#一-panel-给内容加上信息卡片边框"></a> 一、Panel —— 给内容加上“信息卡片边框”</h3><p><code>Panel</code> 用来让内容看起来像一块醒目的提示板。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> rich<span class="token punctuation">.</span>console <span class="token keyword">import</span> Console<span class="token keyword">from</span> rich<span class="token punctuation">.</span>panel <span class="token keyword">import</span> Panelconsole <span class="token operator">=</span> Console<span class="token punctuation">(</span><span class="token punctuation">)</span>panel <span class="token operator">=</span> Panel<span class="token punctuation">(</span>    <span class="token string">"[bold yellow]操作成功！[/bold yellow]\n数据已保存到数据库。"</span><span class="token punctuation">,</span>    title<span class="token operator">=</span><span class="token string">"通知"</span><span class="token punctuation">,</span>    subtitle<span class="token operator">=</span><span class="token string">"rich.panel 示例"</span><span class="token punctuation">,</span>    border_style<span class="token operator">=</span><span class="token string">"green"</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token keyword">print</span><span class="token punctuation">(</span>panel<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以设置：</p><ul><li><code>title</code> / <code>subtitle</code>：上、下标题</li><li><code>border_style</code>：边框颜色</li><li><code>expand=True</code>：让面板占满终端宽度</li></ul><h3 id="二-layout-构建终端界面布局"><a class="markdownIt-Anchor" href="#二-layout-构建终端界面布局"></a> 二、Layout —— 构建终端“界面布局”</h3><p><code>Layout</code> 能让终端像网页一样分区。适合日志面板、状态栏等。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> rich<span class="token punctuation">.</span>console <span class="token keyword">import</span> Console<span class="token keyword">from</span> rich<span class="token punctuation">.</span>layout <span class="token keyword">import</span> Layout<span class="token keyword">from</span> rich<span class="token punctuation">.</span>panel <span class="token keyword">import</span> Panelconsole <span class="token operator">=</span> Console<span class="token punctuation">(</span><span class="token punctuation">)</span>layout <span class="token operator">=</span> Layout<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 整体分为上下两部分</span>layout<span class="token punctuation">.</span>split<span class="token punctuation">(</span>    Layout<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"header"</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    Layout<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"body"</span><span class="token punctuation">,</span> ratio<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 再把 body 分为左右</span>layout<span class="token punctuation">[</span><span class="token string">"body"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split_row<span class="token punctuation">(</span>    Layout<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"left"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    Layout<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"right"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>layout<span class="token punctuation">[</span><span class="token string">"header"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>Panel<span class="token punctuation">(</span><span class="token string">"[bold magenta]Rich Layout 示例"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>layout<span class="token punctuation">[</span><span class="token string">"left"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>Panel<span class="token punctuation">(</span><span class="token string">"左侧面板内容"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>layout<span class="token punctuation">[</span><span class="token string">"right"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>Panel<span class="token punctuation">(</span><span class="token string">"右侧面板内容"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token keyword">print</span><span class="token punctuation">(</span>layout<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以使用 <code>split()</code>（上下）或 <code>split_row()</code>（左右）来划分区域。<br />每个区域都能用 <code>.update()</code> 放入 <code>Panel</code>、<code>Table</code>、<code>Markdown</code> 等内容。</p><h3 id="三-tree-生成漂亮的目录结构"><a class="markdownIt-Anchor" href="#三-tree-生成漂亮的目录结构"></a> 三、Tree —— 生成漂亮的目录结构</h3><p><code>Tree</code> 是一个树形结构输出工具，很适合打印文件层级或配置结构。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> rich<span class="token punctuation">.</span>console <span class="token keyword">import</span> Console<span class="token keyword">from</span> rich<span class="token punctuation">.</span>tree <span class="token keyword">import</span> Treeconsole <span class="token operator">=</span> Console<span class="token punctuation">(</span><span class="token punctuation">)</span>tree <span class="token operator">=</span> Tree<span class="token punctuation">(</span><span class="token string">"📂 项目结构"</span><span class="token punctuation">)</span>src <span class="token operator">=</span> tree<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">"src"</span><span class="token punctuation">)</span>src<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">"main.py"</span><span class="token punctuation">)</span>src<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">"utils.py"</span><span class="token punctuation">)</span>docs <span class="token operator">=</span> tree<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">"docs"</span><span class="token punctuation">)</span>docs<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">"readme.md"</span><span class="token punctuation">)</span>tree<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">"requirements.txt"</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token keyword">print</span><span class="token punctuation">(</span>tree<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可搭配 emoji 和颜色使用，让终端目录更直观。</p><h3 id="四-live-实时更新终端内容动态界面"><a class="markdownIt-Anchor" href="#四-live-实时更新终端内容动态界面"></a> 四、Live —— 实时更新终端内容（动态界面）</h3><p><code>Live</code> 能让你持续刷新输出，而不是刷屏。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> time<span class="token keyword">from</span> rich<span class="token punctuation">.</span>live <span class="token keyword">import</span> Live<span class="token keyword">from</span> rich<span class="token punctuation">.</span>table <span class="token keyword">import</span> Tabletable <span class="token operator">=</span> Table<span class="token punctuation">(</span><span class="token punctuation">)</span>table<span class="token punctuation">.</span>add_column<span class="token punctuation">(</span><span class="token string">"任务"</span><span class="token punctuation">)</span>table<span class="token punctuation">.</span>add_column<span class="token punctuation">(</span><span class="token string">"进度"</span><span class="token punctuation">)</span><span class="token keyword">with</span> Live<span class="token punctuation">(</span>table<span class="token punctuation">,</span> refresh_per_second<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"任务 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">20</span><span class="token punctuation">&#125;</span></span><span class="token string">%"</span></span><span class="token punctuation">)</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>Live</code> 会在同一块区域动态更新内容，非常适合实时监控或进度显示。</p><h3 id="五-columns-多列并排显示内容"><a class="markdownIt-Anchor" href="#五-columns-多列并排显示内容"></a> 五、Columns —— 多列并排显示内容</h3><p>当你想让一堆内容整齐地排在一行（比如日志或状态栏）时，<code>Columns</code> 是利器。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> rich<span class="token punctuation">.</span>console <span class="token keyword">import</span> Console<span class="token keyword">from</span> rich<span class="token punctuation">.</span>columns <span class="token keyword">import</span> Columns<span class="token keyword">from</span> rich<span class="token punctuation">.</span>panel <span class="token keyword">import</span> Panelconsole <span class="token operator">=</span> Console<span class="token punctuation">(</span><span class="token punctuation">)</span>panels <span class="token operator">=</span> <span class="token punctuation">[</span>    Panel<span class="token punctuation">(</span><span class="token string">"CPU: 24%"</span><span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string">"系统状态"</span><span class="token punctuation">,</span> border_style<span class="token operator">=</span><span class="token string">"cyan"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    Panel<span class="token punctuation">(</span><span class="token string">"内存: 1.2 GB"</span><span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string">"内存"</span><span class="token punctuation">,</span> border_style<span class="token operator">=</span><span class="token string">"green"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    Panel<span class="token punctuation">(</span><span class="token string">"网络: 正常"</span><span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string">"网络"</span><span class="token punctuation">,</span> border_style<span class="token operator">=</span><span class="token string">"magenta"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span>console<span class="token punctuation">.</span><span class="token keyword">print</span><span class="token punctuation">(</span>Columns<span class="token punctuation">(</span>panels<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>会自动根据终端宽度排版，多列自适应。</p><h3 id="六-progress进阶版-多任务进度条"><a class="markdownIt-Anchor" href="#六-progress进阶版-多任务进度条"></a> 六、Progress（进阶版）—— 多任务进度条</h3><p>之前的 <code>track()</code> 是简化用法。<br />进阶用法可以同时显示多个任务。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> time<span class="token keyword">from</span> rich<span class="token punctuation">.</span>progress <span class="token keyword">import</span> Progress<span class="token keyword">with</span> Progress<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> progress<span class="token punctuation">:</span>    task1 <span class="token operator">=</span> progress<span class="token punctuation">.</span>add_task<span class="token punctuation">(</span><span class="token string">"[cyan]下载文件A..."</span><span class="token punctuation">,</span> total<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>    task2 <span class="token operator">=</span> progress<span class="token punctuation">.</span>add_task<span class="token punctuation">(</span><span class="token string">"[magenta]下载文件B..."</span><span class="token punctuation">,</span> total<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>    <span class="token keyword">while</span> <span class="token keyword">not</span> progress<span class="token punctuation">.</span>finished<span class="token punctuation">:</span>        progress<span class="token punctuation">.</span>update<span class="token punctuation">(</span>task1<span class="token punctuation">,</span> advance<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>        progress<span class="token punctuation">.</span>update<span class="token punctuation">(</span>task2<span class="token punctuation">,</span> advance<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>你可以随时 <code>update(task_id, advance=x)</code> 来推进进度，非常适合多线程或循环任务。</p><h3 id="七-组合示例一个简易系统监控界面"><a class="markdownIt-Anchor" href="#七-组合示例一个简易系统监控界面"></a> 七、组合示例：一个简易“系统监控界面”</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> time<span class="token keyword">from</span> rich<span class="token punctuation">.</span>console <span class="token keyword">import</span> Console<span class="token keyword">from</span> rich<span class="token punctuation">.</span>layout <span class="token keyword">import</span> Layout<span class="token keyword">from</span> rich<span class="token punctuation">.</span>panel <span class="token keyword">import</span> Panel<span class="token keyword">from</span> rich<span class="token punctuation">.</span>live <span class="token keyword">import</span> Liveconsole <span class="token operator">=</span> Console<span class="token punctuation">(</span><span class="token punctuation">)</span>layout <span class="token operator">=</span> Layout<span class="token punctuation">(</span><span class="token punctuation">)</span>layout<span class="token punctuation">.</span>split_column<span class="token punctuation">(</span>    Layout<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"header"</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    Layout<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"main"</span><span class="token punctuation">,</span> ratio<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    Layout<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"footer"</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>layout<span class="token punctuation">[</span><span class="token string">"header"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>Panel<span class="token punctuation">(</span><span class="token string">"[bold green]🖥 系统监控"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>layout<span class="token punctuation">[</span><span class="token string">"footer"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>Panel<span class="token punctuation">(</span><span class="token string">"按 Ctrl+C 退出"</span><span class="token punctuation">,</span> border_style<span class="token operator">=</span><span class="token string">"red"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">make_main_panel</span><span class="token punctuation">(</span>cpu<span class="token punctuation">,</span> mem<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> Panel<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"CPU 使用率: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>cpu<span class="token punctuation">&#125;</span></span><span class="token string">%\n内存占用: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>mem<span class="token punctuation">&#125;</span></span><span class="token string"> MB"</span></span><span class="token punctuation">,</span> border_style<span class="token operator">=</span><span class="token string">"cyan"</span><span class="token punctuation">)</span><span class="token keyword">with</span> Live<span class="token punctuation">(</span>layout<span class="token punctuation">,</span> refresh_per_second<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        cpu <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">100</span>        mem <span class="token operator">=</span> <span class="token number">500</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>        layout<span class="token punctuation">[</span><span class="token string">"main"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>make_main_panel<span class="token punctuation">(</span>cpu<span class="token punctuation">,</span> mem<span class="token punctuation">)</span><span class="token punctuation">)</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>运行后，你会看到一个实时更新的动态“界面”，像个迷你监控台。</p><h2 id="高级"><a class="markdownIt-Anchor" href="#高级"></a> 高级</h2><p>Rich 的开发者还写了一个基于它的<strong>终端应用框架</strong>：<a href="https://github.com/Textualize/textual"><strong>Textual</strong></a><br />它能让你用 Rich 的基础语法写出带窗口、按钮、滚动区的完整 TUI（终端UI）程序。</p><p>有余力可以学习一下。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;details&gt;
&lt;summary&gt;版权信息&lt;/summary&gt;
&lt;div class=&quot;admonition warning&quot;&gt;&lt;p class=&quot;admonition-title&quot;&gt;warning&lt;/p&gt;&lt;p&gt;本文章为博主原创文章。遵循 &lt;a href=&quot;https://c</summary>
      
    
    
    
    <category term="python" scheme="https://blog.godmao.top/categories/python/"/>
    
    
    <category term="python" scheme="https://blog.godmao.top/Tags/python/"/>
    
    <category term="rich" scheme="https://blog.godmao.top/Tags/rich/"/>
    
  </entry>
  
  <entry>
    <title>大蟒蛇-json库</title>
    <link href="https://blog.godmao.top/posts/50277/"/>
    <id>https://blog.godmao.top/posts/50277/</id>
    <published>2025-10-23T03:25:00.000Z</published>
    <updated>2025-10-27T13:34:29.068Z</updated>
    
    <content type="html"><![CDATA[<details><summary>版权信息</summary><div class="admonition warning"><p class="admonition-title">warning</p><p>本文章为博主原创文章。遵循 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh-hans">CC 4.0 BY-SA</a> 版权协议，转载请附上原文出处链接和本声明。</p></div></details><hr /><h2 id="jsonload"><a class="markdownIt-Anchor" href="#jsonload"></a> json.load()</h2><p><strong>描述：</strong> 从文件对象读取 JSON 数据并反序列化为 Python 对象<br /><strong>语法：</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>fp<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> cls<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> object_hook<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> parse_float<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> parse_int<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> parse_constant<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> object_pairs_hook<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>示例：</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> json<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'data.json'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    data <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="jsonloads"><a class="markdownIt-Anchor" href="#jsonloads"></a> json.loads()</h2><p><strong>描述：</strong> 从字符串读取 JSON 数据并反序列化为 Python 对象<br /><strong>语法：</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> cls<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> object_hook<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> parse_float<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> parse_int<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> parse_constant<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> object_pairs_hook<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>示例：</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">data <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span><span class="token string">'&#123;"name": "Alice", "age": 25&#125;'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="jsondump"><a class="markdownIt-Anchor" href="#jsondump"></a> json.dump()</h2><p><strong>描述：</strong> 将 Python 对象序列化为 JSON 并写入文件<br /><strong>语法：</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> fp<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> skipkeys<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> check_circular<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>          allow_nan<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> cls<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> separators<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>          default<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> sort_keys<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>示例：</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"age"</span><span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">&#125;</span><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'data.json'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>data<span class="token punctuation">,</span> f<span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="jsondumps"><a class="markdownIt-Anchor" href="#jsondumps"></a> json.dumps()</h2><p><strong>描述：</strong> 将 Python 对象序列化为 JSON 字符串<br /><strong>语法：</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> skipkeys<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> check_circular<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>           allow_nan<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> cls<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> separators<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>           default<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> sort_keys<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>示例：</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">s <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"x"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"y"</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="jsonjsondecoder"><a class="markdownIt-Anchor" href="#jsonjsondecoder"></a> json.JSONDecoder</h2><p><strong>描述：</strong> JSON 反序列化类，可自定义解析逻辑<br /><strong>语法：</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">json</span><span class="token punctuation">.</span>JSONDecoder<span class="token punctuation">(</span>object_hook<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> object_pairs_hook<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> parse_float<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>                       parse_int<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> parse_constant<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> strict<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>示例：</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">decoder <span class="token operator">=</span> json<span class="token punctuation">.</span>JSONDecoder<span class="token punctuation">(</span><span class="token punctuation">)</span>obj <span class="token operator">=</span> decoder<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'&#123;"a":1,"b":2&#125;'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="jsonjsonencoder"><a class="markdownIt-Anchor" href="#jsonjsonencoder"></a> json.JSONEncoder</h2><p><strong>描述：</strong> JSON 序列化类，可自定义编码行为<br /><strong>语法：</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">json</span><span class="token punctuation">.</span>JSONEncoder<span class="token punctuation">(</span>skipkeys<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> check_circular<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>                       allow_nan<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> sort_keys<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> separators<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>示例：</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">encoder <span class="token operator">=</span> json<span class="token punctuation">.</span>JSONEncoder<span class="token punctuation">(</span>indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>s <span class="token operator">=</span> encoder<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"test"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="jsonjsondecodeerror"><a class="markdownIt-Anchor" href="#jsonjsondecodeerror"></a> json.JSONDecodeError</h2><p><strong>描述：</strong> 解码 JSON 时的异常类型（继承自 <code>ValueError</code>）<br /><strong>语法：</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">try</span><span class="token punctuation">:</span>    json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span><span class="token string">'invalid json'</span><span class="token punctuation">)</span><span class="token keyword">except</span> json<span class="token punctuation">.</span>JSONDecodeError <span class="token keyword">as</span> e<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="jsontool命令行模块"><a class="markdownIt-Anchor" href="#jsontool命令行模块"></a> json.tool（命令行模块）</h2><p><strong>描述：</strong> 命令行工具，用于格式化 JSON 输出<br /><strong>语法：</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python <span class="token parameter variable">-m</span> json.tool input.json<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>示例：</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">'&#123;"a":1,"b":2&#125;'</span> <span class="token operator">|</span> python <span class="token parameter variable">-m</span> json.tool<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="参数说明适用于-dumpdumpsloadloads"><a class="markdownIt-Anchor" href="#参数说明适用于-dumpdumpsloadloads"></a> 参数说明（适用于 dump/dumps/load/loads）</h2><h3 id="indent"><a class="markdownIt-Anchor" href="#indent"></a> indent</h3><p>控制缩进格式（整数或字符串）</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="separators"><a class="markdownIt-Anchor" href="#separators"></a> separators</h3><p>自定义分隔符（默认 <code>(', ', ': ')</code>）</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">,</span> separators<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">,</span> <span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="sort_keys"><a class="markdownIt-Anchor" href="#sort_keys"></a> sort_keys</h3><p>按键名排序输出</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">,</span> sort_keys<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="ensure_ascii"><a class="markdownIt-Anchor" href="#ensure_ascii"></a> ensure_ascii</h3><p>是否转义非 ASCII 字符</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"中文"</span><span class="token punctuation">:</span> <span class="token string">"测试"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="default"><a class="markdownIt-Anchor" href="#default"></a> default</h3><p>定义无法序列化对象的处理函数</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">encode_complex</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token builtin">complex</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">"real"</span><span class="token punctuation">:</span> obj<span class="token punctuation">.</span>real<span class="token punctuation">,</span> <span class="token string">"imag"</span><span class="token punctuation">:</span> obj<span class="token punctuation">.</span>imag<span class="token punctuation">&#125;</span>    <span class="token keyword">raise</span> TypeError<span class="token punctuation">(</span><span class="token punctuation">)</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span><span class="token number">2j</span><span class="token punctuation">,</span> default<span class="token operator">=</span>encode_complex<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="object_hook"><a class="markdownIt-Anchor" href="#object_hook"></a> object_hook</h3><p>自定义反序列化处理函数</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">as_person</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> Person<span class="token punctuation">(</span>d<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token string">'name'</span> <span class="token keyword">in</span> d <span class="token keyword">else</span> djson<span class="token punctuation">.</span>loads<span class="token punctuation">(</span><span class="token string">'&#123;"name":"Alice"&#125;'</span><span class="token punctuation">,</span> object_hook<span class="token operator">=</span>as_person<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="parse_float-parse_int-parse_constant"><a class="markdownIt-Anchor" href="#parse_float-parse_int-parse_constant"></a> parse_float, parse_int, parse_constant</h3><p>用于自定义解析数字/常量的函数</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span><span class="token string">'&#123;"num": 1.23&#125;'</span><span class="token punctuation">,</span> parse_float<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token builtin">round</span><span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="常见用法对比"><a class="markdownIt-Anchor" href="#常见用法对比"></a> 常见用法对比</h2><table><thead><tr><th>操作</th><th>从字符串</th><th>从文件</th><th>输出为字符串</th><th>输出为文件</th></tr></thead><tbody><tr><td>反序列化</td><td>json.loads()</td><td>json.load()</td><td>—</td><td>—</td></tr><tr><td>序列化</td><td>—</td><td>—</td><td>json.dumps()</td><td>json.dump()</td></tr></tbody></table>]]></content>
    
    
      
      
    <summary type="html">&lt;details&gt;
&lt;summary&gt;版权信息&lt;/summary&gt;
&lt;div class=&quot;admonition warning&quot;&gt;&lt;p class=&quot;admonition-title&quot;&gt;warning&lt;/p&gt;&lt;p&gt;本文章为博主原创文章。遵循 &lt;a href=&quot;https://c</summary>
      
    
    
    
    <category term="python" scheme="https://blog.godmao.top/categories/python/"/>
    
    
    <category term="python" scheme="https://blog.godmao.top/Tags/python/"/>
    
    <category term="json" scheme="https://blog.godmao.top/Tags/json/"/>
    
  </entry>
  
  <entry>
    <title>u-boot常见命令</title>
    <link href="https://blog.godmao.top/posts/13859/"/>
    <id>https://blog.godmao.top/posts/13859/</id>
    <published>2025-10-22T09:59:21.000Z</published>
    <updated>2025-10-31T09:56:45.785Z</updated>
    
    <content type="html"><![CDATA[<details><summary>版权信息</summary><div class="admonition warning"><p class="admonition-title">warning</p><p>本文章为博主原创文章。遵循 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh-hans">CC 4.0 BY-SA</a> 版权协议，转载请附上原文出处链接和本声明。</p></div></details><hr /><p>U-Boot（Universal Boot Loader）是嵌入式系统开发中一个非常重要的组件，它负责在操作系统启动之前，进行基本的硬件初始化，并提供一个交互式的命令行接口，以便用户进行系统配置、内核加载等操作。掌握 U-Boot 的常见命令是嵌入式工程师的基本功。</p><p>本文将为您介绍一些 U-Boot 中最常用和最关键的命令及其用途。</p><h2 id="一-环境与信息查看命令"><a class="markdownIt-Anchor" href="#一-环境与信息查看命令"></a> 一、 环境与信息查看命令</h2><p>这些命令用于查看和管理 U-Boot 的运行环境和系统信息。</p><table><thead><tr><th><strong>命令</strong></th><th><strong>用途</strong></th><th><strong>示例</strong></th><th><strong>备注</strong></th></tr></thead><tbody><tr><td><code>help</code> 或 <code>?</code></td><td>显示所有可用命令的列表或特定命令的帮助信息。</td><td><code>help</code> / <code>help setenv</code></td><td><code>?</code> 是 <code>help</code> 的别名。</td></tr><tr><td><code>printenv</code></td><td>显示所有的环境变量及其值。</td><td><code>printenv</code></td><td>环境变量通常保存在非易失性存储介质中。</td></tr><tr><td><code>bdinfo</code></td><td>显示板级信息（Board Info Structure），如内存地址、大小等。</td><td><code>bdinfo</code></td><td></td></tr><tr><td><code>version</code></td><td>显示 U-Boot 的版本信息。</td><td><code>version</code></td><td></td></tr></tbody></table><h2 id="二-环境变量操作命令"><a class="markdownIt-Anchor" href="#二-环境变量操作命令"></a> 二、 环境变量操作命令</h2><p>环境变量是 U-Boot 配置系统行为的关键，例如定义启动参数、网络设置等。</p><table><thead><tr><th><strong>命令</strong></th><th><strong>用途</strong></th><th><strong>示例</strong></th><th><strong>备注</strong></th></tr></thead><tbody><tr><td><code>setenv</code></td><td>设置或修改一个环境变量的值。</td><td><code>setenv ipaddr 192.168.1.100</code></td><td>更改是临时的，只在当前 U-Boot 会话中生效。</td></tr><tr><td><code>saveenv</code></td><td>将当前内存中的环境变量保存到非易失性存储（如 Flash 或 eMMC）中。</td><td><code>saveenv</code></td><td>使环境变量永久生效。</td></tr><tr><td><code>run</code></td><td>执行存储在一个环境变量中的命令序列。</td><td><code>run bootcmd</code></td><td><code>bootcmd</code> 是一个重要的环境变量，定义了自动启动时执行的命令。</td></tr><tr><td><code>bootargs</code></td><td><strong>（特殊变量）</strong> 设置传递给 Linux 内核的启动参数。</td><td><code>setenv bootargs 'root=/dev/mmcblk0p2 console=ttyS0,115200'</code></td><td>通常在启动前设置。</td></tr><tr><td><code>bootcmd</code></td><td><strong>（特殊变量）</strong> 设定 U-Boot 自动启动时执行的命令。</td><td><code>setenv bootcmd 'tftp 0x42000000 zImage; bootm 0x42000000'</code></td><td>启动时若不打断，则执行此变量中的命令。</td></tr></tbody></table><h2 id="三-内存与存储操作命令"><a class="markdownIt-Anchor" href="#三-内存与存储操作命令"></a> 三、 内存与存储操作命令</h2><p>这些命令用于读写内存、从外部存储加载数据、以及操作 Flash 等。</p><table><thead><tr><th><strong>命令</strong></th><th><strong>用途</strong></th><th><strong>示例</strong></th><th><strong>备注</strong></th></tr></thead><tbody><tr><td><code>mw</code></td><td>内存写入（Memory Write），向内存地址写入指定值。</td><td><code>mw.l 0x40000000 0xDEADBEEF 10</code></td><td><code>.b</code> (字节), <code>.w</code> (字), <code>.l</code> (长字) 指定写入单位。<strong>10是一个十六进制数</strong>。</td></tr><tr><td><code>md</code></td><td>内存显示（Memory Display），查看指定内存地址的内容。</td><td><code>md.l 0x40000000 10</code></td><td><strong>10是一个十六进制数</strong>，表示显示 10 个单位。</td></tr><tr><td><code>cp</code></td><td>内存拷贝（Memory Copy），在内存或存储之间复制数据。</td><td><code>cp.b 0x40000000 0x40100000 0x100</code></td><td>可用于从 NAND/SD/eMMC 等到 RAM 的复制。</td></tr><tr><td><code>erase</code></td><td>擦除 Flash 或其他存储区域。</td><td><code>erase 0x50000000 +0x100000</code></td><td>慎用！会清除数据。</td></tr><tr><td><code>nand</code> / <code>mmc</code> / <code>spi</code> / <code>sata</code> 等</td><td>针对不同存储介质的操作命令。</td><td><code>mmc rescan</code> / <code>nand read 0x40000000 kernel 0x800000</code></td><td>具体命令取决于 U-Boot 配置和硬件支持。</td></tr><tr><td><code>cmp</code></td><td>比较两段内存地址的指定单位长度数据是否相等</td><td><code>cmp.l 80000000 80000100 10</code></td><td><code>.b</code> (字节), <code>.w</code> (字), <code>.l</code> (长字) 指定写入单位。<strong>10是一个十六进制数</strong>。</td></tr></tbody></table><h2 id="四-网络与文件传输命令"><a class="markdownIt-Anchor" href="#四-网络与文件传输命令"></a> 四、 网络与文件传输命令</h2><p>在嵌入式开发中，通常通过网络（如 TFTP）从主机下载内核或文件系统镜像。</p><table><thead><tr><th><strong>命令</strong></th><th><strong>用途</strong></th><th><strong>示例</strong></th><th><strong>备注</strong></th></tr></thead><tbody><tr><td><code>ping</code></td><td>测试网络连接。</td><td><code>ping 192.168.1.1</code></td><td>需要设置 <code>ipaddr</code> 和 <code>serverip</code> 环境变量。</td></tr><tr><td><code>tftp</code></td><td>使用 TFTP 协议从服务器下载文件到内存。</td><td><code>tftp 0x42000000 zImage</code></td><td>0x42000000 是内存地址，zImage 是服务器上的文件名。</td></tr><tr><td><code>dhcp</code></td><td>通过 DHCP 获取板子的 IP 地址等网络参数。</td><td><code>dhcp</code></td><td></td></tr><tr><td><code>setenv</code></td><td><strong>（网络相关变量）</strong> 设置网络参数。</td><td><code>setenv ipaddr 192.168.1.10</code> / <code>setenv serverip 192.168.1.1</code></td><td></td></tr></tbody></table><h3 id="issue1无法ping通"><a class="markdownIt-Anchor" href="#issue1无法ping通"></a> issue#1:无法ping通</h3><p>第一，检查环境变量，配置好ipaddr、ethaddr、netmask，确保与主机处于同一网段。</p><table><thead><tr><th><strong>环境变量</strong></th><th><strong>用途</strong></th></tr></thead><tbody><tr><td>ipaddr</td><td>开发板ip地址</td></tr><tr><td>ethaddr</td><td>开发板MAC地址</td></tr><tr><td>netmask</td><td>子网掩码</td></tr><tr><td>gatewayip</td><td>网关地址</td></tr><tr><td>serveip</td><td>服务器 IP 地址，也就是主机 IP 地址，用于调试代码。</td></tr></tbody></table><pre class="line-numbers language-none"><code class="language-none">setenv ipaddr 192.168.137.144setenv ethaddr yourethaddrsetenv netmask 255.255.255.0setenv serverip 192.168.137.1saveenv<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>第二，检查无误后，使用网线连接主机（电脑），发现无法ping通。</p><ul><li><p><strong>原因</strong>：windows系统无法识别连接到以太网接口的设备，显示为“未识别的网络”，使用的是公用网络的网络配置文件，而windows公用网络配置文件默认是不允许回应ping的，因此无法ping通。</p></li><li><p><strong>解决方法</strong>：在设置——网络与Internet——高级网络设置——Windows防火墙，将公用网络中的防火墙暂时关闭，即可ping通。</p></li></ul><h2 id="五-系统启动命令"><a class="markdownIt-Anchor" href="#五-系统启动命令"></a> 五、 系统启动命令</h2><p>这些命令用于加载并启动操作系统内核。</p><table><thead><tr><th><strong>命令</strong></th><th><strong>用途</strong></th><th><strong>示例</strong></th><th><strong>备注</strong></th></tr></thead><tbody><tr><td><code>bootm</code></td><td>启动一个由 <code>mkimage</code> 工具制作的、带有 U-Boot 映像头信息的内核或操作系统映像。</td><td><code>bootm 0x42000000</code></td><td>地址是内核在 RAM 中的加载地址。</td></tr><tr><td><code>bootz</code></td><td>启动一个 Linux zImage 格式的内核。</td><td><code>bootz 0x42000000</code></td><td>通常用于启动未被 <code>mkimage</code> 打包的 zImage。</td></tr><tr><td><code>boot</code> 或 <code>bootd</code></td><td>执行 <code>bootcmd</code> 环境变量中定义的命令，实现默认启动。</td><td><code>boot</code></td><td><code>bootd</code> 是 <code>boot</code> 的别名。</td></tr></tbody></table><h2 id="总结"><a class="markdownIt-Anchor" href="#总结"></a> 总结</h2><p>U-Boot 的命令众多，但上述这些是日常开发和调试中最常用的。通过这些命令，您可以实现：</p><ol><li><p><strong>查看和修改配置：</strong> 使用 <code>printenv</code>、<code>setenv</code> 和 <code>saveenv</code> 管理启动参数和网络设置。</p></li><li><p><strong>加载映像文件：</strong> 使用 <code>tftp</code>、<code>mmc read</code> 等将内核、设备树（DTB）和文件系统加载到 RAM 中。</p></li><li><p><strong>启动系统：</strong> 使用 <code>bootm</code> 或 <code>bootz</code> 引导操作系统。</p></li><li><p><strong>调试和诊断：</strong> 使用 <code>md</code>、<code>mw</code> 和 <code>ping</code> 等进行内存和网络测试。</p></li></ol><p>在实际操作中，您可以通过输入 <code>help</code> 命令来获取当前 U-Boot 版本所支持的完整命令列表。希望这篇文章能帮助您更好地理解和使用 U-Boot！</p><hr />]]></content>
    
    
      
      
    <summary type="html">&lt;details&gt;
&lt;summary&gt;版权信息&lt;/summary&gt;
&lt;div class=&quot;admonition warning&quot;&gt;&lt;p class=&quot;admonition-title&quot;&gt;warning&lt;/p&gt;&lt;p&gt;本文章为博主原创文章。遵循 &lt;a href=&quot;https://c</summary>
      
    
    
    
    <category term="Linux" scheme="https://blog.godmao.top/categories/Linux/"/>
    
    <category term="系统移植" scheme="https://blog.godmao.top/categories/Linux/%E7%B3%BB%E7%BB%9F%E7%A7%BB%E6%A4%8D/"/>
    
    
    <category term="u-boot" scheme="https://blog.godmao.top/Tags/u-boot/"/>
    
  </entry>
  
  <entry>
    <title>在Linux中创建一个字符驱动设备</title>
    <link href="https://blog.godmao.top/posts/59269/"/>
    <id>https://blog.godmao.top/posts/59269/</id>
    <published>2025-10-20T04:43:37.000Z</published>
    <updated>2025-10-22T10:07:47.401Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="ERROR。" data-whm="这个文章不能被校验, 不过你还是能看看解密后的内容。">  <script id="hbeData" type="hbeData" data-hmacdigest="9ef116f37859977604a418a38ea87ae7b8740eaae4b0c9085812b7f040375939">472f0d2124ee617a2f29ff331422d5d3c786bf02d6cb05b48659c7bd0efc234c66e4d05e5e352805b8be7fb548f5db1dc6ce19185f33969b60366e77544d242a4ad3617be960d1cc6fb50f20f9bc3fa3dc4611c1b7fe65e71a5a3a53a2361ac23d01b5245c304a9c64d1f2d42467b313e7b98b9941501c7f62ba70ae803acc1147cacc437bdd5678ef1810bb19b628c6a4bce1bcb2f217b0631590f4a05267a7a121c769458bb6d0d3a007991a4e5946e6e80bfdd70ada16fe8b7f425cd91ff2fd2c0d96e6a7a61f2a495ff7c5d17f33392096a74bcf83fe0a2a1b47dd5a8cc11585947ae9ce708ca44fe807a441afd12f8304730781830b4f9cc4f4cdf370535e05cecdcdde5fb485d559476d4a130b41d70fc5d6999e8bb9a1105d9fc8bad1acf6b48e4bca65932d62ce795949be362d42d3c4aa5b1a3df4213ed5be2d1da2e61473992a40a821237717333de4627358fc2994316e97947ee4226e077242b9f1292da1a904fa20cdf6a9ded8db3171</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-up">      <input class="hbe hbe-input-field hbe-input-field-up" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-up" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-up">文章已被隐藏，可能为私密内容或还未完成。</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">???</summary>
    
    
    
    <category term="Linux" scheme="https://blog.godmao.top/categories/Linux/"/>
    
    <category term="内核编程" scheme="https://blog.godmao.top/categories/Linux/%E5%86%85%E6%A0%B8%E7%BC%96%E7%A8%8B/"/>
    
    
    <category term="Linux" scheme="https://blog.godmao.top/Tags/Linux/"/>
    
    <category term="字符驱动" scheme="https://blog.godmao.top/Tags/%E5%AD%97%E7%AC%A6%E9%A9%B1%E5%8A%A8/"/>
    
  </entry>
  
  <entry>
    <title>记录搭建一台云服务器环境的过程</title>
    <link href="https://blog.godmao.top/posts/2446/"/>
    <id>https://blog.godmao.top/posts/2446/</id>
    <published>2025-10-14T06:07:43.000Z</published>
    <updated>2025-10-14T12:13:45.233Z</updated>
    
    <content type="html"><![CDATA[<details><summary>版权信息</summary><div class="admonition warning"><p class="admonition-title">warning</p><p>本文章为博主原创文章。遵循 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh-hans">CC 4.0 BY-SA</a> 版权协议，转载请附上原文出处链接和本声明。</p></div></details><hr /><ul><li><a href="#1-%E5%89%8D%E8%A8%80">1. 前言</a></li><li><a href="#2-%E6%93%8D%E4%BD%9C%E4%B9%A0%E6%83%AF%E9%83%A8%E5%88%86">2. 操作习惯部分</a><ul><li><a href="#21-%E4%BF%AE%E6%94%B9%E4%B8%BB%E6%9C%BA%E5%90%8D">2.1. 修改主机名</a></li><li><a href="#22-%E9%85%8D%E7%BD%AE%E6%97%B6%E5%8C%BA">2.2. 配置时区</a></li></ul></li><li><a href="#3-%E5%AE%89%E5%85%A8%E9%83%A8%E5%88%86">3. 🔐安全部分</a><ul><li><a href="#31-%E9%87%8D%E6%96%B0%E8%AE%BE%E7%BD%AEroot%E5%AF%86%E7%A0%81%E4%B8%BA%E5%BC%BA%E5%AF%86%E7%A0%81">3.1. 重新设置root密码为强密码</a></li><li><a href="#32-%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7%E5%B9%B6%E8%AE%BE%E7%BD%AE%E5%BC%BA%E5%AF%86%E7%A0%81">3.2. 添加用户并设置强密码</a></li><li><a href="#33-%E7%B3%BB%E7%BB%9F%E5%8D%87%E7%BA%A7">3.3. 系统升级</a></li><li><a href="#34-%E4%BD%BF%E7%94%A8ssh-key%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95%E8%80%8C%E4%B8%8D%E6%98%AF%E5%AF%86%E7%A0%81">3.4. 使用SSH Key远程登录而不是密码</a><ul><li><a href="#341-%E5%9C%A8%E6%9C%AC%E5%9C%B0%E7%94%B5%E8%84%91%E4%B8%8A%E7%94%9F%E6%88%90%E5%AF%86%E5%8C%99%E5%AF%B9">3.4.1. 在本地电脑上生成密匙对：</a></li><li><a href="#342-%E5%88%9B%E5%BB%BAconfig%E6%96%87%E4%BB%B6">3.4.2. 创建config文件</a></li><li><a href="#343-%E5%A4%8D%E5%88%B6%E5%85%AC%E5%8C%99%E5%88%B0%E6%9C%8D%E5%8A%A1%E5%99%A8">3.4.3. 复制公匙到服务器</a></li><li><a href="#344-%E7%99%BB%E5%BD%95">3.4.4. 登录</a></li></ul></li><li><a href="#35-%E6%94%B9ssh%E7%AB%AF%E5%8F%A3%E9%85%8D%E7%BD%AE%E9%98%B2%E7%81%AB%E5%A2%99">3.5. 改ssh端口&amp;配置防火墙</a><ul><li><a href="#351-%E5%88%9D%E6%AD%A5%E9%85%8D%E7%BD%AE">3.5.1. 初步配置</a></li><li><a href="#352-%E6%94%B9ssh%E7%AB%AF%E5%8F%A3">3.5.2. 改SSH端口</a></li><li><a href="#353-%E5%85%B3%E9%97%AD22%E7%AB%AF%E5%8F%A3">3.5.3. 关闭22端口</a></li></ul></li><li><a href="#36-ssh%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">3.6. ssh配置文件</a><ul><li><a href="#361-%E7%A6%81%E7%94%A8-root%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95%E5%AF%86%E7%A0%81%E7%99%BB%E5%BD%95">3.6.1. 禁用 root远程登录&amp;密码登录</a></li><li><a href="#362-%E4%BD%BF%E7%94%A8ssh2">3.6.2. 使用SSH2</a></li><li><a href="#363-%E9%87%8D%E5%90%AFssh">3.6.3. 重启ssh</a></li></ul></li><li><a href="#37-fail2ban%E5%B7%A5%E5%85%B7%E9%98%B2%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3">3.7. Fail2ban工具防暴力破解</a><ul><li><a href="#371-%E9%85%8D%E7%BD%AEfail2ban">3.7.1. 配置fail2ban</a></li><li><a href="#372-%E6%9F%A5%E7%9C%8B%E7%8A%B6%E6%80%81">3.7.2. 查看状态</a></li><li><a href="#373-%E8%A7%A3%E5%B0%81ip">3.7.3. 解封ip</a></li><li><a href="#374-%E5%90%AF%E7%94%A8fail2ban">3.7.4. 启用fail2ban</a></li><li><a href="#375-%E5%B0%8F%E8%B4%B4%E5%A3%AB">3.7.5. 小贴士</a></li></ul></li></ul></li><li><a href="#4-%E7%B3%BB%E7%BB%9F%E7%BB%B4%E6%8A%A4%E9%83%A8%E5%88%86">4. 系统维护部分</a><ul><li><a href="#41-%E4%BD%BF%E7%94%A8expkg">4.1. <s>使用expkg</s></a></li></ul></li><li><a href="#5-%E7%B3%BB%E7%BB%9F%E8%BF%90%E8%A1%8C%E9%83%A8%E5%88%86">5. 系统运行部分</a></li></ul><h2 id="1-前言"><a class="markdownIt-Anchor" href="#1-前言"></a> 1. 前言</h2><p>前几天在七牛云租了一台轻量应用级服务器，2c4gb，足够满足玩具的需求了。第一次玩服务器，现在把自己的搭建环境的过程记录一下，方便日后操作。</p><p>云服务器系统：Ubuntu 24.04 LTS<br />云服务器厂商：七牛云<br />云服务器规格：轻量型 T1 2C4GB CPU型</p><h2 id="2-操作习惯部分"><a class="markdownIt-Anchor" href="#2-操作习惯部分"></a> 2. 操作习惯部分</h2><h3 id="21-修改主机名"><a class="markdownIt-Anchor" href="#21-修改主机名"></a> 2.1. 修改主机名</h3><p>ssh登录到服务器后，发现主机名是一坨乱码，看着太难受了，必须改了。<br /><img src="Snipaste_2025-10-14_14-17-13.png" alt="" /></p><p>永久修改主机名命令：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> hostnamectl set-hostname myserver<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>重启生效。</p><h3 id="22-配置时区"><a class="markdownIt-Anchor" href="#22-配置时区"></a> 2.2. 配置时区</h3><p>输入 <code>date</code> 命令，发现服务器使用的世界协调时（UTC），改为中国标准时（UTC+8），符合习惯。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> timedatectl set-timezone Asia/Shanghai<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>运行后，使用  <code>timedatectl</code> 命令确认是否修改成功，并查看 <code>NTP service</code> 是否启用，这是自动同步网络时间，可保持时间精准。若未启用则需查询相关教程启用。</p><h2 id="3-安全部分"><a class="markdownIt-Anchor" href="#3-安全部分"></a> 3. 🔐安全部分</h2><p>此部分需格外重视！</p><h3 id="31-重新设置root密码为强密码"><a class="markdownIt-Anchor" href="#31-重新设置root密码为强密码"></a> 3.1. 重新设置root密码为强密码</h3><p>不用多说，<code>passwd</code> 命令即可。</p><h3 id="32-添加用户并设置强密码"><a class="markdownIt-Anchor" href="#32-添加用户并设置强密码"></a> 3.2. 添加用户并设置强密码</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">adduser yourname<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>添加到sudo组：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">usermod</span> <span class="token parameter variable">-aG</span> <span class="token function">sudo</span> yourname<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>查看用户组：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> /etc/group<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>查看当前用户所属组：<code>groups</code>命令。</p><blockquote><p>设置完成后，退出root用户登录，用SSH以普通用户重新登录到服务器。</p></blockquote><h3 id="33-系统升级"><a class="markdownIt-Anchor" href="#33-系统升级"></a> 3.3. 系统升级</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> update<span class="token function">sudo</span> <span class="token function">apt</span> upgrade<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="34-使用ssh-key远程登录而不是密码"><a class="markdownIt-Anchor" href="#34-使用ssh-key远程登录而不是密码"></a> 3.4. 使用SSH Key远程登录而不是密码</h3><p>SSH Key 登录比密码安全很多，几乎无法破解。本质就是让服务器识别你的电脑，只有你的电脑才能登录到服务器。</p><h4 id="341-在本地电脑上生成密匙对"><a class="markdownIt-Anchor" href="#341-在本地电脑上生成密匙对"></a> 3.4.1. 在本地电脑上生成密匙对：</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ssh-keygen <span class="token parameter variable">-t</span> rsa <span class="token parameter variable">-b</span> <span class="token number">4096</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><code>-t</code>：指定密匙类型，rsa是经典算法，兼容性好。</li><li><code>-b</code>：指定密匙长度为4096位。</li></ul><p>它会提示你几个问题：</p><pre class="line-numbers language-none"><code class="language-none">Generating public&#x2F;private rsa key pair. Enter file in which to save the key (&#x2F;home&#x2F;yourname&#x2F;.ssh&#x2F;id_rsa):<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这时候：</p><ul><li><strong>直接回车</strong> 就会把密钥生成在默认位置：<ul><li>私钥：<code>~/.ssh/id_rsa</code> ，<strong>绝对不能泄露！</strong></li><li>公钥：`~/.ssh/id_rsa.pub</li></ul></li><li><strong>或者</strong>指定位置及文件名。<br />接着会提示：</li></ul><pre class="line-numbers language-none"><code class="language-none">Enter passphrase (empty for no passphrase):<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这里你可以选择：</p><ul><li><strong>直接回车</strong>：不设置密码，登录更方便；</li><li><strong>输入密码短语</strong>：多一层保护（每次用私钥登录都要输入这串密码）。</li></ul><h4 id="342-创建config文件"><a class="markdownIt-Anchor" href="#342-创建config文件"></a> 3.4.2. 创建config文件</h4><p>有时，我们不只有一个ssh密匙对，比如我为github生成了一个密匙对，也给服务器生成了一个。如果使用了非默认名称的密钥文件，需要在 <em>~/.ssh/config</em> 文件中进行配置。</p><p>在本地保存ssh密匙对文件的文件夹里，打开或创建名为 <code>config</code> 的文件，无需后缀名。编辑该文件，示例：</p><pre class="line-numbers language-none"><code class="language-none"># GitHub（常见）Host github.com  HostName github.com  User git  IdentityFile ~&#x2F;.ssh&#x2F;id_ed25519_github  IdentitiesOnly yes# 我的服务器Host myserver #你的主机名  HostName 1.2.3.4 #主机ip地址&#x2F;域名  User someone #你要登录的用户  Port 22        # 如果你改过SSH端口就写上，默认22  IdentityFile ~&#x2F;.ssh&#x2F;id_rsa_server  IdentitiesOnly yes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td><code>Host</code></td><td>自定义的别名（可以随意起名）</td></tr><tr><td><code>HostName</code></td><td>实际的服务器域名或 IP 地址</td></tr><tr><td><code>User</code></td><td>登录用户名</td></tr><tr><td><code>Port</code></td><td>SSH 端口（没改的话默认 22）</td></tr><tr><td><code>IdentityFile</code></td><td>私钥文件路径</td></tr><tr><td><code>IdentitiesOnly yes</code></td><td>只使用指定的私钥，避免自动尝试其他 key 导致拒绝</td></tr></tbody></table><h4 id="343-复制公匙到服务器"><a class="markdownIt-Anchor" href="#343-复制公匙到服务器"></a> 3.4.3. 复制公匙到服务器</h4><p>方式1</p><hr /><p>在服务器创建一个文件夹保存ssh公匙，服务器用它来识别远程登录到它的电脑。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> ~/.ssh<span class="token function">touch</span> ~/.ssh/authorized_keys<span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">700</span> ~/.ssh<span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">600</span> ~/.ssh/authorized_keys<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>之后使用nano编辑器，将本地的.pub文件里的内容复制到authorized_keys即可。</p><blockquote><ul><li><strong>千万别上传私钥</strong>（例如 <code>id_rsa</code>、<code>id_ed25519</code>）。只传 <code>*.pub</code>。</li><li><strong>权限必须正确</strong>：- 确保服务器 <code>~/.ssh</code> 权限是 <code>700</code>，<code>~/.ssh/authorized_keys</code> 权限是 <code>600</code>，否则 SSH 会拒绝使用密钥。</li><li><strong>每个公钥一行</strong>，不要插入换行或空格。<code>authorized_keys</code> 可包含多把公钥（多台电脑可共用）。</li></ul></blockquote><p>方式2</p><hr /><p>window可使用gitbash。linux直接输入：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ssh-copy-id <span class="token parameter variable">-i</span> ~/.ssh/id_rsa_server.pub root@SERVER_IP<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><code>-i</code> 后面是你本地的公钥文件（比如 <code>~/.ssh/id_rsa_server.pub</code>）。</li><li>运行会提示输入服务器密码，然后把公钥追加到服务器 <code>~/.ssh/authorized_keys</code>。<br /><strong>注意不要错传成私匙！</strong></li></ul><hr /><h4 id="344-登录"><a class="markdownIt-Anchor" href="#344-登录"></a> 3.4.4. 登录</h4><p>尝试在本地ssh登录。正常的话不用输密码就可以直接登陆上：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ssh</span> Host<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="35-改ssh端口配置防火墙"><a class="markdownIt-Anchor" href="#35-改ssh端口配置防火墙"></a> 3.5. 改ssh端口&amp;配置防火墙</h3><blockquote><p>警告：此步操作需要谨慎，至少保留一个已登录的ssh终端，否则如果操作不当会导致被锁（无法登录到服务器），正确配置之前先不要启用防火墙。</p></blockquote><h4 id="351-初步配置"><a class="markdownIt-Anchor" href="#351-初步配置"></a> 3.5.1. 初步配置</h4><p>Ubuntu 内置了UFW防火墙。通过防火墙，尽可能少的暴露端口，提升安全性。</p><p>我们首先允许以下端口：</p><ul><li>22端口：SSH默认端口</li><li>80端口：HTTP服务，如果你在服务器上架网站，这个端口必须开放。</li><li>443端口：HTTPS服务</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> ufw default deny incoming<span class="token function">sudo</span> ufw default allow outgoing<span class="token function">sudo</span> ufw allow <span class="token number">22</span>/tcp    <span class="token comment"># SSH端口</span><span class="token function">sudo</span> ufw allow <span class="token number">80</span>/tcp      <span class="token comment"># HTTP</span><span class="token function">sudo</span> ufw allow <span class="token number">443</span>/tcp     <span class="token comment"># HTTPS</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>sudo ufw default deny incoming</code>：默认拒绝所有进入服务器的流量（incoming traffic）。除非你明确允许某个端口，否则外部无法连接到你的服务器。<br /><code>sudo ufw default allow outgoing</code>：默认允许服务器发出的所有流量（outgoing traffic）。服务器可以自由访问外部网络（比如下载更新、访问 API 等）。</p><h4 id="352-改ssh端口"><a class="markdownIt-Anchor" href="#352-改ssh端口"></a> 3.5.2. 改SSH端口</h4><blockquote><p><strong>注意</strong>：保留一个已经登录的 SSH 窗口，先测试新端口可用再关闭旧窗口，避免自己被锁。</p></blockquote><p>不使用默认SSH端口登录，提高安全性。</p><ol><li>编辑 SSH 配置：</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">nano</span> /etc/ssh/sshd_config<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>找到：<code>#Port 22</code><br />修改为：<code>Port your_ssh_port</code></p><blockquote><p>建议 SSH 改到 <strong>1024 以上，最好 2000~65000 的范围</strong>，例如 2222、22022、55222。</p></blockquote><ol start="2"><li>防火墙允许该端口并启用防火墙</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> ufw allow your_ssh_port/tcp<span class="token function">sudo</span> ufw <span class="token builtin class-name">enable</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>运行 <code>sudo ufw status</code> 命令检查防火墙规则。<br />应该显示：</p><pre class="line-numbers language-none"><code class="language-none">To                         Action      From--                         ------      ----22&#x2F;tcp                     ALLOW       Anywhere80&#x2F;tcp                     ALLOW       Anywhere443&#x2F;tcp                    ALLOW       Anywhereyour_ssh_port&#x2F;tcp          ALLOW       Anywhere22&#x2F;tcp (v6)                ALLOW       Anywhere (v6)80&#x2F;tcp (v6)                ALLOW       Anywhere (v6)443&#x2F;tcp (v6)               ALLOW       Anywhere (v6)your_ssh_port&#x2F;tcp (v6)     ALLOW       Anywhere (v6)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li><p>重启 SSH：<br /><code>sudo systemctl restart ssh</code></p></li><li><p>测试新端口：<br /><code>ssh -p your_ssh_port root@SERVER_IP</code></p></li></ol><p>如果第四步访问被拒绝，别慌，使用命令：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> sshd <span class="token parameter variable">-T</span> <span class="token operator">|</span> <span class="token function">grep</span> port<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果输出的是你设定的端口号，<strong>且ufw中允许了设定端口</strong>，那么可以忽略保留ssh窗口的note，直接重启云服务器，重新以新端口号登录，应该可以成功。</p><h4 id="353-关闭22端口"><a class="markdownIt-Anchor" href="#353-关闭22端口"></a> 3.5.3. 关闭22端口</h4><p>成功登录后，可以关闭22端口了</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> ufw delete allow <span class="token number">22</span>/tcp<span class="token function">sudo</span> ufw reload<span class="token function">sudo</span> ufw status<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="36-ssh配置文件"><a class="markdownIt-Anchor" href="#36-ssh配置文件"></a> 3.6. ssh配置文件</h3><p>依旧：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">nano</span> /etc/ssh/sshd_config<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="361-禁用-root远程登录密码登录"><a class="markdownIt-Anchor" href="#361-禁用-root远程登录密码登录"></a> 3.6.1. 禁用 root远程登录&amp;密码登录</h4><p>配置文件中设置：</p><pre class="line-numbers language-none"><code class="language-none">PermitRootLogin no # 禁用root登录PasswordAuthentication no # 禁用密码登录<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>对于第二个选项，请自行决定。至于暴力破解，用Fail2ban工具可以防暴力破解。</p><table><thead><tr><th>配置</th><th>优势</th><th>风险</th></tr></thead><tbody><tr><td>PasswordAuthentication yes</td><td>可以用密码登录（灵活）</td><td>容易被暴力破解，安全性低</td></tr><tr><td>PasswordAuthentication no</td><td>安全性高，防止暴力攻击</td><td>如果 SSH Key 配置有问题，可能登录不上</td></tr></tbody></table><h4 id="362-使用ssh2"><a class="markdownIt-Anchor" href="#362-使用ssh2"></a> 3.6.2. 使用SSH2</h4><ul><li><code>Protocol</code> 指定 SSH 使用的协议版本：<ul><li><strong>Protocol 1</strong>：SSH-1，存在严重安全漏洞，不再推荐</li><li><strong>Protocol 2</strong>：SSH-2，更安全，更稳定</li></ul></li><li>现代 Linux 发行版默认使用 <strong>Protocol 2</strong>，但最好确认配置文件里明确指定。</li></ul><p>在配置文件中修改或在适当位置添加：</p><pre class="line-numbers language-none"><code class="language-none">Protocol 2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="363-重启ssh"><a class="markdownIt-Anchor" href="#363-重启ssh"></a> 3.6.3. 重启ssh</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> systemctl restart <span class="token function">ssh</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="37-fail2ban工具防暴力破解"><a class="markdownIt-Anchor" href="#37-fail2ban工具防暴力破解"></a> 3.7. Fail2ban工具防暴力破解</h3><p>该工具可以自动封禁暴力破解 IP。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> fail2ban<span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> fail2ban<span class="token function">sudo</span> systemctl start fail2ban<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="371-配置fail2ban"><a class="markdownIt-Anchor" href="#371-配置fail2ban"></a> 3.7.1. 配置fail2ban</h4><pre class="line-numbers language-none"><code class="language-none">sudo nano &#x2F;etc&#x2F;fail2ban&#x2F;jail.local# 添加：[sshd]enabled &#x3D; truemaxretry &#x3D; 5findtime &#x3D; 86400bantime &#x3D; 86400<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>enabled</strong> → 是否启用该 jail</li><li><strong>port</strong> → SSH 服务端口（可用逗号指定多个端口，如 22,2222）</li><li><strong>maxretry</strong> → 超过多少次失败被 ban</li><li><strong>bantime</strong> → 封禁持续时间，可改为 <code>-1</code> 永久封禁</li><li><strong>findtime</strong> → 在findtime时间内输入maxretry次错误密码即被封禁。</li></ul><h4 id="372-查看状态"><a class="markdownIt-Anchor" href="#372-查看状态"></a> 3.7.2. 查看状态</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> fail2ban-client status<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">Status for the jail: sshd|- Filter|  |- Currently failed: 3|  |- Total failed: 15|  &#96;- File list: &#x2F;var&#x2F;log&#x2F;auth.log&#96;- Actions   |- Currently banned: 1   |- Total banned: 5   &#96;- Banned IP list: 123.45.67.89<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>Banned IP list</code> → 被封禁的 IP</li><li><code>Currently banned</code> → 当前封禁数量</li></ul><h4 id="373-解封ip"><a class="markdownIt-Anchor" href="#373-解封ip"></a> 3.7.3. 解封ip</h4><p>如果自己被 ban，可以在服务器端解封（假设你的 IP 是 <code>1.2.3.4</code>）：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> fail2ban-client <span class="token builtin class-name">set</span> sshd unbanip <span class="token number">1.2</span>.3.4<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>解封后你可以正常 SSH 登录。</p><h4 id="374-启用fail2ban"><a class="markdownIt-Anchor" href="#374-启用fail2ban"></a> 3.7.4. 启用fail2ban</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> <span class="token parameter variable">--now</span> fail2ban<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="375-小贴士"><a class="markdownIt-Anchor" href="#375-小贴士"></a> 3.7.5. 小贴士</h4><ol><li><strong>改规则前保持一个活动 SSH 会话</strong>，测试新规则生效再退出</li><li><strong>先小范围测试</strong>：例如 <code>maxretry = 3, bantime = 60</code>，确认不会误锁自己</li><li><strong>定期检查</strong>：</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> fail2ban-client status sshd<span class="token function">sudo</span> fail2ban-client status<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p>做完上面部分后，在云服务器后台创建一个自定义镜像，备份一下，方便日后快速恢复。</p></blockquote><h2 id="4-系统维护部分"><a class="markdownIt-Anchor" href="#4-系统维护部分"></a> 4. 系统维护部分</h2><h3 id="41-使用expkg"><a class="markdownIt-Anchor" href="#41-使用expkg"></a> 4.1. <s>使用expkg</s></h3><h2 id="5-系统运行部分"><a class="markdownIt-Anchor" href="#5-系统运行部分"></a> 5. 系统运行部分</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;details&gt;
&lt;summary&gt;版权信息&lt;/summary&gt;
&lt;div class=&quot;admonition warning&quot;&gt;&lt;p class=&quot;admonition-title&quot;&gt;warning&lt;/p&gt;&lt;p&gt;本文章为博主原创文章。遵循 &lt;a href=&quot;https://c</summary>
      
    
    
    
    <category term="VPS" scheme="https://blog.godmao.top/categories/VPS/"/>
    
    
    <category term="VPS" scheme="https://blog.godmao.top/Tags/VPS/"/>
    
  </entry>
  
  <entry>
    <title>哈希表与设备号</title>
    <link href="https://blog.godmao.top/posts/7167/"/>
    <id>https://blog.godmao.top/posts/7167/</id>
    <published>2025-10-10T08:31:46.000Z</published>
    <updated>2025-10-10T09:46:29.493Z</updated>
    
    <content type="html"><![CDATA[<details><summary>版权信息</summary><div class="admonition warning"><p class="admonition-title">warning</p><p>本文章为博主原创文章。遵循 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh-hans">CC 4.0 BY-SA</a> 版权协议，转载请附上原文出处链接和本声明。</p></div></details><hr /><h2 id="1-哈希表的通俗理解"><a class="markdownIt-Anchor" href="#1-哈希表的通俗理解"></a> 1. 哈希表的通俗理解</h2><p>我们知道，线性链表灵活性高，扩展性强，但是查找效率低；而数组虽然查找效率高，但是扩展性，灵活性都不高。哈希表则巧妙的结合了这两种数据结构的优点，不仅插入、删除数据高效，同时查找效率也高，但是内存占用也高，相当于用空间换时间。</p><h3 id="11-类比快递仓库"><a class="markdownIt-Anchor" href="#11-类比快递仓库"></a> 1.1. 类比：快递仓库</h3><p>想象你在一个快递仓库工作，</p><ul><li>这个仓库有100个货架（0~99）。</li><li>每个快递都有一个快递名。</li><li>有一个hash牌的编码器，专门把这些快递名编码成0~99的数字，你根据这些数字把快递放在相应的货架。</li></ul><p>Like this：</p><table><thead><tr><th>快递名</th><th>编码结果（货架号）</th><th>放到哪个架子</th></tr></thead><tbody><tr><td>Alice</td><td>hash(“Alice”) % 100 = 37</td><td>37号架</td></tr><tr><td>Bob</td><td>hash(“Bob”) % 100 = 12</td><td>12号架</td></tr><tr><td>Carol</td><td>hash(“Carol”) % 100 = 37</td><td>37号架</td></tr></tbody></table><p>WTF？Alice 和 Carol 都被分到了37号架，怎么办？</p><p>聪明的你在37号架上放一个“小篮子”，把所有撞到这里的快递都放一起。<br />查找时，只需要在篮子里翻几下。</p><h3 id="12-理解哈希表的原理"><a class="markdownIt-Anchor" href="#12-理解哈希表的原理"></a> 1.2. 理解：哈希表的原理</h3><ul><li>hash表就是这个货架，可以理解为“链表数组”。</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TABLE_SIZE</span> <span class="token expression"><span class="token number">10</span></span></span><span class="token keyword">struct</span> <span class="token class-name">hash_node</span> <span class="token operator">*</span>table<span class="token punctuation">[</span>TABLE_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// 数组，每个槽位一个指针，初始全为NULL</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>整个快递包裹，我们可以看作一个结构体。结构体成员“快递名”即为“键”，它们用来索引对应的快递；当然，结构体成员”快递里装的物品“就是“值”。</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">hash_node</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">char</span> <span class="token operator">*</span>key<span class="token punctuation">;</span>                <span class="token comment">// 键</span>    <span class="token keyword">char</span> <span class="token operator">*</span>value<span class="token punctuation">;</span>              <span class="token comment">// 值</span>    <span class="token keyword">struct</span> <span class="token class-name">hash_node</span> <span class="token operator">*</span>next<span class="token punctuation">;</span>   <span class="token comment">// 指向下一个节点的指针</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>编码器呢，就是所谓的哈希函数，它会计算出一个整数，用于将“键” 映射到数组（哈希表）的某一个槽位中，也就是某个内存块啦。</p></li><li><p>一槽不容两键？nonono！被伟大的hash神分配在同一槽的键值会形成链表啦~</p></li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>value<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">%</span> TABLE_SIZE<span class="token punctuation">;</span>  <span class="token comment">// 计算槽位</span>    <span class="token keyword">struct</span> <span class="token class-name">hash_node</span> <span class="token operator">*</span>new_node <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">hash_node</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    new_node<span class="token operator">-></span>key <span class="token operator">=</span> <span class="token function">strdup</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>    new_node<span class="token operator">-></span>value <span class="token operator">=</span> <span class="token function">strdup</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 将新节点插入到链表头部</span>    new_node<span class="token operator">-></span>next <span class="token operator">=</span> table<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token comment">// 指向原来的第一个节点</span>    table<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> new_node<span class="token punctuation">;</span>         <span class="token comment">// 数组该槽位现在指向新节点</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>更直观一点</p><pre class="line-numbers language-none"><code class="language-none">[槽位2：链表首地址]---------[槽位3：链表首地址]---------[槽位4：空]---------| -&gt; 最新添加的节点         | -&gt; 节点| -&gt; 后续添加的| -&gt; 首次插入的节点<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>上文提供的链表插入方法是首插法，链表首地址由最新添加的节点地址呈现。</p><h2 id="2-哈希表在linux中的应用"><a class="markdownIt-Anchor" href="#2-哈希表在linux中的应用"></a> 2. 哈希表在linux中的应用</h2><p>在 Linux 里，每个设备（比如 <code>/dev/sda</code>, <code>/dev/ttyS0</code>）都有一个编号：<br /><strong>设备号 = 主号 + 次号</strong>。<br />你可以理解为：</p><ul><li>主号：设备类别（比如“硬盘类”、“串口类”）</li><li>次号：同类中的编号（第1个、第2个）</li></ul><p>设备号类型定义：</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">long</span> <span class="token class-name">dev_t</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>主次设备号可以通过以下宏操作：</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">MAJOR</span><span class="token punctuation">(</span><span class="token class-name">dev_t</span> dev<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取主设备号</span><span class="token function">MINOR</span><span class="token punctuation">(</span><span class="token class-name">dev_t</span> dev<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取次设备号</span><span class="token function">MKDEV</span><span class="token punctuation">(</span><span class="token keyword">int</span> major<span class="token punctuation">,</span> <span class="token keyword">int</span> minor<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 组合成一个dev_t</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>已注册的设备号可以使用<code>cat /proc/devices</code>查看</li><li>内核是希望一个设备驱动(file_operation)可以独自占有一个主设备号和多个次设备号，而通常一个设备文件绑定一个主设备号和一个次设备号，所以设备驱动与设备文件是一对一或者一对多的关系。</li></ul><p>内核就像一个大仓库，存着成千上万个设备。<br />系统要根据设备号，<strong>快速找到对应的设备结构体</strong>（里面保存操作函数、状态等信息）。</p><p>于是它用哈希表来实现：<br />把设备号算一算 → 得出“货架号” → 直接找到设备对应的信息结构。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;details&gt;
&lt;summary&gt;版权信息&lt;/summary&gt;
&lt;div class=&quot;admonition warning&quot;&gt;&lt;p class=&quot;admonition-title&quot;&gt;warning&lt;/p&gt;&lt;p&gt;本文章为博主原创文章。遵循 &lt;a href=&quot;https://c</summary>
      
    
    
    
    <category term="Linux" scheme="https://blog.godmao.top/categories/Linux/"/>
    
    <category term="内核编程" scheme="https://blog.godmao.top/categories/Linux/%E5%86%85%E6%A0%B8%E7%BC%96%E7%A8%8B/"/>
    
    
    <category term="Linux" scheme="https://blog.godmao.top/Tags/Linux/"/>
    
    <category term="哈希表" scheme="https://blog.godmao.top/Tags/%E5%93%88%E5%B8%8C%E8%A1%A8/"/>
    
    <category term="设备号" scheme="https://blog.godmao.top/Tags/%E8%AE%BE%E5%A4%87%E5%8F%B7/"/>
    
    <category term="数据结构" scheme="https://blog.godmao.top/Tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>Linux文件操作调用链探究</title>
    <link href="https://blog.godmao.top/posts/31088/"/>
    <id>https://blog.godmao.top/posts/31088/</id>
    <published>2025-10-09T12:57:35.000Z</published>
    <updated>2025-10-20T04:41:56.812Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="ERROR。" data-whm="这个文章不能被校验, 不过你还是能看看解密后的内容。">  <script id="hbeData" type="hbeData" data-hmacdigest="8b05ba2651631f7cb1047ba543a4fd394e79cfda7518f01522219d4a419b998b">472f0d2124ee617a2f29ff331422d5d3c786bf02d6cb05b48659c7bd0efc234c66e4d05e5e352805b8be7fb548f5db1dc6ce19185f33969b60366e77544d242a4ad3617be960d1cc6fb50f20f9bc3fa3dc4611c1b7fe65e71a5a3a53a2361ac23d01b5245c304a9c64d1f2d42467b313e7b98b9941501c7f62ba70ae803acc1147cacc437bdd5678ef1810bb19b628c6a4bce1bcb2f217b0631590f4a05267a7a121c769458bb6d0d3a007991a4e5946e6e80bfdd70ada16fe8b7f425cd91ff2fd2c0d96e6a7a61f2a495ff7c5d17f33392096a74bcf83fe0a2a1b47dd5a8cc11585947ae9ce708ca44fe807a441afd12f8304730781830b4f9cc4f4cdf370535e05cecdcdde5fb485d559476d4a130b41d70fc5d6999e8bb9a1105d9fc8bad1acf6b48e4bca65932d62ce795949be362d42d3c4aa5b1a3df4213ed5be2d1da2e61473992a40a821237717333de4627358fc2994316e97947ee4226e077242b96086c45a364e40afbd1f146cdfc7147a4d6e76c5979b94a4913307ad1085c446a233c9f26cbad42cccf32b2f436b75b9dcf8678cf6a17b224aa41a3d85e7a486ebecb8cd72248741212a2637a718e6176293c38b1c78550d6f4e8d3efe378f35d4b0379629ce082eaacc3d549f856b134d425bb37b7f81062f40a5c585da897251fc57c0da02b739734217eb24b2b9b0b5bf093288acbe74532cfe9cc780af37bef054afc0ac5dc1df62f7e1e599c8e58e70d0d2781aaa947a153a309aea5317c21277568703ea62f374771fe624ade7ab3318db9ed4ef946ae1420c7b6648a7446bfb6c4909da63daca987a295a75840ba95a8fbb6aea4606a0104ea0a84995853d8a17d29a1c28ac604ef2a4b8d955db6b4250741d0c2c801cf92b412b118c27ed5cd79a57efb4aa44dd808f9fae8cacdcccae4a45e1c7efb1ddd71f26c5252d7657eee98753bc33eb7dd19fb9856b7dccee8b56d7d66b9d94a08bd1883b297b35c1138a47783d4c692cb9cb65d51e7404a79808fc68440353504642d52713e9d3507b0d12d9cde90331cb225a7d30d266990de664c56c76c40e7f524fdf61794f617654fd57a993ca2db16d9caf5c090d0d8e7b2f7ed5dc799a1b88f6ca2465e494f565d9a63eec0abec2a9c364b19fd94ed4ab4f64067928a12ed2539a4d2fb1bb4d1fac682a30482be6a402ee51a2ff07a32639ac224b60e181532aea7d0c1395456ae885ed61984949a8d24b302dc0f416aa7b18273adfd1846027a8e6e73f658d134769c48e3cf0ee57e0a3ca0f08cddfbd6df66e1b4cefad811fd12b2795aec7f4cdf8e48bd5e93699bf27de8bb279e29d4c5dfbd440b54f513416501f2a43df4a583d9ff321253244e2c225cd0532c5ed5f7519960b8d2ddd0a581506e535f7bf56d15edcc78658e32b4e36d2b71e33a1dff0bd55e4339a0702b60d62f343a0a6e1dc75a38eaa103a5d4c3e21764cf8070f337b12fc9dfbec24cba17fd783181b69a67be742569cd829622cccdc612c891e67f7844efaeb4ddceefde0726f29a394965ce92e97d0752514289a99b588c7221fa9c740f0f75bd9006005b68d35dce4af250a8d873b0217238ea45e748585767eb17dcb0573edf798cfb51cdf86dad758424cde24a60b741b90a537d033186725be897fd86b3aebdcfc20f56b58dd2ea544c1c5b98e04f984a0488c76b9b43796efd2dbcfaabe5f9d3d3d9e5698f67c8fd1d547e8cc4aef1d3792c43331a24dacbad8bc8145c3d8c3874d40f911fe88cfe88e8ef54e920f8f702be7c0375090e63bda64985a5121f542b4a7e571dc2ba134293fcc9960fd389e99f349040b76c9c48f78564c3d1d70ef2742ecab88c3997f2858424c01a6b93197b0c56437ce6a1a8ddff8fcbd11224e233025f4340b86c4ecd60d902d7cfa3d10c4fb7bc9014bc77a5f41af09e35c6bad7f14b7d4e3f3fc353e28c1b029ee0decf5a694b8b90088f2afc9cc8177dc83f548edf1c84dbf680c1ece5508ce119b2cd26b46d0262a8c8ba471fdbda632ffce0843ce435862ecba0c59f9ed902084315613dadb3c9d29bec27b5ac3942c44f5575e71bb82efc985dc1bb451a06bd6cf013f12e7685a2f97b9781f68d936a61edfa1693e38ea7bfbf690dbfda37062f69eb4d27337190116a2d4f10f70af8cf361345ee02dbe49e826885d80a75225720715621161a28694ff9a36c7d49fbf1e1d373e5f15a81ff162c245cd5284ba8de5502c0815531132a843cbd424d7892c5c6991eee74635ef3d40a5d85684a75b78e88f437ba1cb60370c56cac0085c49afad4bf3b92c3d9b195d466e7c954ccd2cc28a7df27d2a83289d13e5c6fdf26047f7cb87ebf81fc32705a0e68d027fb11e723cfcf621dc76eba3359b0cb7a5ec1c7315d3669a4671a1d8cfdaee2a1cf4ef9c26ded844ed61ad8aa126167e34e41f9fa5a0b79808bd3ce0bf158dc6efd274bf7e4b7af19ef72800031b2fa6a0bbbfef608af530eda9049237a644d4e91915ddbec564c68ef05cf8436a62c8754b3af165e0c187877d5360a48d43b9865eef88a077e4acd9f361111a9512f69c162e302123d6b7991a61e0208eaaabba82809be0f1574e4e05761e3f09dd52ac89ba7463ef6fa3f1382436db28e49400373cc777bdff68c677ef9b8485ca24ccfc90d7b1f0014f57c61bd0f0f767262407e4831d28e9e72efdd04c411f79204848b9f76e94b39a5e42b96856b06e4d570289e84cac93ff23b41f8281ddcbc79773fe76768af7893dfebcb0fb19f607820dc9f4d4534e6816d245b38ba0a7ac6cffb0f473d9e57e66e22053352cf376522e932dd55d2d7dd5c2901a99fca59baf59680d2f2814b619815011f2a636ada9b11b7b32a6760ce2246422379b49edabd2d24f11e0680170673d8cc0a74f36106132b16285c4592bc6d3945d8fd9f35e8cb8c6379c5607d1bb3a51057eb9192b98e934ecc957fe2c5d9d3c3599afae3bf2d9936d4a6737ecb3c9f090bd9838054483b120d5592d8c3c302fa3cc6fd34ace01564126318558ffbdcafaa47e122eae848537bdfbfb996ecb46c3e6505829edf55ae95489a481a453acf136130c1d5febc210ce27b2a8cecf5644491689be529935f12b9fd4eee08efa3177c3b63dc28121be5687ed48d14e06e0b3766205da7ecd94e6be694fca83c3089bdbaabd35aecdcf6e43b92307f97448576b3781a53c5d9533f6f992563f0f2f9e39d744f753986de96feec1e9ff821d42201a33964f092d146949c5469e4952767af3be76e0308b09065257bda87e057fcc323d3769c9ea039ee6af7c5ed1bf2aa06612b13ace98d86c33c0d349388f297347b65f7ac57d36b68592c2512a317334bd73181eb498e65212e1be85048dacbd38b24bf942a8608f69a4be8ca982748fc3c9e811d701f7520344d71329a21a8b8b5017da4c8842e4e4982a9477917cf9bfeed7feb3f3dd762e3933f7cbd2a4f176b9c0ca77c359841395a1ba0470233c9ef80b1bd12bc5d033a260ed6b11839219774525c69be3a2b753917790884c718429744902cbef6c75e04eb4a38fafd03412e3fc17a4b7d37e04b08de406fc795f0c9cdaaf3aaa21236966a90b6cde73ff3e8fabdf2556f5b6aa0bddf6aa8b68210f796aabdf9543459d529248869a25160298deb86e14a1760b2b221e9869d3cbc9c54c66bd811441b2cbed34dc20968755a2b61ef382843a0ea887edd5a35ebebaee506ba4a7092418ae3139bae6572b9e3a9b04f15f604066ecea0ac14f7becfb37b0b7f4ed72b75bee92311aa4b931132ef3102b2262dcab3d631c559f511b3e7c716ce379457f6bf51cc38b0d74f64246d084c4ec374c8ff76c72dcd5d9d88e77c1ff8258063ba7a3d4ca82232868d9980de85bb7a9aa7c17f6adfe3367eaa549f0ea3c6c4a27b724ebcfcf8e12bb82477d3faba4e8caf9434f247baa92da6cb7733110125e7dc6a9393929e4b75ff522653a71692a21acb23f41b77870c14932dac96a842685805efd7a786adb819c021a8355d9b930091ceefec6d7041b5d90da718ac9ad415beccf59e00c9366751825da7c22ce16b41e6b599cf8006026c7dc090e3c3dbbcfe0b4f3ba373b6db3bdd9aeadbca283f0be51ce642358b260d6bad01f5ba322e442f839194f1f91977880e069f58f56ac0477abef09745e76ef9fba2b049a2b470941d62e688cb1e83cf8599f816922d58867089d85397f65ef337f5f6393ab183ee7b0b8b5bd694361dcae8f4566537a498a6df608ca00d2f23b4bb50b6ed0e378bdb93c345a47dd2d10514825973aee45a6c1dc2c6671857d4579e8e2bdb60c1716bd16cec7705e674a5b6b4186c11f8f7cac1b06e4bba5bbd9e1171eb3db76e27dbeba61f68f1420e71772f0f4228773b8749bf0cd738fd4052dd0c90a78d89f1dc8281ff4b43db80fccd14bf304e7d8d1539500b524b7d865f4254d2d8ed342f4f746e0cc9c2089f1a5a095c98797aa959c471c34aaca16a002804dd15bd0aad4a5c7e636d65757188135b4dbaf3b96d1a81d75d45bfc362ea5af32551e2577ca375fcd4ed3c766226fbcd310fabf4ea51fca453a08416f1562e15220851c9be6b8c3bc08750b868a757952e20f234f9cce0d41b93a3349083b54e2c66d9f9d7c4c3f9b644ed4d095130e2cb3a4136f18da5bb11e7169b059d4995829a9979766631378b321047a3dc76514d043f17b4d6599680b6efc87008204b0ff24acd2aa04b0f1840d32c1fba2e55f6cdb442dc3630c177ac97091a65643d3ff60f5bf6bca44acfee08b24e5ca14e8078cb24c5f5ede9c5683c0075ba8a3de1f30f51b34c3de4edb6838d3aef7d3d04bbcfa8a4b6087b2d7abe5eef5fda10202449a39907f7a5a47c55c8b6cf7d657d26dc7d4f69692bdf4ba02ccee47309c731db4aed0a0810207501ce68f39d2205658d14bd983ebf708ef3a888dfb77790ae3d73363abd24ff9005dcde0227dd12338ec9f0ec56eb5fd1a5f058b6f18ce725f537ee327b7c6798d3ff98ab1c498e4f844cb0184ae1f364eaf5ad19047ccc4a499a16b5966dbd630cbc4affaa43f12d8b3b2409a9aa66d1b412861433069dcc3a75051d3035ee28ae7b1828ba7b0de61f812a463543668aa675306489442d6ed957f085d107b3075a1068418d364a79362f247c1ea57ffc3d6181bacf7f5b293d02270009feda9f02ff9035637ebf6095e4422b1a888339dc099e55479626cd0dbcc6c81ed83153e8dd253dcfd774f97483bdaf0e458ce7c78a2a02e9e1c1fb83df4ded5239f5e63271ca13a68bab06734f932ed5ea7c6f474042286873b6bb8bf7c3cda6a0ca3e7103642d1432a2ce45a89796d87c7d1cc5dd416ee968d5463957d9aca385f645880c90aa1c05b8c0d81fe5990bf4f0c228101707254a83f1ccf16d73fae8bd388500b72e5b20cfdc212bbc932767cc7012b1129d60715fe19753b2dec76daa4b5af76790d080f46aed9e1aa950336a2d0a3603ab897f552b1fdeb5e47c250783707c193f727d74d6ce09a3d2e806078e59be2c9dc037d108dcf7c8b04dd8277e0bef7bffc24b08fbd996173f56e4dae94b40b1c0977ecd9e055ae38302676a1dba883cbabcca90ee8ee08ef11eeebb65d3dfffc90d6c8a0b299245185504ee49e3ebce234e50f32be3fe633c3df3c96ea85d754779b69aede8e356bbdc5dc0668c8f2f547c31f9551ac47348d5fcddc980ccb9a00b473f3a8e835bd42a89046fd475630ef7461976290963da295f99791dde4a4907f5aa72521000a439d0bc7f2e16ba77a8f25920d5db067bd010f255fec12aa3a5191cf85f857d869cb85b79c83a4569d3ca96d3806c95946db16a7d8b42ace5d3c0141743feb2a58e71f4462da25587a1ab24a1921199deee523b9e7d9df15507f4d7ee10441fcc851c690861c046aeeccc831e4f0f2978e24e8fa9ad4803f31558b5a1a349e900d879804845eea69d905056b0e695789445d7fd468543fab38fe62fd68909670578c8c938fc5288c11e0e0398345a157098d6c562c5b667500b447c29e340ddc9a5daa852e944e67ece01ed5e10487db01359593d0c54cdbaf5f55338b117a2322b9962b07d4b80c93e2fb942f19ce4f419204918f4fa82e8ce818f477abfd9bf1ad5bf3fce6dde1c2db34f46cc172ea0b6c5920b1f77847ef423ab5ed108f7b60288574e9a3e95b3f821726876aeec650cb8819688871d59cc0f6a7b5bbab3b925ba3676b4fe77456bcdee83a3747be9616d43cb8f6aafc4189176a816faa00e1caeb3d15ac81ba033e97cc901a1537bacdb25f9a8924393dcbd9d85639b43b0a9ef21ff3b85936d945152472daa73a9ebe977208a860e285c030a89b2dd3dbf2c5f5308d30cf7a8b2bc5c3b3233bb138eca0fce05dd139f2611bc8d2f590270c02745002c8ea8bd21db500fe26bd95402c1115978fcbe6fec553fb1862ea2a24b93eb73fb53b4e9fa412d342842e0f0fd612701e4aa5cd6ef513bf153bb2a05819cd4e942c65ac8febe2545a71bb343efb410b7ddce0a9263cc555723cd141c96326144cc6173de4c8c16c87ed776a63ea437e39233e5f31184da691c9bdd0e976d9db026940a9a2e955a4f50008a4bbf080b948d7e3bd074cad32e4296f0d5a937356cdcc3e26a5a85897f7b1a8a8d9dc2cfb5b9f6a15efe7d65f762c4f33509391c3558198af3a2eac918527082c95dbf5f9e59241b4b131ea7e60103afee7795769dc11dbf1c31524214ce6173774011b5d57bf5be970418be9534709352f10da901fc9fa023611d15c163902f5eb75f77e469f8a221afab5d45d16c6d29d350289be4b29a146fd8895c87f1eabc8e9211f066b7b9f80637d2a064fd38e726552a26c86bd0e747453fa6b483383ffa583c83bb7ed1dac83f67bfd22c8a45bb49b7bd900a30b8a23d6448bcb3bcca526a1856dcd841c6a94d901e49ed1200c836d2bd46a72b57f8a8694cef564b461abe050a7284979fe30e630ba7e1c37b2b01f73fa557f224b89848647469008087333c99a255f24f9038c233fec0126ebe608fd309eea2d63f8ba1b42cfa619fd2b93e66d3b1258712f60cf20b4116e34eb51ddc9d5b13ff5a79801bafc81d0e6bae10e76677b6c33182a8bd1646839f9a07d48bea7fee1ad7bda6e810448e2946fd4ef9a4506a307624ce85cf0611c1e09f3d3579e4c7e7f2986afedeba182df56824ef32e376acf789c0e38d5b09e03a9e76609716bb9d48190a8abb0437191422d533d1c10d16c830853aa207d68391342d2365f15b107921da3ec1719d480b8ad418281460217cb1175158d38efa68f6729c1f3b8d36fe6adcd111e5ed4f55dd31c1265da890386e726e451a33560ee977713105427ffffda546b8aa646b413ba3efb3203664ab2b7c36fa23bc4454e4829d66fd1ca0ae3ac4c96cf4afd134861deb53becb866d3b9cb1e04852ee41f78238ddd03357b7283d39f48746162dd4b2e6e74e587890bab94463ce20143827e481d7a9c84ce1a2ca0ac7809e94492200f75bba094f9f7265fa4f8f287e0e82ca2f91b402f367075235f36ad9b8645b0571b7daeb146e96c2eea42de1f2225fa7704a17c198d3ec3e978a57caed0ead7570fe9ec08c9013a59587965187f42465b417c9580295766a182a5440c13ed38f7b4beae40f4234abac7cf4b75e9427bc6cc83e32fd17046092c5f06c58f6bbc65de324f983d345bf3d36303c127bd238bfeeaaf49dc79f336a9f70e7ceea176572b4bde197020bec76b5b4dc353e9426a8da44673d234399ea08951b5519e35d2fca68f71f99c12d4f1674c055586189d3a3477b0cc6f5fccc5a469e346ca482fd2a3366e7e2ce5ec4a5afeefc169502f803fc9110370310dfebab84d64ee3d06395ade39790617e07160cd95c2e66807657c0eebdb4b753315e1a3ff12980cd524bb91338c2ad426a80978c63076aa9357217ba76742cc623590ae8b9c68c782a8e68797ba719f43056ea9ec90e96447d0854f961b5360509b5314a4f31629f1a8820fe31f1b85655bce37913573a9cdb6004fb650bc422591f9727b684b46527c63f19f20aa65fcaa755f31095fa62f1a52305b254e50fe88ba03b279816bdff32f71a93f4a1aaf997dcd0691b20e2029da1bb047784607bc6009f8d09322705474dec0ad7720f7a871be1f5f5bcc1e4929364a78b71555cf21ffa35e303196eeb6e87affa984a026ce53610eb398c2bb1b76c9605de92599a145ba2200c788084c7262178eb09d65bc085484a39c1c4cb31b7325c2a8c19ce855be0b384a897c04168af60ec672d6259b1e8e1f98553dd2284f83382fa88439c9c9fcfe514d2e2e09ce84b311826f2e165b8d8049629cae50159eaa6c33f20e5763bb8465485a4943433aff43e03d5f3aa104910ccf72a7bc8cc60896fd37ee4bf53f48677cd68be15e1c04e6092f1beb81b6e37f35d1cf1b652040034e23df79d9bbbaf1ecf088ec9a49e49b80a19938cc25e888b37f862667e734455615a9726d2efd681aa3286a7540a276bb8a7ab3cea47c2dc5f2ec3e520ead5eea16938b4f9268a837cf3eb398de8441d06ffe061fc6abca94c8f8dac402aef2887d6641ef8686c321cadc5b2ff4d0ae93395dc7fb9d1dd3d74b233457b42e3fa1eb0ba6cac77695548818fa92e8d21803af2d47378fa6b93f6d35875184347dc1b44a8cac30d17587b3dab80376f0a8705ff156a04d89dd5c10716ea84b41bfd9944b06ee4472b848e7505286f4b8b3f58ea31039f408d5c74965248c6205c4c3597ea9ebbf58b13786434175ab89c6789a70526391fbede009189c4af0037b4bea6810103a852c64fa372a930607ab8b4c2a5c0332d61232bcb4ac46d96a78c1d7d2e39788009c6a080cb56a9d605a8b2424864f7d14af25f364d3de60eb43f544401b0174a2df898adbab871d674a833bc6710467a5c72f899d31533d66b08761ddcfd65302772ba68b02945b630aab95f2ac265338e70288e15d380f5ae6be72c6b4c7863795329fc1fa403f6029ade0f7e298b4b3bc3d114e2b061e59341166548dd138078cb1934ad5638e62df3737e1bef96ef54b5de25fb9ec06f364b996841811e92c061913f09d8ff6731e44fa56d29ca91c1deec148f4c5d1627dd0f5f8e982baecb13ebff4911460ca0e7c8acbea900d79d90092c4525e7aeeb9bda92ee7b9cd6d40e8e1067ef44aa930660c2174cd045fc434026051ccf7f8a4e1c9dbda3f8f95d9e3361be80bd0eb68114e41f318390539526260b3e1fd5dd9a60f71eb3143e592cc7101882818981e8f068db5f425cfb34f96523a92eefc3753b3b7536b519b01ff844a88b26129928139ed00159f6f2381d92e217247f5f111db5c346ca2cc32774837016da1f3f0710dc963cddf15c41ee3a32c72f98f4da6fb28033574654fe6a0fa6af1dc0e57929fe4f9df0d9dfc7469cb2c2e11e808517bcf6fdec5585f8117d9149afc5e597f3ceea041c9df28536035bf56f4f917699624daa3309f3b4bf1d325deb3541fa048ef70c75e0ba739ccf26193113e19071695808b47b3465780a19ac26e804632b707066f755ddfa26f11be50c8f349edbe5ec86972a7b1f8f9694423e6144d941cf767d7605000dccb036c047d165a4643eba087a3675f20d725a49855b86716d72ae2b2353be5e4875748069d03fbdf8b35d513e404aa2783d22be16ac9b87d1c17ebf58efbd50444a99a25d2c4fc7bdb6f9840896db6d2d1327d2cac0406cee42bea7513fb4d5527caf74af96b207f3cbc452a725b05021425b97ccaf67b2eb6ebd11c28d597baaf8b125d6cafff3b64522025502fb4f25de324b382e7b2356f6bf6ff1a4b81de71a130863033101972e56d2425c6d695a9409c5361b1eb5b893467e25ba345e776e21eeebdc298574b231e225f202316515c1491af9fbf7fb583690a3bf402a4dc30e39b144e57dd8a5e51881772100295dc79afb65248bbc5faeaf7581e5bb118d790c8ff60afe14cc344060e4017f5742323d323559adbc767ea67b6c9daadb4a778a5907d188349082c5eadc71be0ac256c139780292520be15765109c0b572b1c0e31190aa613282b5000145d699f9d8aba3ebde83490b8c95f251c55e3e4fd78a91a2517cad72af3fdcafccce14bee54cd268b25afaa3925ddbd6e8bb766e63ac3c12bda1e796a2994b78b2e73a67226bd5db480ae7b47d63e6e42bd653f129b32132a73d650db5aac82c492c7d68d1063b556194364d70b179d1e7bbd0d322a2d15c671698fbb299de7069ea335288d7e9c23abf0450186e539b0a9e8828ab402c1e83118020e5b7953cb194f706d001ab7a4e270ed7313badd75166d1ae108ba5421521d6250af1a4b8cfc18679c320d0e0d168156d74dbeea64c05ddc7d00093db23040adf498edd48514441853c00ef77c6720b24414987e756abff57c3900e8142d2f3fae12ae4dcd2f2c5096db12630f56d2a5ced5946c02395bdbf62516bfa4431cce18cbf53ec0795c03a37fa51f3610dac9d9ac26864d98e9d46c6b64d948e96dce6fa59a49570dcd05173fe1fba2d313082ea6d86df02da19e0d4ea6c74b7f9bc98138037d6d7587de98a642ba1014541d7e6572f0d8db0f6b179391e6c34da7fb15994a3ee3da6a8db7292d05b42f904bcea23520869edaac9998eebbd73de1b2e9d1ab4f2b9b841d526a98f5b7ca81551026b94509dfb36549d4bb1704ff4efd844fb090d4e8eb325e3d11416896694b5981c1101afc087bcef2015574dbc64fdaf4741352b3f1fbda58d5de9f8477cd3f93a67ef2c5f31c4b0926dad376d675882d3373fc747633bec3552095e37288bb7ddd7eaaf20ae05b3735a75a404f87141cd3fe98699316594f67b701dfe8195fac766098a0db5cf73d6865c80152b6573d350fe39cb4195beade2119a77737d91a5d8ac2b9cea1a51b376f04b903f6ba65d4bfa9e9109c9e378e7cbf7f226917aa590fe7652e4aca5e316821c161d344da0320e7acd5efe3ab8c4e9d587aedcb584ebb124f417d2b0df39cad75cdc1d5bdccc5a1c555382dd043b921a56ad908be01e9901fbc20f58b5476b74b5fd7186966fe467a80662a647ce8dcf59be3da0910d6ceb68fb59d9a4a3b44bf3bacda5a7b509953b597cc50720b7e5de4d3f24fcd7f5485fd06bf7d55eb84956e787cae21b800539cdf4880c686fd50c1143c1a07d1b120ac5daf0642971bbf2217b11e6d7dc1fcde30cfaff22f994f5aaea1738049b9d1d89836596ec61f5070ac179ac266631b5a29c587ad9975efe6601fe12e5c68d388921b95d6e0b9158434e8f423a2dc6d0171fa097193206602057879191b965b6ec0f6d4f8c920ae49b67eb1e2af0e1c5cf42532639e4738106cd662b811f39eabb1726c877528450ccfee4e32b30b42868976f1e1f6560265ad61c64a00468aa5e233acf7aa226b5c60e6ddc5b4a0e9d89520c8f21bf102baed6de2cbac56f4a4c841f019386f34b57e212eb8f523acbc7728ecfb1b11c9565e533927a88f897b7143ecac769d0eb62abd1ce655f1e8f0fd45677be021c3049b409cd256eba99b8190be9071f3b6a6215ed01aad234471b2c0b1bea8ed936591abf0006fd0f1f21c8790e4fd6ca1024df7c69ce98139cf0dde3a0b68bc7c3fab8d9fb2aa269aa05da54e902b3630daa8cc06178b6d6508a3530acbeb83bb829063b5cb05afad980bc1666afc46a3f102eb9a82a8539c0b18e4f1846b1988b6ec9defde02378227ae26ab50648aaabeb956d877f9cb2085e4a8af146c816ebd26e49d581cd58872143aa57e00688da97601ce85a472b727400d2e3fe63045e2f85f133d98f6ba0189dab7a2294ef277d63dc9b91975e7b196ef80eeecc35cb011de1dfb3389b09e32d431ff3131b4af46a7d0e6216da2f3cd44c49a23098803c8bdae41b17c58c0741cdf99d72086e2a1c3d305807b9fcffc2422de60346b081dd91f656fe1ac7f4db6c7e3d2318253f82f2fbae368f92e0f31dd11ecb42ebd0d5e6245291e7bfd685856747d990a92ca972479df0dc47a578e4da116ee94ca359d7faf829f02a49a202b6aeba0eae258f351dd14126943fbfc588b22a99a524a7faa0575f802606d00ce00544c00991f932512972ca10e50cfd2d8c830e7afd2c6a2dd1445e7f480d41941795cc542ec60f04046259dd0dfa9b967e9b1045ca7e7a4fa8d87839e0880575943a9d62eb9d8b9bf5ad759315970f20a718a0f28e446ae3aff7cc5bd2ba6fcd5dad0ef11da9be81c269f84a9594d1a6777fc6a1cb9b4d509dde8532acb39f0168f5e495e99f86aaa414de806f9dce53c2e1d813f0ceb6c328183158e3d99c866942c9fc6aa4479c00713e3bfbfc27fdf60fa985c3774234d04bb853e15e5d6aabdc4d3c37d7e911c5525b8473a54aa254ff9b71a86575b17a96a52af1f015b9c83c618d96c3425814cf9a1137f3fb65fdd981bedf89514aef2245d6a650fd2a366c43b8e902bc5e7f8b92108871b5d98fb76fedab45983f5cf7d7d2679a8abaada4da31babb53a81b3c601106f4f1c4e2cc15753d91c9eed9fc0e68baab8e123935f67800c7035dfd1b1a102e3f539928c2ace7e143a9c868665a3598c7574f685e749082291aa59648342d5a0e4962d372659b08542926e0caffb3c642ba8dc04be82394bf73a6f6037abc0294be2c6a9166eab32ce90d9afad79f93e5c066644ad116a9c30cdd8d72f9f7a04f110ee52cb8609b4cd5d557c93dcfeaefc37b5572107917efcddaa4342c9391e6cf90fbdfab562d8e1ac73d9146eb73c433d91834f1c70eccc07d774e9f52c8fc0ad41c3541131d2604c572aa4d5b4addcdba7395f89b3b9a510c682e450fc4971b7b62fa6f7960846f461d72d298431a6584b688626e581a37c8b2c9087562fa0c1072da6d408df88ab6b351eb1bb2f57574b09ac4a6228e991eb257e1730ea7a0da6a1980cb19791c77138c693da2c5719909dfba32448fe509dfda6e1339d779ccca89256440958bf49a0e56f40f1e314095951ea25f86d7484c9c2eb93747d3122ebee743b39746ac204619992daaaff1367d1e8debb43060598e1d0572aafb285c5d892938868039e063d45c4239e74c1e90609bfa1ab8c67a6aad648d377ef52d1154c5cb711a626eeedf11f36ba3a4a2d77917efa89786880f4914d229d9fa447c47c7139dd85e0ca47ffbfe13563cf85faa489215fb4e73ac219c8b326170fadd3f1ed2ccff81693e1452e328d3ebc0509c7de10413f7e77fc1c9ff98f397f97fd03d811b59209b79e22b734fc1fdd5da8d2c698867a7c981fc124bfc024806cd307b92459c639850152ebb5eaa0a6c3c8063c85614ec613ea166f611300f72482c022ef5c555539eb9eb1fb6e339211af94e2b2321059e9349b891dc113ce167f7cb5375eb72c1ecaa4f400166718a8b72bf6e41c8a387cd53334779046d72a3ce5b9e098f6f7f727c2185f36ac27b669dd0d2865cb939e79b8c70501fbd6e0b39ced3ee9ce99be316527dba11ede47da6e91066e3b3fbce7cb40b921fbddfb7102e10299565cb2822f0fad434b2e459c27f4a959fff1ff7b04624e540bc363013f762b044eff9730fa3d22862697a2ba9176fa7259879f0cd1e168c44a5a45f3acdccf5e74eb53cd458bc5f6573327164ed510e9c5c0aa01f9167be1e0781e6f42de6469276f570c5ba620d47600aea6fd98c9ba198408960fc5bd57ff94aa86f4fa73088e1ca0b4c5b2996c2c0d4ba4030e3268b123b6ad5dc442201e3024e36de69ce2c390a21b3cb6aec4c6a15f0a567f6c55d5f9f95ecc95bf19b3812dd6eda7524f54ded9da2ad475121c524fab84b77c5cfe9f06fede5caa46b70428531bb9a62dbb1d06b136d0cdf186daaa2d19212177fa4c0e7065b77e06a9f5f54d45188de4137d655c6aee43a400af51efeb0b46611aea6dbc2411efb38c9a63f1893fb9dac7a2342ff7df5f85918097cd235ea3511123210fd61de198835e021a94a84062292f24fbcc38ec1d31787b9ac9d34ba3d5e71c4d9b5c1a7e319b7f277ce9dd47bcda7900b48c32a29f88a248b74eeaaba454d9cf23f3c58798ef6ad98e7813e1056d8eb9f8d4c2ba5d7b9a51c3b52bad04eea2cfcfb34d03bad0239d14d148795a98e0aa965cf90a71f0f0d2f65264e9ba834eef675a1374148ec9fa9a44423cbe1963d39c7f13c12b0c260fe9d8b65958ca0ba8d8810e30ab3f91903b965ee424f3f77c0d4f3c000d554a6df74359fb21266d4d461b872d9e5b78100032698ae9c42eda257a72def8e8b3a3fa07f8d3bf92293fee73fa3613e91a59b8156714bca31dc87f5493599803a5cb0a13469a0e3926938754e4e36c0159087ad93d3b7bcdf59f482d3067d7e801a7e70c180ddc7d1aace64fdc29853fbb6e5f3f1d16f3661e8be9749aa0408635df7e733f5f07242336e2b4d205885f95ba9b448fbbd4f40e66a1a99b8c082e7ebf85a688812d666a8b54f9dc0c66c22f0b0b3605ab54e2813faf45899913769a0b968f675907a71be0f7c6fcddd2ef0d9579d7ea7160ffa0c0c47034645e2d0b2b48f557cbe6227adbcbd45b4e38da8dc3963f39228238a6d309d3d16514cc602579d8b25fbbd1626a463ebed0de7245e2ea713759cfc5045ca731a5c10347e2b2631f4aca8e23313032f2c610ca9dc166fb6e8582453a32d28f4eb2bb9ce2cfb0a3473121d1341b533d69ca805ce2c2000b3e4bcb417d9e5b042466dbcbce954605d835aadab7d2f7f752d112d0994672d179406d0e27f4d57107d01ae788cc7fbcc50fb8e657b2d86372a5a55d25e8c6c54b8864a07f720642bb580738ffc2f0720518f1f86991e63bd642bd73b5553dff7e8c47a4ebb362643ed306059246e13626194dd5e4df2f16fd96d10c6336ddf632ac92cdd8a74059a6d4a93585d4221230ce59399ae1190d611cf4b9910c48a29c0ac16c6d00b5e68e5a8265c6f902584395522057ff51bc2d7dcff284cfe79cc46580110f1bfbf444ec6e1bd2a1ea74db940fe4236e6920f87bbbf7d6bc18cf6d4057bd1b0db71676959d196bc42a26dea5e7972644ad12879cbce500c356ad277103cb6dbcddd933bc0cf9f5312dbfd495494f2002d0662bf1639ddd8f22e3d90a3298acb227f5c3994c1e008fb0ed01a0f05f37ae8a7d01b51d5d36755741bda818239a7bad6348f37e50c48072985ba3e760be3b1dda75125f1017566d5fad13e596dfe56414d2bcb01037221308bee722a60770be291e3f11af2af1f16b2ffe177e699c81ebeb8c33d72b518337fd5a83400c2e242a3d21e0c554f69912687addb9f19a1097120453eb18bce319830155cc3c808bbae8416f50e037966cce1afac347fb835068cf6a16efbc5c90eec9114d115b535b74bfc6872243062e67c3cb8cfbad19a7b2ae843408c693c8b2e70f0e92e3852355b2eef463f5eb12b47834f3c61b43c23a05b3f14950ac2be6ee698a41d1dfd4a4b20a6e549627145dc9ba389f443ff308973149cd950f717c63278cf5e34ae1e8e0ec11d75769faaa23fa811cd7f87f462f47e23a5f63a430dafda6d698b1edc2ef9b921618d7670ca78aa43669abfdf12e09fe105f5ab1a9b0cbc15f66cb49f7e3caefbcb383407df2b5e045baca5ad09418780e00d108e3dfbea05c642322f3a1b58c71d5bcc956949ae2db3993c85d5a36f1931fe2aeb031d9a50e077eb913685afd57ca9c9c9b6e9778afe676b36e1d43d54e0a875c492651d1dc52b01cc46656d434ae0b6249c07a92fee06eab6fdb449200f4ecf0e5739ae21bc9dae0947566bd46c6ae54c95d74fe3f73bf2c267e8ccadb6da9c16f62eaf4804eb1efc2b3eb0288cf1fd4cb114d0acc3aa0d9cc6fd131e82cff1eb181202c96ad3959df6f2d33c5217cbc59e0fc87e0d25a4f7b36acfe07ea40ba9537383849f4a8707d0224d2091f66a4fc2f38056a542da8af71183cadfbb10a8d07348d1eace61f1c6de2fcbaf5be9f0d54ac4451d6fe65df1ef794b77039a67af8d663e236ecfdb9916aef7b767cf1df546418539ea8e8cc1976b73d9d2dde9854828f2cb60f3bc8c6c0c581e4b4e6f1e4e15d7c04d89efae46c5439c11fc2261812385067417b0e170e6ef150b12615561f54e4fba964aad6166463c6de943dc10254c9f0cd1bc9e92e136ea0d5f92aa2ecd52885ec649ad75847ea37247601e0eb1ebb5a489d4f44b498fc9250207c36663883a5c08509fcd44073f8a67189eaa41f7c89476ba6b0113662946a374c61ff329250aca37ddf0e407a4a82c2737e1bd9e20b0423d84c2d7ad65d55c6bd6df94cea8ca9b8fa5ff1d78ed9c3e4403d4bac4f8e4a2c6ad2757d50d45daf8cc491e6b9bdb9c3d74133f2b7d73e287fc93b9db8881e4a699849402664cf4f5d6409582f8a530e14b232e0e72854b099ac7f8b7db08d6e71cc08260ba715d57e9a196a767ca319bc788e6a45e576f8723aabe9069f43aaf785be49cdd66a0d6ee1f4fe1205a162d4c655f488b492bd5999989d62f92817a5f738b685bffc8dff51f668fa1fdcae51968eb6ae46a954d7ea6b0c857b629052b05945b766a9f9039667572f32a7b4bb54edef983aecfe7e862bb4e7b288977b9a885f29b4aa443bd8e625511141b650a8fd02952c18e81ce61c1f2ea4f55113ae5e9cb7a42612e1839b9936adfae622fa3868f0f4c1527d9e24f62deba7a70aa106dcd1623da6961ce7f84632068d5b7e896ef81e82816a4e849a2e4f889fde95d5e8d0548feb39c6b5b3818a8836c2d5f2c5aee66cac59ae3385d34373bd97b99b60479dbe0e6396585edea093d32080634fbe03cd549b5c210e34b66f0aaba461ac63fc5a6c111c3e376fb416949b405b03a38434b496f5211b34a424e8313e027bbfbe0d69756299f92d6818d4c0bb7cdddac9f862209614b68d86a740cad8ca72ecbe4c2f45f5d17f8e2f0e4bbfe7412807167c65d1343f0d77159e60ceda1882be8b1b7a7832ecb2f60128116237f6e16eaa952cdea76dea2dcb850a221189737bfbdf0d1a4bff17b0456abdf4830420a67dc12ed2859dbcad35b807550c8849207ccfa5c87ec7f746248b987b20911d8ae57e39bd0e2c37af00625ae2b765807ef97c7c5ccc1c044c84aea28171f71aa07849e52d397cdbe4addfc5cf9d5dbcdb8ca07920e1979fe223ec3cf2dfd3277f3279d5cd82fd13638f985c9c67ced97ad1319726d47b1307d175c44feb54321afcf4eb45bef88fb4d83b6e717ab0f6ad4364db7c937d1caeac918778bef6ab626b8917e784fa38c84d71fd0b54be2d35d09d352dfb243ee6b054c24d58fad97548449886b0f9949cbbced759d9caf67115f0ec17a59ed9f990fc6d94077bda13765f5b7b27d3decdc657870ea6dbff5136fd10381e11cb7d2aaf0b25307bad7059b70a29731f5bd497dd47ed6e1b59454904b7fb455c5ef5be9af8ac917ac84111ace3b3522266baf85ce104def20f4a20416eeb1d79c5929ada8b561387c7d1a7775e0598706b34deaca91ca566b8426770b5536229bf90d98e01ccbe0f4b591e675dfa5b3cb649eeaab9f814e1a797dbe65dca8de3b03e4621071f58376bdb968605ac945e91e27d990eb8252c6f3b6b08296de6760ccb45f7fb764e027ec7104dac6d5be918a81880b981ddaf156429ab1850d729ffe93ddddc066a04399ef5cc6fa3da55f7da33bd255e9fbfd0f2c8fde4a3941846bbbf1dc6df7a845af1ca52b68eae1e92ee4c64a63901fac5bf2c6e96fcfb1c1865ede5ece9fd2ca4ecdaefeefc2cf4443fafce22d7ffe73b831224616113376eb15e9d8bd28b4216b9e47f3c8ce0c1577de74323d8de6d4f4134dec211d4138f04a6adb0b7938d775bc6458e979465f83ac8b05beb593a75aeb620fc32237c6927b6c5ad605c06d8e4e1f058066fe90e0195370007f7ca4eb9a04a634734a5de490dd27f76f8702d97a63dbb5c181c6f75679cefba73e611d1424d289e97f999ba5844281417bac651d0b91ad10138214ed981baf2dbf7223e940dc13995fec17a1b4bd0a5f9339d79d92964b4c2c039cc19917eeecf58ad57f1cee2c547ade124be9fd99d56d42a1b7493544540ea54350db498b90a292b5074590db62f8ed0201a48e508bb412bd8d5a1b0b2ac524733ef6ad859edcb03105aa689216a4a2b2a3a3608799b46aa8531ff05dceb4db5e88f2287c0a1bbe6c0cf9b6e0fd506aaa60b23ca93935fb161d24eea2006262f2fca48b115f372c109838d3a10998cd839073e484d2fce615b5ae2b2dbdec9d13992a83d7d1a0cf414b9c7f154b94344ae300f4918c69ca86d96fc5bcbd9e562c7d5e6ff285cbbfb11d435abd50259dbac9c3dcb18aa41f667832867955edb5497acf721ee206e3fa9b7747c09ffb71ea9da744ccf802809015356f4c91fffb5725095d3708715f7738ef880895ae17e07bd119a305c89922135647a003dc78cc962962f16f2209db45ca7fc5d1ab9ccb207939752cbdd96c7bf8fabaf43c455c3bd48e353d01175239e42625bf740c5307653fd3f5e1471ff975975ea835e454471fa35e757ed5eb346f0491068a11d490c9615164a4ace6dfbbc5ff248bdf4861bce9157469e8a77f3ff362a6c3541203ed835568f3f2c28115486ecb3a765e1a5450ff57a0404b3b768130f7e3ef702cbf846d9240eab479ca610f9cb298241decde2409d9f17cb2c3a831ec6469b62474dbdb240087037daea9d22dbd93020b64a69223a478e74fbed212feaf201a9c625c07fd51a1eb9dbfe501944860a8a5da02c083c9af47e349e1a904dd9848d6a450de4deac3141ef1c73b543859063d0796decc4802285801be1ed17fe164600bb9939da377d28cf2d09f5be4a64c99b90eea40a824406e0143087bf100d50527ba34df186eddf82e087bec8e04342c0db0d1fd25393e4e927f993df4b57747660c5901da2c50f6bd4c927a243fb22c1b4ca85ff76c748c05d9eea48d86d4d28b47d2bd460abb65ca12e6486433acea4d9c9c446f303e9e45707f52b109d37d6d79a6e500334ecca0fc2a49a4fb52fcbfb17c9f7ec266ffed770ec69e7069b07982c7edff404c211833ceb313404bbf96d924bb18c7465f3fb6ead1336a48bec2afb510c8192481a038d3d86c7722ef4bf7d347ce59db584d4ca4a665b1206545531e19262e8edf490b851231b22ed94dceb2d09f37cd6f2f075f6119f88ebe2a571d6402f077dc7c858f46c9d1a94ad54a4e8a1e4076d0bbeb110ec8e5ead772f9ef24518b60576939d3ffb00940a67c2a792d2e2edc3af027907c65956e234bb0d2cfe9a7427825965f3aeed679d2d6280a98d9b07dcfdb1a8a9039b4345c1d66cf3f0b609d25dce4378b04f21971d353e381e1e874404eb0795685a73564a7c48c2623d59285e3be66f44e06f35aceebd45f6d37353086d3e9d14f2d917a08954d29d68a8a315992dbb34f564f424e24dae2ec520f31d310b4067620c974d0fb69d943df705d9d9710d8d53590d5d13c32d2a28a0e32187d3ec4270690ed64ccf06c199e8167040d3571d417b5f613d62df8d4d8ff45044c27817b3f5f0add12db6b840d2b32022114dfd72558d406a585b4b0b2061809aba436f1ab5cc12ad8cd62e6df9270b29ce01e00d96ad1ab4189e9d79ba09f83970267ac989496530889e39bfa76c97202a0a34f7c92d4ae20cc3c04d30ad0b16bfe4ff26ed96f9d03a5bba96c87e99752ef80f8656247d38d1c7899c5cce909bbc5c73e47a40389b7cb5098f0d01d2a614cc7d993911be029ba264192c1293cdf3bbba503e4649a0d70731ed8048c01e10c1683dc251cc0dd48f99857f59224d99fef139a03092c2e80c97a7742a352e1ac1dd3d803a11c87fa7d712952f87efaa1444c9cc5ad4a3a4b663b3974ff0face3757343d0a392fd268b2d1e22e88cabdede0a1c66091ae16c8991927622cd65cf1a57e2ea3b605d5f14c3148250a7376cda43b50eb29c84d6c20d839d4b19f354985185f54d431cac40758751099f4e3aeea7032904e7341aa553da50f6a775ab1e412a754ff052abdb67e17b41e36f6e52df09a013ced5483dccb77b06d874fe6e5e3e01d943580003a4bbc68a06de6db44aa70cb0d550d0215e55a46ebdd8af0c943eeedc144b61853a8c28d0b18626aa12615304302468b5dc4994fbe5ff56e69272c90781106f64560f95866e5ad49e03879edbcf3f326016b5e172293b066ebdf83bf25422460c852b0f35e7918dc126efe60e0c7bd0c3da1cd80754490468cecc7c5e95ce76e8bf3a27357103a30213c05223da9943690dbcfd071b912780a6fdacf6de15312bf3da3181a6c0b09a07b3fc4acc8839c7acde54b0d37bf7c11f969c1b555d2148f448754f9139db16eda75da5ce286127c6fa2fef64db0034e9a835d49ca564136f893fdd0b37eaaaecd189518a79740f5c0e25c89a6968ed69a2b976160b5433e08eac6113d99272edf1955a129ce9415479f0ccce1a2b79364852d2a8f41ccc05ec11cee58ad0337a5124f6b033d2f1c1b4fa00700c261e7d6beb2d4dc083a4ed24f736d8b8fdadd051df9812fc9e024688fafc01066ca6511999674bbc6aa459a50f8360a8a9561df8627c7e8b89dd7be99d2aabaf155beb42dc2bdadaf02845cfc0f0f559782d779f7940ecbd53e831f7cf582ab770d7152ea8b84b6acc6b83f58db00ac864d15bd899f62dceac48ab3ceaefb46dcd334706cfa0a79ccb53e2bd1c90a6b801b1f3349f1155493a41d494dc8509a2624a256bc8aa34c0e6ea2413fc39226cd3ed0063ab4b0c08e0d22e6cd6aeaad6a30bc9a69c340bcbf15091f24c7289a58979112293001f730b89b0232fb5e54ca9da831bab76048d0929539c895cd813e876f9631131c8acea74998f62847ca6e9aee1d8ed7d8757e7f6db8190ea5b8a480974adf815634c6406ce87de4061e4265f629d30d80a72ecebb5fcb08c861ae2dba9213cba6aaad2a4bfed4ca2ee828b0366898990b358adca8356f3d9794774c783f885f51b9997b2e04e2162c1291cc92ae9057e599bfe102f3890768a04d1c2233ef333cfb9bd710689d9d76c6c91e19706f8e1ee2ac7d7de3cd8940b57fe397782e61b03491319a7d24a8d8ae09db61a23f3b7acfea9d6e58a43f7389d801922de6c661ba455427016681f14e31feece569138286cba13d037e2e00e854d8cf5e52881a20b3e189f365ce622250d4e15eeaad3c2b68678c4f6cf95f8e0b544a5dd11184f0b0b462af735f040a71b6a53c9da6970b40531cbe29725a64c7d32a722987921e1588b87821f488578c777233e10f3fa0307c6ac2d2778b49fd6486762556cd1f068b6078dd05fa28e090fddf3c09188754dee4f1bef91f8e12a37cad5690a023ea758ba92c280f48825697e077685aa7ab84e050d0d0d1a9f13e95220488f9c9eb102c38b2a4ba11926c894be4225e86e268516f94d3d10555efd8537423bf3c1dab11595d0aa8d0b04f558291e2463e707f4a92b07bd1f867a3798ba6098495de9280e3d558d4c6fbe949776af69027941469f6f4d7e84e396d4207580dd42b410f6a7f4660f82e5c02e15520e69b98fcd040ad2c265d54a2fab157c4173345b628374952fbdc19e44cb9ac263ce426848ebd68b2463f995357007969295d2241ce0723ff52bce72769a3c8000f0639e9df68165ac85904b6557182d7bc267fc07edbf218f195ba842c59f2076bb5e70f55d4ec0dbc132a1fb1878883748a81d2bfe98af03320705a548612a8454356998168f4ec576773571be75b7213ac365d5af6b996cdba458be75b7a7deca5b76ca0533a3b2b8d9a1f45e9860d5959e0c62bbfb4335ce5aaf8da930de17f8722628328faa7d7a75d4337aef981a4406e494a2951d4e9fe6756a7ada2b5860c99991c5960bfe5bf41d00e1a0eef193da858cc5296cd85905a5705156e438d737e7f53b9432026616774c87d37c4512a167730bcb0fbbf576da22da739248992d7f559aa1947421682593f44dcdb08a750584696b20187880a1ad8d93cb5f09d1afdebaaf20accaca9c0143fb99c696c2c5fc6989938a906ec9af8dbd2a49745adca8ff3e21b1c89f864d9ad894e8c841e8985e9dded9b0efb554a43d927afc91a541092af83d2280f12ed367be4cba56dad94e62238ef274c2c53308ae0690e3d8eacbf81b76b8958b0bac9a80c64cd7b7d4a9f6ef5190eb508b891a014829905c3247c626fb6e266522dcf14b54492073e1bb30c47af1123caf1e5c34322b6c485915cbf8c741480fb964ad8075516989a1176439f0822932f5246223dd9e5826a0e70a1c81fa4f8e4c7f5b2a85f923373395646f521a89f66a4319c88cdfd5d81e1dc5b492781c91703e2d09acb450a39d35b26b93328d8da90e4ab9c078516c78a9ca3cb4347f35b7f110ac38201e289582c465968567d3ccc73b36d31597320bdc05568b0eae02436d1355de9d1a976460a237348f16c054a2f12f1a67f54d88b6454f7ac05790be75632b3e0aa78af756a0e5839c77cbc6b41deb0be6df23b822558c2f5f24b6b73b7b76a2fcb78144e760994938328314ce8cb0533c76cc8c6e2ba4cb517dab64dc7492e4cf32df816a49f47240f7aa0ca9b4c171c9be59e0c2a34af046dd7544b8cc8ec3486a60f9bdd4a74136a12f489f8535d2df99d4ef06f8ecf868615eddd5d887209b1bff30d26d7fec895445136f99c259d13f7106a698721828472eaeb35475ebb9b4a83a32f4d323f17045c16dfba248ec708c9701e696fb146ed3739326c075650c4b35c328d1aa4c7bf28f368fea0825d1a96586a46de8cb604802ea1e284d4bc46a65b945fa385e19991cd0e1832bc3bd2b5a0521668246829b406f82fbe219014be881a35e0846947944c8e4441458b7d39ede48480c3db84e5d76b85cdf5fd9e68df29996f1552a9f119d6413968ae339301bbfc7e047bde19c2889df54b7814008a0087324f1b26767e03b34f8ca73b29c28ef7f307f7fcb75ce3f4bd845d21725ce2c48d5ba6bcf3bd75023be45fb836c1358b10f44ab3794f13dcf37c2bdb5f2cb404056e522dcc321e140b8b3d3826ca03698435f3bd1e81942f455d4af8b11bff28e92cc6310a97ed72a19069d130d36fbbf118f84d93c32f1067402b5f93b5b3c5595afe0b575bf5b69a55c8a5483fc085a2304919932ce841f06f37ad3a377b774005f1055bb899aed1a230d7910754f6541b3f8af7e1742242fb428e091274c5af50b690ec34e29f8c6b8beeca3c815ab30712db732ff00f4e390ea0f8fd764bf0121997829ee8a970407e1c774c4b4cc1caebc5843597c16095dad75cabc43cde5e27d78496ad9e93277a358506566caf47ce8ed5b2fbc8ce2d5bcca82da858a7afc1ed0d9f460014a041b418a4ad584e9054c66a0008c509fda0b42e8e10afda322c3b85255fe6eff463933aec3e304248504322087705f72b0c8bdf59f917bbcd54da79f35af28d222f8022fff7aeeb4c0bf10f3096e0e5e63800a3c393a4242e9c3a38d792c78e74af1bfa775f42f3c880572b207e92515fefa69b96862847f97d5bf5a9c5d948a32e95f32051efce3248e1e7458a78c634343028b439d8885230935ff4ae803f3cf620d70d44077986392535a8c144cad713be7d1a1cc17ed00a53709f04a4cd11ef117ce36b0a7ef55b6522a52fb8b170e82d08ed0a4ce15d470af2b843df611d4acdad7a13677ac554dda3cba4264e62699ce066ab47461737dd2e2cac23e672da40e028c894c3bd52d2b8fb19e1dc044873d1e4f530c10c4ff1e6576a88ccaaf0fcce3aeaf0b9f6802a6e489e95e08d31665f5db7dea1199b669d0eba63bd971e242bcfe12b0f93479c4a78c56d6d6e6278aaf5c83c1d023ed300015e7c4c3d29f91c2bfee382b4f1b12fd12414051067804a20604c5bf467ee4d2a38b19d9f66b08c6bdf8ed884811e5c0bb2e7981a6427124a2d2adc67aa73a6fc6ff75cee9c12442dfdb9b45c02fe718194466033768caf95e2e4a744b9b0022420bb41e856b48acaa81c498d88c358a90eb91b58928980031118c5b79a460f4d5700916b74afea1859d4787ad9ce118b179a560787d9ea5c207736dba49bce26ed38716cf8c4381c05d40109143514a45733a071c610725a080e6f877796d5779a23f9a1564e3398ea828be12aba35c00d3ff8037b2a143f593d3cd184f46220fa80fad6f20625cc47532a90207d50cbe66c8540e7db095233173f7cc7d3018548c89dc112ff398fd663df734f14d8283a1ac090c2a8ec58ddd7ace5cc3761fb29dcfb76f693a084a0335c611c17df7f10e0660900f302998211f8c83dff923368382019af2a16c4e98e11ef9c17caa6aa43a34aac8b22a18cace232f06a30be498cd391563782909a77d14d4b48512d143b7ec01ff5029309175d9e819034f3164792f224b2fc4fde8208bdb44ba8ff334034ccc772bbb2c476af27d308a865e21dc88e9abe5eefd3a49caa496c14a1f7ca8d37a2201312d573e696588976b60e04d25a580e6404b8645414b89332f4192b5265bc5af2bd82d712a5e39552b4e8b13d9ea56784137f55d305840d26d529d5aa5a003c1d4434f4a92b14f7b6e89089861db8c1de82be99f8a80952f4dfddbe086c8585e89eb8d1d7254d4b1437e4755418edabe91574f6ad2fed924751d41b8bb822a834eaba81ae09f534f68798a51d50ff68d213f28608e5aff8842e873047947b2a5d5631a0fffc75ae66df1f906a26e821f5b79c73df0277baea00c48da28ab3844f24db226ab83d38cd1a75131bdbced5b09299dee2d72c49a45641332b8c1b6c06e9e1ac073c20fce2125cdbce846951e51c2acc3c3d3bb3910ba86f7401b586f58b2ef5dfebddac4f5b1eeef80d97f16c538d66922a73c07ea2490a9ee31e23b9f71db605fce2eb2fa773ef993dd9b8cf1f76e93d7f4ae4c65662424fae50cde1013afb6dff419a7d994f39483b9a68a44e081ac118e3e0d07b3910604128162123bc39c53b34a9c2a844c4794648ac54a4f455a7c62da1d5f81e7c9c6016e82df1463ac67ecf82f217b41030d753f5b344cbb94d7699f3efc9eff1c3a4b4739149d43d5148fc7010a5714d46439dfddb4b87c7501d5c18c4a6c1033328a94712583d6a1efd61774f68aeb9a75c8c285cb1683919c26b484db4e954bf64419bea1936978c26e10a3f85e1a15e5f5b62510a101b2c6b149cafe2b3080b1ef88e68ee9f87fb23ae286fd1778d296213a3ec5602b12c91aa1f001695650ad13a784dc4969953c58ed29cfd6e599f4670d20e3196c3e7d12fbca910af3bb537b9bcebca5a31a900944a9af31e65d4d351e32bbb2308d0240eddc0641cb14995a1ccc7da0200419ae2b081b9e60fe532029e4ad62dbfc6539c7c6ec9c169386db511fa7071b93299d5d8b6666ac16ebda71f5ccc17b17a098311d2f9fb3c755e1a233edd753e5ad664168656b55fe2c7b41768ef5c76afc59baaf8dbecc50fa8a1d4c286632ed0923ceeaf635f3c33071c8a2a0f5dade6459fc183ef5b6ad39da5e885e82a056884b7664d0f45a799ec3841db08d3336daeb68b91d39ab5e0d0095175035dfbe1c400a7f9cb4a3494da4d85b8d33839ac137c7eaf6e28ed785534ad3a20c797b9ef045da1cad896e1af8a81d2fdc133213d3f18260eab88523d6514840a2a34fa200f89f63553f25d49388363acc5f699804200e905ed0511ffff6463ea9738c59bd56f95fd9427bce39c7afa671bca07aa5a17477eb79a7c767415f33dea99da40e5f94912cc70837b3057d2d84529a7413966a03dad5dac3ee1592de2d3c346da5dcdaa8044fa66657acb6d1c7790d4b28631eff90d5f8ea424ff7b19fbc353131e33089dfe3330e570fcd366b481a394998344d4a216aea60de41e63a095a6a0d2a9da88acac2353cb2a842f38637345977fb67a7bd996600e401df6b467c65c5b4a5da88730ba5446a3dde1f2d156b548d86c76d9cb42e45e537e65f16ed450974fc3f86a218e08810b5c774402636324055759b314b82d0857e6da5dd4b3559a715b913e4943ebfba1d2f14153cde3459c07271efc72bab18e97ed2ced2ceea4d661a28bbe78aecf6f15df9dc50a0590d391188ea34509c7d46282d4300b30c5675fe0e8851f6f8946d3726b4ea815ed074b27733044e1b26a5593eb6a54afa04e33679586065b078f9b7393e9c25f4320f92f58f2e75e6e2bdbb08ae862f4f95c1426714784007d1b53aec9b2059232c301957bff967a873589d61a614318d06bbd389b201a3ff0e6531e8e3af94360c16edc5834888887ca86dfc9cfd7048d3b39533335339448ccbb7fe08da41c4acd542e3cb06f685a58ae0149dba4aab1a1f47ec741d1bd52298a7dfad96704797066746de39fe760d5e054eed568c7d479a724ba56b2dd85ecf8b90f44f895d03ad7953dbba2bd8bb9cae6930a7c00a04fa032a7a22d7288aad40fc702a506961a59e4cac3a6b560a575d254ee09f0c993d2ee2184991e85ea46b4ecc58e3de4eb31b5d5c72e1c329723c9c33423028d8408c9c03ffcfe72caeb842cbec0e399203650ab0c306f687ef7209c73d3ab81e98b4e074454fdc260b97d631064d5494b4382f440c78e83c4fc3db7bae2004357b27e518a9ffddb7fe3968ae778dd94720d63bff4badafc36f95407826b3513312aa5b2cdb33117e4ec171ca33da352345582f2d090fe7fa7ebb71fe01664e6009b90df433ce0222668ff9e7da1589a9e8acae28416dd31dcd59ec5942d207fef798e6260cbe91710dee2766c26e290d5bb1f0dc3afe9093f9e7952dfff319c6e334fb1a7432d2dfc80527f08e8ce0b3ba7770ff6b36125706df21ce5d192dcd2341efd69d9922a4eeea5994efa9550c39b15758bea4a9ef63718d471f9353195675f842212102d1ace4752b964dff3b0ed90bdb8440daccd26b422f9e6a1a22f9277e335a14a2944a3041d6ce323c403763d81c233976b0e73f829edb89511bb4c88b86a9cf879a856b35487518582841a5c517563edcb060b30cb798a164a22d2094a16a803120582e397fcb25ba4c1fc7badc9cce5258ded1e26ca58cd08d9b35c63a82ee6e7258175821e5d40d47f9b71b3a1449f0b56393e08129d6312f587954044cdc9c39d65cf496fe928097f20f4e0a8f06dba96d5166b6cdd83f78d17c638e0a29d85d73714456dfec50f9f0f7747e9eb695264b36a41f34b3c079bba1cfd5f8105af81ff998134e58d16b4c7a1e686b2651c2bf8b96105efc0ad7b62cc55c3ba3e44da61d3da3ff4eea08ba8c157a460986abb5721bc74d33f9b45bb394c108327b7799ce10f591be8da9a46b19eb94136a358572311ae151bc65359961f453ee9e5b0d8dcc09993fc3c687453abc0c84df84e364195ebfd85136e06cdf7e11fb55ae42230a2de6a9633ef0dc6d225594fd8fecb806f6654609e41b275d9690f99e14d8ad882645dc0fb5c091e2c4a964f402e7fd440447f9f3a4df67ff87533e683927346071c60422811e20599c1c5683ed33d2ea10369499de613051d2d4a9d3826457da73c0cc4efd4c9732a760aa72c20846219a15e9fa11e1f743be3bcecea9c663a3659ee9f2386cb24a46f348b3b105a8ce7484fad118ee67b7c8a0510c51440d8ba6d5aa5813f4d7f5e28e8f9d07ea20b02659d5aceae24c294707a102e2ffd77bbe702068266233cfa8d6f5dbcb791b9c79259b9842e12fc5a701f3e9f21d3c064472c751faa91a238e4b4756f8b3f5e396e8443f91910dd97c78e1239965f1be30baa8dc6fa46e8d4818c8143bfdeff0e051449853e17430115c4109ccec1963c1be2592d0a0934e5ded5dba87f358a33edeca5a5e41802acfedec99292e95a001ff62fb3023b3a1c9c6df1259f5cc0a1e6a04ab2a0073d41b45883e750197041d91848774ecf8bf4376fd66daa7d468ce51c995a35770c6d4f7a8870e7e44093b7c90f20650d67b304d3bdc1de733979632474814fb035e96495aaac7bb9fdc112b978d986c148fef12ae2c2a21078753aee384c7628fa5e2385be909bcfb8533da0e6c87a7a5d2d4da768a73fb5fe17559845b60b6de8899691eed416a7340986d669a1ec28fee14e1814fca35c274bb5058d7208be853bc83843f63b64092d2d2</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-up">      <input class="hbe hbe-input-field hbe-input-field-up" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-up" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-up">文章已被隐藏，可能为私密内容或还未完成。</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">???</summary>
    
    
    
    <category term="Linux" scheme="https://blog.godmao.top/categories/Linux/"/>
    
    <category term="内核编程" scheme="https://blog.godmao.top/categories/Linux/%E5%86%85%E6%A0%B8%E7%BC%96%E7%A8%8B/"/>
    
    
    <category term="Linux" scheme="https://blog.godmao.top/Tags/Linux/"/>
    
    <category term="调用链" scheme="https://blog.godmao.top/Tags/%E8%B0%83%E7%94%A8%E9%93%BE/"/>
    
  </entry>
  
  <entry>
    <title>大蟒蛇-sys/argparse库</title>
    <link href="https://blog.godmao.top/posts/22025/"/>
    <id>https://blog.godmao.top/posts/22025/</id>
    <published>2025-09-29T12:53:30.000Z</published>
    <updated>2025-09-29T14:34:58.586Z</updated>
    
    <content type="html"><![CDATA[<details><summary>版权信息</summary><div class="admonition warning"><p class="admonition-title">warning</p><p>本文章为博主原创文章。遵循 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh-hans">CC 4.0 BY-SA</a> 版权协议，转载请附上原文出处链接和本声明。</p></div></details><hr /><h1 id="sys库"><a class="markdownIt-Anchor" href="#sys库"></a> sys库</h1><p><code>sys</code> 是 Python 标准库中的一个模块，提供了与 Python 解释器及其环境交互的功能。<br />通过 <code>sys</code> 库，你可以访问与 Python 解释器相关的变量和函数，例如命令行参数、标准输入输出、程序退出等。命令行参数部分可用<code>argparse</code>库替代。</p><h2 id="sysargv"><a class="markdownIt-Anchor" href="#sysargv"></a> sys.argv</h2><p>描述：命令行参数的列表。<code>sys.argv[0]</code> 是脚本的名称，后续元素是传递给脚本的参数。<br />语法：<code>sys.argv[]</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sys    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"脚本名称:"</span><span class="token punctuation">,</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"参数列表:"</span><span class="token punctuation">,</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="sysexit"><a class="markdownIt-Anchor" href="#sysexit"></a> sys.exit</h2><p>描述：用于退出程序。你可以传递一个整数作为退出状态码，通常 <code>0</code> 表示成功，非零值表示错误。<br />语法：<code>sys.exit(num）</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sys<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"程序开始"</span><span class="token punctuation">)</span>sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"这行代码不会执行"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="sysstdinstdoutstderr"><a class="markdownIt-Anchor" href="#sysstdinstdoutstderr"></a> sys.stdin/stdout/stderr</h2><p>描述：<code>sys.stdin</code>、<code>sys.stdout</code> 和 <code>sys.stderr</code> 分别代表标准输入、标准输出和标准错误流。你可以重定向这些流以实现自定义的输入输出行为。<br />语法：<code>sys.stderr.write(&quot;err&quot;)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sys<span class="token comment"># 重定向标准输出到文件</span><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'output.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    sys<span class="token punctuation">.</span>stdout <span class="token operator">=</span> f    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"这行内容将写入 output.txt"</span><span class="token punctuation">)</span><span class="token comment"># 恢复标准输出</span>sys<span class="token punctuation">.</span>stdout <span class="token operator">=</span> sys<span class="token punctuation">.</span>__stdout__<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"这行内容将显示在控制台"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="sysversionversion_info"><a class="markdownIt-Anchor" href="#sysversionversion_info"></a> sys.version/version_info</h2><p>描述：提供了当前 Python 解释器的版本信息。<br />语法：<code>sys.version</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sys<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Python 版本:"</span><span class="token punctuation">,</span> sys<span class="token punctuation">.</span>version<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"版本信息:"</span><span class="token punctuation">,</span> sys<span class="token punctuation">.</span>version_info<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="syspath"><a class="markdownIt-Anchor" href="#syspath"></a> sys.path</h2><p>描述：列表，包含了 Python 解释器在导入模块时搜索的路径。可以修改这个列表来添加自定义的模块搜索路径。<br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sys<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"模块搜索路径:"</span><span class="token punctuation">,</span> sys<span class="token punctuation">.</span>path<span class="token punctuation">)</span>sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">'/custom/path'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"更新后的模块搜索路径:"</span><span class="token punctuation">,</span> sys<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="其他"><a class="markdownIt-Anchor" href="#其他"></a> 其他</h2><table><thead><tr><th>属性</th><th>说明</th></tr></thead><tbody><tr><td><code>sys.modules</code></td><td>已加载模块的字典</td></tr><tr><td><code>sys.platform</code></td><td>操作系统平台标识（如 <code>'win32'</code>, <code>'linux'</code>, <code>'darwin'</code>）</td></tr><tr><td><code>sys.executable</code></td><td>Python 解释器的绝对路径</td></tr><tr><td><code>sys.byteorder</code></td><td>字节序（<code>'little'</code> 或 <code>'big'</code>）</td></tr><tr><td><code>sys.maxsize</code></td><td>最大整数值（<code>2**31-1</code> 或 <code>2**63-1</code>）</td></tr></tbody></table><h1 id="argparser库"><a class="markdownIt-Anchor" href="#argparser库"></a> argparser库</h1><h2 id="argumentparser"><a class="markdownIt-Anchor" href="#argumentparser"></a> ArgumentParser</h2><p>描述：用于创建解析命令行参数的对象。<br />语法：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span>prog<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> usage<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> description<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> epilog<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> parents<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> formatter_class<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'argparse.HelpFormatter'</span><span class="token operator">></span><span class="token punctuation">,</span> prefix_chars<span class="token operator">=</span><span class="token string">'-'</span><span class="token punctuation">,</span> fromfile_prefix_chars<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> argument_default<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> conflict_handler<span class="token operator">=</span><span class="token string">'error'</span><span class="token punctuation">,</span> add_help<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> argparseparser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">"Example parser"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="add_argument重点"><a class="markdownIt-Anchor" href="#add_argument重点"></a> add_argument——重点</h2><p>描述：向ArgumentParser对象添加命令行参数。<br />语法：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">ArgumentParser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span>name <span class="token keyword">or</span> flags<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store'</span><span class="token punctuation">,</span> nargs<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> const<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> choices<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> metavar<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--verbose'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Increase output verbosity'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>补充：</p><table><thead><tr><th>键</th><th>接受的值</th><th>作用</th><th>举例</th></tr></thead><tbody><tr><td>name</td><td>字符串</td><td>变量的名字</td><td>‘radius’</td></tr><tr><td>nargs</td><td>数字或’?‘或’‘或’+’</td><td>用来说明传入的参数个数（符号意义和正则表达式里的一致)</td><td>nargs=’?’ nargs=2</td></tr><tr><td>type</td><td>list, str, tuple, set, dict等</td><td>设置读取参数的类型</td><td>type=int</td></tr><tr><td>default</td><td>类型跟type统一</td><td>设置默认值</td><td>default=1</td></tr><tr><td>choices</td><td>装选项的list</td><td>参数值只能从几个选项里面选择</td><td>choices=[1,2,3,4]</td></tr><tr><td>required</td><td>True或False</td><td>这个可选参数是否必须有（只能用于可选参数！否则报错）</td><td>required=True</td></tr><tr><td>help</td><td>字符串</td><td>说明一下这个参数是干嘛的</td><td>help=“I don’t know”</td></tr><tr><td>action</td><td>六种内置动作</td><td>一旦这个有参数，就会触发相应的动作</td><td>action=‘store_true’</td></tr></tbody></table><h2 id="parse_args"><a class="markdownIt-Anchor" href="#parse_args"></a> parse_args</h2><p>描述：解析命令行参数。<br />语法：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">ArgumentParser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span>args<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> namespace<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">args <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token punctuation">[</span>arg name<span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="set_defaults"><a class="markdownIt-Anchor" href="#set_defaults"></a> set_defaults</h2><p>描述：为指定的参数设置默认值。<br />语法：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">ArgumentParser<span class="token punctuation">.</span>set_defaults<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">parser<span class="token punctuation">.</span>set_defaults<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"John Doe"</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="print_help"><a class="markdownIt-Anchor" href="#print_help"></a> print_help</h2><p>描述：打印帮助信息。<br />语法：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">ArgumentParser<span class="token punctuation">.</span>print_help<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">parser<span class="token punctuation">.</span>print_help<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="add_subparsers"><a class="markdownIt-Anchor" href="#add_subparsers"></a> add_subparsers</h2><p>描述：为ArgumentParser对象添加子命令解析器。<br />语法：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">ArgumentParser<span class="token punctuation">.</span>add_subparsers<span class="token punctuation">(</span>dest<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> parser_class<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'argparse.ArgumentParser'</span><span class="token operator">></span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">subparsers <span class="token operator">=</span> parser<span class="token punctuation">.</span>add_subparsers<span class="token punctuation">(</span>dest<span class="token operator">=</span><span class="token string">'command'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>这上面几个是最常用的。</p></blockquote><hr /><h2 id="add_mutually_exclusive_group"><a class="markdownIt-Anchor" href="#add_mutually_exclusive_group"></a> add_mutually_exclusive_group</h2><p>描述：创建一个互斥的参数组，同一时间只能使用组内一个参数。<br />语法：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">ArgumentParser<span class="token punctuation">.</span>add_mutually_exclusive_group<span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">group <span class="token operator">=</span> parser<span class="token punctuation">.</span>add_mutually_exclusive_group<span class="token punctuation">(</span><span class="token punctuation">)</span>group<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--foo'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">)</span>group<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--bar'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="parse_known_args"><a class="markdownIt-Anchor" href="#parse_known_args"></a> parse_known_args</h2><p>描述：解析命令行参数，但返回一个包含已知参数和未知参数的元组。<br />语法：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">ArgumentParser<span class="token punctuation">.</span>parse_known_args<span class="token punctuation">(</span>args<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> namespace<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">args<span class="token punctuation">,</span> unknown <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_known_args<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="convert_arg_line_to_args"><a class="markdownIt-Anchor" href="#convert_arg_line_to_args"></a> convert_arg_line_to_args</h2><p>描述：将从文件读取的一行转换为参数列表。<br />语法：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">ArgumentParser<span class="token punctuation">.</span>convert_arg_line_to_args<span class="token punctuation">(</span>arg_line<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">args <span class="token operator">=</span> parser<span class="token punctuation">.</span>convert_arg_line_to_args<span class="token punctuation">(</span><span class="token string">"foo --bar=3"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="error"><a class="markdownIt-Anchor" href="#error"></a> error</h2><p>描述：在命令行参数解析过程中发生错误时，抛出异常并输出错误信息。<br />语法：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">ArgumentParser<span class="token punctuation">.</span>error<span class="token punctuation">(</span>message<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">parser<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">"Invalid argument"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="exit"><a class="markdownIt-Anchor" href="#exit"></a> exit</h2><p>描述：在解析命令行参数时遇到错误时，退出程序。<br />语法：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">ArgumentParser<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>status<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> message<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">parser<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>message<span class="token operator">=</span><span class="token string">"Exiting due to error"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="parse_args_from_file"><a class="markdownIt-Anchor" href="#parse_args_from_file"></a> parse_args_from_file</h2><p>描述：从文件中读取参数并解析。<br />语法：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">ArgumentParser<span class="token punctuation">.</span>parse_args_from_file<span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">parser<span class="token punctuation">.</span>parse_args_from_file<span class="token punctuation">(</span><span class="token string">'args.txt'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="add_argument_group"><a class="markdownIt-Anchor" href="#add_argument_group"></a> add_argument_group</h2><p>描述：创建一个参数组，用于组织和描述相关参数。<br />语法：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">ArgumentParser<span class="token punctuation">.</span>add_argument_group<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> description<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">group <span class="token operator">=</span> parser<span class="token punctuation">.</span>add_argument_group<span class="token punctuation">(</span><span class="token string">'Optional arguments'</span><span class="token punctuation">)</span>group<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--output'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Output file'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="format_help"><a class="markdownIt-Anchor" href="#format_help"></a> format_help</h2><p>描述：返回当前帮助信息的格式化字符串。<br />语法：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">ArgumentParser<span class="token punctuation">.</span>format_help<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">help_text <span class="token operator">=</span> parser<span class="token punctuation">.</span>format_help<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;details&gt;
&lt;summary&gt;版权信息&lt;/summary&gt;
&lt;div class=&quot;admonition warning&quot;&gt;&lt;p class=&quot;admonition-title&quot;&gt;warning&lt;/p&gt;&lt;p&gt;本文章为博主原创文章。遵循 &lt;a href=&quot;https://c</summary>
      
    
    
    
    <category term="python" scheme="https://blog.godmao.top/categories/python/"/>
    
    
    <category term="python" scheme="https://blog.godmao.top/Tags/python/"/>
    
    <category term="sys" scheme="https://blog.godmao.top/Tags/sys/"/>
    
    <category term="argparse" scheme="https://blog.godmao.top/Tags/argparse/"/>
    
  </entry>
  
  <entry>
    <title>大蟒蛇-shutil库</title>
    <link href="https://blog.godmao.top/posts/22415/"/>
    <id>https://blog.godmao.top/posts/22415/</id>
    <published>2025-09-29T12:41:07.000Z</published>
    <updated>2025-09-29T14:02:36.939Z</updated>
    
    <content type="html"><![CDATA[<details><summary>版权信息</summary><div class="admonition warning"><p class="admonition-title">warning</p><p>本文章为博主原创文章。遵循 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh-hans">CC 4.0 BY-SA</a> 版权协议，转载请附上原文出处链接和本声明。</p></div></details><hr /><p>shutil库主要用于文件的高级操作，比如移动、复制、压缩和解压</p><h2 id="shutilcopy"><a class="markdownIt-Anchor" href="#shutilcopy"></a> shutil.copy</h2><p>描述：复制文件到指定路径。<br />语法：<code>shutil.copy(src, dst)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> shutilshutil<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token string">'source.txt'</span><span class="token punctuation">,</span> <span class="token string">'destination.txt'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="shutilcopy2"><a class="markdownIt-Anchor" href="#shutilcopy2"></a> shutil.copy2</h2><p>描述：复制文件到指定路径，同时保留文件的元数据。<br />语法：<code>shutil.copy2(src, dst)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> shutilshutil<span class="token punctuation">.</span>copy2<span class="token punctuation">(</span><span class="token string">'source.txt'</span><span class="token punctuation">,</span> <span class="token string">'destination.txt'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="shutilcopytree"><a class="markdownIt-Anchor" href="#shutilcopytree"></a> shutil.copytree</h2><p>描述：递归复制整个目录树。<br />语法：<code>shutil.copytree(src, dst)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> shutilshutil<span class="token punctuation">.</span>copytree<span class="token punctuation">(</span><span class="token string">'source_dir'</span><span class="token punctuation">,</span> <span class="token string">'destination_dir'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="shutilmove"><a class="markdownIt-Anchor" href="#shutilmove"></a> shutil.move</h2><p>描述：移动文件或目录到指定路径。<br />语法：<code>shutil.move(src, dst)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> shutilshutil<span class="token punctuation">.</span>move<span class="token punctuation">(</span><span class="token string">'source.txt'</span><span class="token punctuation">,</span> <span class="token string">'destination.txt'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="shutilrmtree"><a class="markdownIt-Anchor" href="#shutilrmtree"></a> shutil.rmtree</h2><p>描述：递归删除目录树。慎用！<br />语法：<code>shutil.rmtree(path)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> shutilshutil<span class="token punctuation">.</span>rmtree<span class="token punctuation">(</span><span class="token string">'directory'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="shutildisk_usage"><a class="markdownIt-Anchor" href="#shutildisk_usage"></a> shutil.disk_usage</h2><p>描述：返回磁盘的总容量、已用空间和剩余空间。<br />语法：<code>shutil.disk_usage(path)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> shutiltotal<span class="token punctuation">,</span> used<span class="token punctuation">,</span> free <span class="token operator">=</span> shutil<span class="token punctuation">.</span>disk_usage<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Total: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>total<span class="token punctuation">&#125;</span></span><span class="token string">, Used: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>used<span class="token punctuation">&#125;</span></span><span class="token string">, Free: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>free<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="shutilchown"><a class="markdownIt-Anchor" href="#shutilchown"></a> shutil.chown</h2><p>描述：改变文件或目录的所有者和组。<br />语法：<code>shutil.chown(path, user=None, group=None)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> shutilshutil<span class="token punctuation">.</span>chown<span class="token punctuation">(</span><span class="token string">'file.txt'</span><span class="token punctuation">,</span> user<span class="token operator">=</span><span class="token string">'username'</span><span class="token punctuation">,</span> group<span class="token operator">=</span><span class="token string">'groupname'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="shutilunpack_archive"><a class="markdownIt-Anchor" href="#shutilunpack_archive"></a> shutil.unpack_archive</h2><p>描述：解压归档文件。<br />语法：<code>shutil.unpack_archive(filename, extract_dir=None)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> shutilshutil<span class="token punctuation">.</span>unpack_archive<span class="token punctuation">(</span><span class="token string">'archive.zip'</span><span class="token punctuation">,</span> <span class="token string">'destination_folder'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="shutilget_archive_formats"><a class="markdownIt-Anchor" href="#shutilget_archive_formats"></a> shutil.get_archive_formats</h2><p>描述：获取支持的归档格式列表。<br />语法：<code>shutil.get_archive_formats()</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> shutilformats <span class="token operator">=</span> shutil<span class="token punctuation">.</span>get_archive_formats<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>formats<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="shutilmake_archive"><a class="markdownIt-Anchor" href="#shutilmake_archive"></a> shutil.make_archive</h2><p>描述：创建一个归档文件。<br />语法：<code>shutil.make_archive(base_name, format, root_dir=None, base_dir=None)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> shutilshutil<span class="token punctuation">.</span>make_archive<span class="token punctuation">(</span><span class="token string">'archive_name'</span><span class="token punctuation">,</span> <span class="token string">'zip'</span><span class="token punctuation">,</span> <span class="token string">'folder_to_compress'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="shutilmove-2"><a class="markdownIt-Anchor" href="#shutilmove-2"></a> shutil.move</h2><p>描述：移动文件或目录到指定路径。<br />语法：<code>shutil.move(src, dst)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> shutilshutil<span class="token punctuation">.</span>move<span class="token punctuation">(</span><span class="token string">'source.txt'</span><span class="token punctuation">,</span> <span class="token string">'destination_folder'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;details&gt;
&lt;summary&gt;版权信息&lt;/summary&gt;
&lt;div class=&quot;admonition warning&quot;&gt;&lt;p class=&quot;admonition-title&quot;&gt;warning&lt;/p&gt;&lt;p&gt;本文章为博主原创文章。遵循 &lt;a href=&quot;https://c</summary>
      
    
    
    
    <category term="python" scheme="https://blog.godmao.top/categories/python/"/>
    
    
    <category term="python" scheme="https://blog.godmao.top/Tags/python/"/>
    
    <category term="shutil" scheme="https://blog.godmao.top/Tags/shutil/"/>
    
  </entry>
  
  <entry>
    <title>大蟒蛇-pathlib库</title>
    <link href="https://blog.godmao.top/posts/63515/"/>
    <id>https://blog.godmao.top/posts/63515/</id>
    <published>2025-09-28T11:21:17.000Z</published>
    <updated>2025-10-28T13:23:16.845Z</updated>
    
    <content type="html"><![CDATA[<details><summary>版权信息</summary><div class="admonition warning"><p class="admonition-title">warning</p><p>本文章为博主原创文章。遵循 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh-hans">CC 4.0 BY-SA</a> 版权协议，转载请附上原文出处链接和本声明。</p></div></details><hr /><h2 id="path"><a class="markdownIt-Anchor" href="#path"></a> Path()</h2><p>描述：创建路径对象<br />语法：<code>Path(path_str)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pathlib <span class="token keyword">import</span> Pathp <span class="token operator">=</span> Path<span class="token punctuation">(</span><span class="token string">'/home/user/docs'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="cwd"><a class="markdownIt-Anchor" href="#cwd"></a> cwd()</h2><p>描述：获取当前工作目录<br />语法：<code>Path.cwd()</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Path<span class="token punctuation">.</span>cwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="home"><a class="markdownIt-Anchor" href="#home"></a> home()</h2><p>描述：获取用户主目录路径<br />语法：<code>Path.home()</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Path<span class="token punctuation">.</span>home<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="exists"><a class="markdownIt-Anchor" href="#exists"></a> exists()</h2><p>描述：判断路径是否存在<br />语法：<code>path.exists()</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Path<span class="token punctuation">(</span><span class="token string">'test.txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="is_file"><a class="markdownIt-Anchor" href="#is_file"></a> is_file()</h2><p>描述：判断是否为文件<br />语法：<code>path.is_file()</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Path<span class="token punctuation">(</span><span class="token string">'test.txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>is_file<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="is_dir"><a class="markdownIt-Anchor" href="#is_dir"></a> is_dir()</h2><p>描述：判断是否为目录<br />语法：<code>path.is_dir()</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Path<span class="token punctuation">(</span><span class="token string">'/etc'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>is_dir<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="is_symlink"><a class="markdownIt-Anchor" href="#is_symlink"></a> is_symlink()</h2><p>描述：判断是否为符号链接<br />语法：<code>path.is_symlink()</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Path<span class="token punctuation">(</span><span class="token string">'link'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>is_symlink<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="iterdir"><a class="markdownIt-Anchor" href="#iterdir"></a> iterdir()</h2><p>描述：列出目录内容（生成器）<br />语法：<code>path.iterdir()</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">for</span> item <span class="token keyword">in</span> Path<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>iterdir<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="glob"><a class="markdownIt-Anchor" href="#glob"></a> glob()</h2><p>描述：使用通配符匹配文件<br />语法：<code>path.glob(pattern)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">list</span><span class="token punctuation">(</span>Path<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>glob<span class="token punctuation">(</span><span class="token string">'*.py'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="rglob"><a class="markdownIt-Anchor" href="#rglob"></a> rglob()</h2><p>描述：递归匹配文件<br />语法：<code>path.rglob(pattern)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">list</span><span class="token punctuation">(</span>Path<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rglob<span class="token punctuation">(</span><span class="token string">'*.py'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="mkdir"><a class="markdownIt-Anchor" href="#mkdir"></a> mkdir()</h2><p>描述：创建目录<br />语法：<code>path.mkdir(parents=False, exist_ok=False)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Path<span class="token punctuation">(</span><span class="token string">'new_dir'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="rmdir"><a class="markdownIt-Anchor" href="#rmdir"></a> rmdir()</h2><p>描述：删除空目录<br />语法：<code>path.rmdir()</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Path<span class="token punctuation">(</span><span class="token string">'empty_dir'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rmdir<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="unlink"><a class="markdownIt-Anchor" href="#unlink"></a> unlink()</h2><p>描述：删除文件或符号链接<br />语法：<code>path.unlink(missing_ok=False)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Path<span class="token punctuation">(</span><span class="token string">'file.txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>unlink<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="rename"><a class="markdownIt-Anchor" href="#rename"></a> rename()</h2><p>描述：重命名文件或目录<br />语法：<code>path.rename(target)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Path<span class="token punctuation">(</span><span class="token string">'old.txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rename<span class="token punctuation">(</span><span class="token string">'new.txt'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="replace"><a class="markdownIt-Anchor" href="#replace"></a> replace()</h2><p>描述：重命名（如目标存在则覆盖）<br />语法：<code>path.replace(target)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Path<span class="token punctuation">(</span><span class="token string">'a.txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'b.txt'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="resolve"><a class="markdownIt-Anchor" href="#resolve"></a> resolve()</h2><p>描述：返回绝对路径（解析符号链接）<br />语法：<code>path.resolve()</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Path<span class="token punctuation">(</span><span class="token string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>resolve<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="absolute"><a class="markdownIt-Anchor" href="#absolute"></a> absolute()</h2><p>描述：返回绝对路径（不解析符号链接）<br />语法：<code>path.absolute()</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Path<span class="token punctuation">(</span><span class="token string">'file.txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>absolute<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="stat"><a class="markdownIt-Anchor" href="#stat"></a> stat()</h2><p>描述：获取文件状态信息<br />语法：<code>path.stat()</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">info <span class="token operator">=</span> Path<span class="token punctuation">(</span><span class="token string">'file.txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>stat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>st_size<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="read_text"><a class="markdownIt-Anchor" href="#read_text"></a> read_text()</h2><p>描述：读取文本文件内容<br />语法：<code>path.read_text(encoding=None)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Path<span class="token punctuation">(</span><span class="token string">'a.txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read_text<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="write_text"><a class="markdownIt-Anchor" href="#write_text"></a> write_text()</h2><p>描述：写入文本内容<br />语法：<code>path.write_text(data, encoding=None)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Path<span class="token punctuation">(</span><span class="token string">'a.txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>write_text<span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="read_bytes"><a class="markdownIt-Anchor" href="#read_bytes"></a> read_bytes()</h2><p>描述：读取二进制文件内容<br />语法：<code>path.read_bytes()</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">data <span class="token operator">=</span> Path<span class="token punctuation">(</span><span class="token string">'a.bin'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read_bytes<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="write_bytes"><a class="markdownIt-Anchor" href="#write_bytes"></a> write_bytes()</h2><p>描述：写入二进制数据<br />语法：<code>path.write_bytes(data)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Path<span class="token punctuation">(</span><span class="token string">'a.bin'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>write_bytes<span class="token punctuation">(</span><span class="token string">b'\x00\x01'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="joinpath"><a class="markdownIt-Anchor" href="#joinpath"></a> joinpath()</h2><p>描述：拼接路径<br />语法：<code>path.joinpath(*other)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Path<span class="token punctuation">(</span><span class="token string">'/home'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>joinpath<span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'docs'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="with_name"><a class="markdownIt-Anchor" href="#with_name"></a> with_name()</h2><p>描述：返回更改文件名的新路径<br />语法：<code>path.with_name(name)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Path<span class="token punctuation">(</span><span class="token string">'a.txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>with_name<span class="token punctuation">(</span><span class="token string">'b.txt'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="with_suffix"><a class="markdownIt-Anchor" href="#with_suffix"></a> with_suffix()</h2><p>描述：修改文件扩展名<br />语法：<code>path.with_suffix(suffix)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Path<span class="token punctuation">(</span><span class="token string">'a.txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>with_suffix<span class="token punctuation">(</span><span class="token string">'.md'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="suffix"><a class="markdownIt-Anchor" href="#suffix"></a> suffix</h2><p>描述：返回路径后缀<br />语法：<code>path.suffix</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Path<span class="token punctuation">(</span><span class="token string">'a.txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>suffix<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="suffixes"><a class="markdownIt-Anchor" href="#suffixes"></a> suffixes</h2><p>描述：返回所有后缀（列表）<br />语法：<code>path.suffixes</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Path<span class="token punctuation">(</span><span class="token string">'archive.tar.gz'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>suffixes<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="stem"><a class="markdownIt-Anchor" href="#stem"></a> stem</h2><p>描述：返回不带后缀的文件名<br />语法：<code>path.stem</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Path<span class="token punctuation">(</span><span class="token string">'a.txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>stem<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="name"><a class="markdownIt-Anchor" href="#name"></a> name</h2><p>描述：返回文件名<br />语法：<code>path.name</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Path<span class="token punctuation">(</span><span class="token string">'/home/user/a.txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="parent"><a class="markdownIt-Anchor" href="#parent"></a> parent</h2><p>描述：返回父路径<br />语法：<code>path.parent</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Path<span class="token punctuation">(</span><span class="token string">'/home/user/a.txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>parent<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="parents"><a class="markdownIt-Anchor" href="#parents"></a> parents</h2><p>描述：返回所有上级目录<br />语法：<code>path.parents</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">for</span> p <span class="token keyword">in</span> Path<span class="token punctuation">(</span><span class="token string">'/a/b/c'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>parents<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="as_posix"><a class="markdownIt-Anchor" href="#as_posix"></a> as_posix()</h2><p>描述：以 POSIX 格式返回路径字符串<br />语法：<code>path.as_posix()</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Path<span class="token punctuation">(</span><span class="token string">'C:\\a\\b'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>as_posix<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="as_uri"><a class="markdownIt-Anchor" href="#as_uri"></a> as_uri()</h2><p>描述：返回文件URI<br />语法：<code>path.as_uri()</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Path<span class="token punctuation">(</span><span class="token string">'/home/user/a.txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>as_uri<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="relative_to"><a class="markdownIt-Anchor" href="#relative_to"></a> relative_to()</h2><p>描述：返回相对路径<br />语法：<code>path.relative_to(base)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Path<span class="token punctuation">(</span><span class="token string">'/home/user/docs/a.txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>relative_to<span class="token punctuation">(</span><span class="token string">'/home/user'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="match"><a class="markdownIt-Anchor" href="#match"></a> match()</h2><p>描述：判断路径是否匹配模式<br />语法：<code>path.match(pattern)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Path<span class="token punctuation">(</span><span class="token string">'a.txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string">'*.txt'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="touch"><a class="markdownIt-Anchor" href="#touch"></a> touch()</h2><p>描述：创建空文件或更新修改时间<br />语法：<code>path.touch(exist_ok=True)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Path<span class="token punctuation">(</span><span class="token string">'a.txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>touch<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="open"><a class="markdownIt-Anchor" href="#open"></a> open()</h2><p>描述：打开文件（与内置 open 类似）<br />语法：<code>path.open(mode='r', encoding=None)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">with</span> Path<span class="token punctuation">(</span><span class="token string">'a.txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;details&gt;
&lt;summary&gt;版权信息&lt;/summary&gt;
&lt;div class=&quot;admonition warning&quot;&gt;&lt;p class=&quot;admonition-title&quot;&gt;warning&lt;/p&gt;&lt;p&gt;本文章为博主原创文章。遵循 &lt;a href=&quot;https://c</summary>
      
    
    
    
    <category term="python" scheme="https://blog.godmao.top/categories/python/"/>
    
    
    <category term="python" scheme="https://blog.godmao.top/Tags/python/"/>
    
    <category term="pathlib" scheme="https://blog.godmao.top/Tags/pathlib/"/>
    
  </entry>
  
  <entry>
    <title>Python中元组、列表、字典和集合的区别</title>
    <link href="https://blog.godmao.top/posts/53459/"/>
    <id>https://blog.godmao.top/posts/53459/</id>
    <published>2025-09-28T08:38:06.000Z</published>
    <updated>2025-09-28T08:41:37.862Z</updated>
    
    <content type="html"><![CDATA[<details><summary>版权信息</summary><div class="admonition warning"><p class="admonition-title">warning</p><p>本文章为博主原创文章。遵循 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh-hans">CC 4.0 BY-SA</a> 版权协议，转载请附上原文出处链接和本声明。</p></div></details><hr /><p>在Python中，元组（Tuple）、列表（List）、字典（Dictionary）和集合（Set）是四种常用的数据结构，它们各自有不同的特点和应用场景。</p><h2 id="列表list"><a class="markdownIt-Anchor" href="#列表list"></a> 列表（List）</h2><p>列表是一种有序且可变的数据序列，允许存储重复元素。</p><ul><li>定义方式：使用方括号 <em>[]</em>，例如 <em>example_list = [1, 2, “apple”, True]</em>。</li><li>特点：支持通过索引访问元素，可以动态添加、删除或修改元素。</li><li>应用场景：适用于需要频繁修改的有序数据集，例如购物清单或动态数组。</li></ul><h2 id="元组tuple"><a class="markdownIt-Anchor" href="#元组tuple"></a> 元组（Tuple）</h2><p>元组是一种有序但不可变的数据序列，允许存储重复元素。</p><ul><li>定义方式：使用圆括号 <em>()</em>，例如 <em>example_tuple = (1, 2, “apple”, True)</em>。</li><li>特点：一旦创建后，内容无法更改，适合存储固定不变的数据。</li><li>应用场景：适用于需要保护数据不被修改的场景，例如坐标点或数据库查询结果。</li></ul><h2 id="集合set"><a class="markdownIt-Anchor" href="#集合set"></a> 集合（Set）</h2><p>集合是一种无序且不允许重复的元素集合。</p><ul><li>定义方式：使用大括号 <em>{}</em> 或 <em>set()</em> 函数，例如 <em>example_set = {1, 2, “apple”, True}</em>。</li><li>特点：不支持索引访问，但可以进行数学集合运算（如交集、并集）。</li><li>应用场景：适用于需要去重或快速判断元素是否存在的场景，例如处理唯一值集合。</li></ul><h2 id="字典dictionary"><a class="markdownIt-Anchor" href="#字典dictionary"></a> 字典（Dictionary）</h2><p>字典是一种键值对的映射容器，其中键必须唯一，值可以重复。</p><ul><li>定义方式：使用大括号 <em>{}</em>，例如 <em>example_dict = {“name”: “Alice”, “age”: 25}</em>。</li><li>特点：从Python 3.7开始，字典的插入顺序保持不变。支持通过键快速查找对应的值。</li><li>应用场景：适用于存储键值映射关系的数据，例如配置文件或数据库表结构。</li></ul><h2 id="总结"><a class="markdownIt-Anchor" href="#总结"></a> 总结</h2><ul><li>有序性：列表和元组是有序的，集合和字典无序（但字典从Python 3.7起保持插入顺序）。</li><li>可变性：列表和字典是可变的，元组不可变，集合可变但不支持索引。</li><li>重复性：集合不允许重复元素，其他三种结构允许重复（字典的键必须唯一）。</li><li>应用场景：根据数据的有序性、可变性和重复性需求选择合适的数据结构。</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;details&gt;
&lt;summary&gt;版权信息&lt;/summary&gt;
&lt;div class=&quot;admonition warning&quot;&gt;&lt;p class=&quot;admonition-title&quot;&gt;warning&lt;/p&gt;&lt;p&gt;本文章为博主原创文章。遵循 &lt;a href=&quot;https://c</summary>
      
    
    
    
    <category term="python" scheme="https://blog.godmao.top/categories/python/"/>
    
    
    <category term="python" scheme="https://blog.godmao.top/Tags/python/"/>
    
  </entry>
  
  <entry>
    <title>大蟒蛇-os库</title>
    <link href="https://blog.godmao.top/posts/37113/"/>
    <id>https://blog.godmao.top/posts/37113/</id>
    <published>2025-09-28T07:25:58.000Z</published>
    <updated>2025-09-28T11:21:43.056Z</updated>
    
    <content type="html"><![CDATA[<details><summary>版权信息</summary><div class="admonition warning"><p class="admonition-title">warning</p><p>本文章为博主原创文章。遵循 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh-hans">CC 4.0 BY-SA</a> 版权协议，转载请附上原文出处链接和本声明。</p></div></details><hr /><h1 id="python-os-模块函数大全速查表"><a class="markdownIt-Anchor" href="#python-os-模块函数大全速查表"></a> Python <code>os</code> 模块函数大全速查表</h1><p><code>os</code> 模块是 Python 标准库中用于与操作系统交互的接口，涵盖了文件/目录操作、环境变量管理、系统信息获取、进程控制等诸多功能。本文整理了常用函数及示例，便于查阅使用。</p><h2 id="osgetcwd"><a class="markdownIt-Anchor" href="#osgetcwd"></a> os.getcwd()</h2><p>描述：获取当前工作目录<br />语法：<code>os.getcwd()</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="oschdir"><a class="markdownIt-Anchor" href="#oschdir"></a> os.chdir()</h2><p>描述：改变当前工作目录<br />语法：<code>os.chdir(path)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">os<span class="token punctuation">.</span>chdir<span class="token punctuation">(</span><span class="token string">"/home/user"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="oslistdir"><a class="markdownIt-Anchor" href="#oslistdir"></a> os.listdir()</h2><p>描述：返回指定目录下的文件和文件夹列表<br />语法：<code>os.listdir(path=&quot;.&quot;)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="osmkdir"><a class="markdownIt-Anchor" href="#osmkdir"></a> os.mkdir()</h2><p>描述：创建单层目录<br />语法：<code>os.mkdir(path)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="osmakedirs"><a class="markdownIt-Anchor" href="#osmakedirs"></a> os.makedirs()</h2><p>描述：创建多级目录<br />语法：<code>os.makedirs(path, exist_ok=False)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span><span class="token string">"a/b/c"</span><span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="osrmdir"><a class="markdownIt-Anchor" href="#osrmdir"></a> os.rmdir()</h2><p>描述：删除空目录<br />语法：<code>os.rmdir(path)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">os<span class="token punctuation">.</span>rmdir<span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="osremovedirs"><a class="markdownIt-Anchor" href="#osremovedirs"></a> os.removedirs()</h2><p>描述：删除多级空目录<br />语法：<code>os.removedirs(path)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">os<span class="token punctuation">.</span>removedirs<span class="token punctuation">(</span><span class="token string">"a/b/c"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="osremove"><a class="markdownIt-Anchor" href="#osremove"></a> os.remove()</h2><p>描述：删除文件<br />语法：<code>os.remove(path)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token string">"file.txt"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="osrename"><a class="markdownIt-Anchor" href="#osrename"></a> os.rename()</h2><p>描述：重命名文件或目录<br />语法：<code>os.rename(src, dst)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">os<span class="token punctuation">.</span>rename<span class="token punctuation">(</span><span class="token string">"old.txt"</span><span class="token punctuation">,</span> <span class="token string">"new.txt"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="osreplace"><a class="markdownIt-Anchor" href="#osreplace"></a> os.replace()</h2><p>描述：重命名文件，如果目标已存在会被覆盖<br />语法：<code>os.replace(src, dst)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">os<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"a.txt"</span><span class="token punctuation">,</span> <span class="token string">"b.txt"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="osstat"><a class="markdownIt-Anchor" href="#osstat"></a> os.stat()</h2><p>描述：获取文件状态信息<br />语法：<code>os.stat(path)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">info <span class="token operator">=</span> os<span class="token punctuation">.</span>stat<span class="token punctuation">(</span><span class="token string">"file.txt"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>st_size<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="oswalk"><a class="markdownIt-Anchor" href="#oswalk"></a> os.walk()</h2><p>描述：递归遍历目录树<br />语法：<code>os.walk(top, topdown=True, onerror=None, followlinks=False)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">for</span> root<span class="token punctuation">,</span> dirs<span class="token punctuation">,</span> files <span class="token keyword">in</span> os<span class="token punctuation">.</span>walk<span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> dirs<span class="token punctuation">,</span> files<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>补充：<br /><code>top</code>：要遍历的顶级目录的路径。<br /><code>topdown (可选)</code>：如果为 True（默认值），则从顶级开始向下遍历。如果为 False，则从底部的子目录开始向上遍历。<br /><code>onerror (可选)</code>：是一个函数，用于错误处理。如果指定，则应该是一个接受单个参数（异常实例）的函数。如果未指定或为 None，错误将被忽略。<br /><code>followlinks (可选)</code>：如果为 True，则会遍历符号链接指向的目录。</p><h2 id="osscandir"><a class="markdownIt-Anchor" href="#osscandir"></a> os.scandir()</h2><p>描述：高效迭代目录项<br />语法：<code>os.scandir(path=&quot;.&quot;)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">traversal_files</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> item <span class="token keyword">in</span> os<span class="token punctuation">.</span>scandir<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> item<span class="token punctuation">.</span>is_dir<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>          dirs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">.</span>path<span class="token punctuation">)</span>        <span class="token keyword">elif</span> item<span class="token punctuation">.</span>is_file<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>          files<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">.</span>path<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'dirs:'</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>dirs<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'files:'</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">)</span>traversal_files<span class="token punctuation">(</span><span class="token string">r'./test'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ospathjoin"><a class="markdownIt-Anchor" href="#ospathjoin"></a> os.path.join()</h2><p>描述：拼接路径<br />语法：<code>os.path.join(path, *paths)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">"folder"</span><span class="token punctuation">,</span> <span class="token string">"file.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ospathabspath"><a class="markdownIt-Anchor" href="#ospathabspath"></a> os.path.abspath()</h2><p>描述：获取绝对路径<br />语法：<code>os.path.abspath(path)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ospathbasename"><a class="markdownIt-Anchor" href="#ospathbasename"></a> os.path.basename()</h2><p>描述：获取路径中的文件名<br />语法：<code>os.path.basename(path)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span><span class="token string">"/home/user/file.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ospathdirname"><a class="markdownIt-Anchor" href="#ospathdirname"></a> os.path.dirname()</h2><p>描述：获取路径中的目录部分<br />语法：<code>os.path.dirname(path)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span><span class="token string">"/home/user/file.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ospathexists"><a class="markdownIt-Anchor" href="#ospathexists"></a> os.path.exists()</h2><p>描述：判断路径是否存在<br />语法：<code>os.path.exists(path)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">"file.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ospathisfile"><a class="markdownIt-Anchor" href="#ospathisfile"></a> os.path.isfile()</h2><p>描述：判断路径是否为文件<br />语法：<code>os.path.isfile(path)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isfile<span class="token punctuation">(</span><span class="token string">"file.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ospathisdir"><a class="markdownIt-Anchor" href="#ospathisdir"></a> os.path.isdir()</h2><p>描述：判断路径是否为目录<br />语法：<code>os.path.isdir(path)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span><span class="token string">"folder"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ospathsplitext"><a class="markdownIt-Anchor" href="#ospathsplitext"></a> os.path.splitext()</h2><p>描述：分离文件名与扩展名<br />语法：<code>os.path.splitext(path)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span><span class="token string">"file.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ospathgetsize"><a class="markdownIt-Anchor" href="#ospathgetsize"></a> os.path.getsize()</h2><p>描述：获取文件大小（字节）<br />语法：<code>os.path.getsize(path)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>getsize<span class="token punctuation">(</span><span class="token string">"file.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="osenviron"><a class="markdownIt-Anchor" href="#osenviron"></a> os.environ</h2><p>描述：环境变量相关<br />语法：<code>os.environ</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 获取环境变量</span>value <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"HOME"</span><span class="token punctuation">)</span> <span class="token comment"># 如果不存在返回 None</span><span class="token comment"># 修改环境变量</span>os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">"MY_VAR"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"123"</span>os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">"PATH"</span><span class="token punctuation">]</span> <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">"PATH"</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">":/my/custom/path"</span><span class="token comment"># 删除 MY_VAR</span><span class="token keyword">del</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">"MY_VAR"</span><span class="token punctuation">]</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ossystem"><a class="markdownIt-Anchor" href="#ossystem"></a> os.system()</h2><p>描述：执行系统命令  <strong>不推荐，推荐<code>subprocess</code></strong><br />语法：<code>os.system(command)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">"ls"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ospopen"><a class="markdownIt-Anchor" href="#ospopen"></a> os.popen()</h2><p>描述：执行命令并获取输出<br />语法：<code>os.popen(command)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">output <span class="token operator">=</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">"ls"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="osgetpid"><a class="markdownIt-Anchor" href="#osgetpid"></a> os.getpid()</h2><p>描述：获取当前进程 ID<br />语法：<code>os.getpid()</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="osgetppid"><a class="markdownIt-Anchor" href="#osgetppid"></a> os.getppid()</h2><p>描述：获取父进程 ID<br />语法：<code>os.getppid()</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>getppid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="osgetlogin"><a class="markdownIt-Anchor" href="#osgetlogin"></a> os.getlogin()</h2><p>描述：获取当前登录用户<br />语法：<code>os.getlogin()</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>getlogin<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="osgetuid-osgetgid"><a class="markdownIt-Anchor" href="#osgetuid-osgetgid"></a> os.getuid() / os.getgid()</h2><p>描述：获取当前进程用户/组 ID<br />语法：<code>os.getuid()</code> / <code>os.getgid()</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>getuid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>getgid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ossetuid-ossetgid"><a class="markdownIt-Anchor" href="#ossetuid-ossetgid"></a> os.setuid() / os.setgid()</h2><p>描述：设置用户/组 ID<br />语法：<code>os.setuid(uid)</code> / <code>os.setgid(gid)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">os<span class="token punctuation">.</span>setuid<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="osumask"><a class="markdownIt-Anchor" href="#osumask"></a> os.umask()</h2><p>描述：设置文件创建掩码<br />语法：<code>os.umask(mask)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">os<span class="token punctuation">.</span>umask<span class="token punctuation">(</span><span class="token number">0o022</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="oschmod"><a class="markdownIt-Anchor" href="#oschmod"></a> os.chmod()</h2><p>描述：修改文件权限<br />语法：<code>os.chmod(path, mode)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">os<span class="token punctuation">.</span>chmod<span class="token punctuation">(</span><span class="token string">"file.txt"</span><span class="token punctuation">,</span> <span class="token number">0o644</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="oslink"><a class="markdownIt-Anchor" href="#oslink"></a> os.link()</h2><p>描述：创建硬链接<br />语法：<code>os.link(src, dst)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">os<span class="token punctuation">.</span>link<span class="token punctuation">(</span><span class="token string">"a.txt"</span><span class="token punctuation">,</span> <span class="token string">"b.txt"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ossymlink"><a class="markdownIt-Anchor" href="#ossymlink"></a> os.symlink()</h2><p>描述：创建符号链接<br />语法：<code>os.symlink(src, dst)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">os<span class="token punctuation">.</span>symlink<span class="token punctuation">(</span><span class="token string">"a.txt"</span><span class="token punctuation">,</span> <span class="token string">"link.txt"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="osreadlink"><a class="markdownIt-Anchor" href="#osreadlink"></a> os.readlink()</h2><p>描述：获取符号链接指向的路径<br />语法：<code>os.readlink(path)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>readlink<span class="token punctuation">(</span><span class="token string">"link.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="osutime"><a class="markdownIt-Anchor" href="#osutime"></a> os.utime()</h2><p>描述：修改文件的访问和修改时间<br />语法：<code>os.utime(path, times=None)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">os<span class="token punctuation">.</span>utime<span class="token punctuation">(</span><span class="token string">"file.txt"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1620000000</span><span class="token punctuation">,</span> <span class="token number">1620000000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ostruncate"><a class="markdownIt-Anchor" href="#ostruncate"></a> os.truncate()</h2><p>描述：截断文件到指定大小<br />语法：<code>os.truncate(path, length)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">os<span class="token punctuation">.</span>truncate<span class="token punctuation">(</span><span class="token string">"file.txt"</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="osurandom"><a class="markdownIt-Anchor" href="#osurandom"></a> os.urandom()</h2><p>描述：生成随机字节数据<br />语法：<code>os.urandom(n)</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="oscpu_count"><a class="markdownIt-Anchor" href="#oscpu_count"></a> os.cpu_count()</h2><p>描述：返回 CPU 核心数<br />语法：<code>os.cpu_count()</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>cpu_count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="osuname"><a class="markdownIt-Anchor" href="#osuname"></a> os.uname()</h2><p>描述：返回操作系统信息<br />语法：<code>os.uname()</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>uname<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="osname"><a class="markdownIt-Anchor" href="#osname"></a> <a href="http://os.name">os.name</a></h2><p>描述：获取操作系统类型标识<br />语法：<code>os.name</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ossep"><a class="markdownIt-Anchor" href="#ossep"></a> os.sep</h2><p>描述：路径分隔符<br />语法：<code>os.sep</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>sep<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="oslinesep"><a class="markdownIt-Anchor" href="#oslinesep"></a> os.linesep</h2><p>描述：行分隔符<br />语法：<code>os.linesep</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">repr</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>linesep<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ospathsep"><a class="markdownIt-Anchor" href="#ospathsep"></a> os.pathsep</h2><p>描述：系统路径分隔符<br />语法：<code>os.pathsep</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>pathsep<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="osdevnull"><a class="markdownIt-Anchor" href="#osdevnull"></a> os.devnull</h2><p>描述：空设备路径，用于丢弃输出<br />语法：<code>os.devnull</code><br />示例：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>devnull<span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"This goes nowhere"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;details&gt;
&lt;summary&gt;版权信息&lt;/summary&gt;
&lt;div class=&quot;admonition warning&quot;&gt;&lt;p class=&quot;admonition-title&quot;&gt;warning&lt;/p&gt;&lt;p&gt;本文章为博主原创文章。遵循 &lt;a href=&quot;https://c</summary>
      
    
    
    
    <category term="python" scheme="https://blog.godmao.top/categories/python/"/>
    
    
    <category term="python" scheme="https://blog.godmao.top/Tags/python/"/>
    
    <category term="os" scheme="https://blog.godmao.top/Tags/os/"/>
    
  </entry>
  
  <entry>
    <title>Linux内核模块初体验</title>
    <link href="https://blog.godmao.top/posts/49513/"/>
    <id>https://blog.godmao.top/posts/49513/</id>
    <published>2025-09-27T07:48:35.000Z</published>
    <updated>2025-10-11T06:52:47.208Z</updated>
    
    <content type="html"><![CDATA[<details><summary>版权信息</summary><div class="admonition warning"><p class="admonition-title">warning</p><p>本文章为博主原创文章。遵循 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh-hans">CC 4.0 BY-SA</a> 版权协议，转载请附上原文出处链接和本声明。</p></div></details><hr /><blockquote><p>本篇摘自野火嵌入式Linux系列教程驱动开发篇</p></blockquote><h2 id="内核模块基本概念"><a class="markdownIt-Anchor" href="#内核模块基本概念"></a> 内核模块基本概念</h2><h3 id="现代内核派系"><a class="markdownIt-Anchor" href="#现代内核派系"></a> 现代内核派系</h3><p>单内核：关键功能和服务功能均在内核空间提供</p><ul><li>运行效率高</li><li>扩展性较差</li></ul><p>微内核：内核空间只提供关键功能，服务功能在用户空间提供</p><ul><li>运行效率较低</li><li>安全性、扩展性较高</li></ul><p>linux属于单内核，按理来说扩展性不好，但其的模块化设计又弥补了这一点。</p><h3 id="内核模块加载卸载"><a class="markdownIt-Anchor" href="#内核模块加载卸载"></a> 内核模块加载/卸载</h3><ul><li>使用insmod命令加载</li><li>使用rmmod命令卸载</li></ul><h3 id="内核模块入口出口"><a class="markdownIt-Anchor" href="#内核模块入口出口"></a> 内核模块入口/出口</h3><ul><li>module_init()：加载模块式该函数自动执行，进行初始化操作</li><li>module_exit()：卸载模块时函数自动执行，进行清理操作</li></ul><h3 id="内核模块信息声明"><a class="markdownIt-Anchor" href="#内核模块信息声明"></a> 内核模块信息声明</h3><ul><li>MODULE_LICENSE()：表示模块代码接受的软件许可协议，Linux内核遵循GPL V2开源协议，内核模块与linux内核保持一致即可。</li><li>MODULE_AUTHOR()：描述模块的作者信息</li><li>MODULE_DESCRIPTION()：对模块的简单介绍</li><li>MODULE_ALIAS()：给模块设置一个别名</li></ul><h2 id="内核模块实验1"><a class="markdownIt-Anchor" href="#内核模块实验1"></a> 内核模块实验1</h2><h3 id="实验环境"><a class="markdownIt-Anchor" href="#实验环境"></a> 实验环境</h3><ul><li>开发板烧录好Debian镜像。</li><li>SSH连接MobaXterm</li><li>启动开发板，搭建好SFTP。</li><li>获取Debian镜像的内核源码并编译。</li></ul><h3 id="编译41971版本内核"><a class="markdownIt-Anchor" href="#编译41971版本内核"></a> 编译4.19.71版本内核</h3><p>内核模块的功能需要依赖内核提供的各种底层接口</p><p>1.下载linux内核源码</p><p>​github:</p><pre class="line-numbers language-none"><code class="language-none">git clone https:&#x2F;&#x2F;github.com&#x2F;Embedfire&#x2F;ebf-buster-linux.git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>​gitee:</p><pre class="line-numbers language-none"><code class="language-none">git clone https:&#x2F;&#x2F;gitee.com&#x2F;Embedfire&#x2F;ebf-buster-linux.git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>2.安装必要环境工具库</p><pre class="line-numbers language-none"><code class="language-none">sudo apt install make gcc-arm-linux-gnueabihf gcc bison flex libssl-dev dpkg-dev lzop<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>gcc-arm-linux-gnueabihf 交叉编译器</li><li>bison 语法分析器</li><li>flex 词法分析器</li><li>libssl-dev OpenSSL通用库</li><li>lzop LZO压缩库的压缩软件</li></ul><p>3.一键编译内核</p><pre class="line-numbers language-none"><code class="language-none">sudo .&#x2F;make_deb.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>如果在电脑上编译不成功且无法解决，可以选择在开发板上编译，代价就是。。。嗯 it takes a long time</p></blockquote><p>4.获取编译出来的内核相关文件</p><pre class="line-numbers language-none"><code class="language-none">YOURPATH&#x2F;ebf_linux_kernel_6ull_depth1&#x2F;build_image&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="内核模块头文件"><a class="markdownIt-Anchor" href="#内核模块头文件"></a> 内核模块头文件</h3><ul><li><code>#include &lt;linux/module.h&gt;</code>：包含内核模块信息声明的相关函数</li><li><code>#include &lt;linux/init.h&gt;</code>：包含了 module_init()和 module_exit()函数的声明</li><li><code>#include &lt;linux/kernel.h&gt;</code>：包含内核提供的各种函数，如printk</li></ul><h3 id="内核模块打印函数"><a class="markdownIt-Anchor" href="#内核模块打印函数"></a> 内核模块打印函数</h3><ul><li><p><code>printf</code>：glibc实现的打印函数，工作于用户空间，不可在内核使用</p></li><li><p><code>printk</code>：内核模块无法使用glibc库函数，内核自身实现的一个类printf函数，但是需要指定打印等级。</p><ul><li><code>#define KERN_EMERG</code> “&lt;0&gt;” 通常是系统崩溃前的信息</li><li><code>#define KERN_ALERT</code>          “&lt;1&gt;” 需要立即处理的消息</li><li><code>#define KERN_CRIT</code>             “&lt;2&gt;” 严重情况</li><li><code>#define KERN_ERR</code>              “&lt;3&gt;” 错误情况</li><li><code>#define KERN_WARNING</code>      “&lt;4&gt;” 有问题的情况</li><li><code>#define KERN_NOTICE</code>       “&lt;5&gt;” 注意信息</li><li><code>#define KERN_INFO</code>            “&lt;6&gt;” 普通消息</li><li><code>#define KERN_DEBUG</code>        “&lt;7&gt;” 调试信息</li></ul></li></ul><p>查看当前系统printk打印等级：<code>cat /proc/sys/kernel/printk</code><br />输出</p><pre class="line-numbers language-none"><code class="language-none">7       4       1       7<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>表示：</p><ul><li>当前控制台日志级别</li><li>默认消息日志级别</li><li>最小的控制台级别</li><li>默认控制台日志级别</li></ul><p>小于等于设定打印等级的消息不会被打印。<br />打印内核所有打印信息：dmesg</p><ul><li>内核log缓冲区大小有限制，缓冲区数据可能被冲掉</li></ul><h3 id="源码展示"><a class="markdownIt-Anchor" href="#源码展示"></a> 源码展示</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;linux/kernel.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;linux/init.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;linux/module.h></span></span><span class="token keyword">static</span> <span class="token keyword">int</span> __init <span class="token function">hello_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">printk</span><span class="token punctuation">(</span>KERN_EMERG<span class="token string">"[KERN_EMERG]Hello Kernel!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printk</span><span class="token punctuation">(</span><span class="token string">"[DEFAULT]Hello Kernel!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">static</span> <span class="token keyword">void</span> __exit <span class="token function">hello_exit</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">printk</span><span class="token punctuation">(</span><span class="token string">"[DEFAULT]Goodbye Kernel!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">module_init</span><span class="token punctuation">(</span>hello_init<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">module_exit</span><span class="token punctuation">(</span>hello_exit<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MODULE_LICENSE</span><span class="token punctuation">(</span><span class="token string">"MIT"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MODULE_AUTHOR</span><span class="token punctuation">(</span><span class="token string">"gdm"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MODULE_DESCRIPTION</span><span class="token punctuation">(</span><span class="token string">"print: hello kernel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MODULE_ALIAS</span><span class="token punctuation">(</span><span class="token string">"test_module"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="makefile分析"><a class="markdownIt-Anchor" href="#makefile分析"></a> Makefile分析</h3><pre class="line-numbers language-makefile" data-language="makefile"><code class="language-makefile"><span class="token comment"># 定义内核路径</span>KERNEL_DIR<span class="token operator">:=</span>/home/debian/linux/driver_learning/ebf_linux_kernel_6ull_depth1/build_image/build<span class="token comment"># 定义编译工具集</span>ARCH<span class="token operator">:=</span>armCROSS_COMPILE<span class="token operator">:=</span>arm-linux-gnueabihf-<span class="token comment"># 将变量导出，相当于作为环境变量，让内核Makefile继承此变量 否则变量只在当前文件可见。</span><span class="token keyword">export</span> ARCH CROSS_COMPILE<span class="token comment"># 内核模块编译的标准变量，告诉内核编译哪个模块。</span>obj-m<span class="token operator">:=</span>hellokernal.o<span class="token comment"># -C 命令指切换到目标目录的makefile</span><span class="token comment"># M= 可以理解为module，指定模块所在路径</span><span class="token comment"># modules 是内核makefile定义的目标，触发“构建外部模块”完整规则</span><span class="token target symbol">all</span><span class="token punctuation">:</span>    <span class="token variable">$</span><span class="token punctuation">(</span>MAKE<span class="token punctuation">)</span> -C <span class="token variable">$</span><span class="token punctuation">(</span>KERNEL_DIR<span class="token punctuation">)</span> M<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">(</span>CURDIR<span class="token punctuation">)</span> moudules<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span>clean<span class="token target symbol">clean</span><span class="token punctuation">:</span>    <span class="token variable">$</span><span class="token punctuation">(</span>MAKE<span class="token punctuation">)</span> -C <span class="token variable">$</span><span class="token punctuation">(</span>KERNEL_DIR<span class="token punctuation">)</span> M<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">(</span>CURDIR<span class="token punctuation">)</span> clean<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>KERNEL_DIR</code>：指向linux内核具体路径</li><li><code>export</code>：导出变量给子Makefile使用</li><li><code>obj-m</code> := &lt;模块名&gt;.o：定义要生成的模块</li><li><code>$(MAKE)</code>：Makefile的默认变量，值为make</li><li><code>选项”-C”</code>：让make工具跳转到linux内核目录下读取顶层Makefile</li><li><code>M=</code>：表示内核模块源码目录</li><li><code>$(CURDIR)</code>：Makefile默认变量，值为当前目录所在路径</li><li><code>make modules</code>：执行Linux顶层Makefile的伪目标，它实现内核模块的源码读取并编译为.ko文件</li></ul><h3 id="编译内核模块"><a class="markdownIt-Anchor" href="#编译内核模块"></a> 编译内核模块</h3><pre class="line-numbers language-none"><code class="language-none">make<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="开发板加载内核模块"><a class="markdownIt-Anchor" href="#开发板加载内核模块"></a> 开发板加载内核模块</h3><pre class="line-numbers language-none"><code class="language-none">insmod xxx.ko<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;details&gt;
&lt;summary&gt;版权信息&lt;/summary&gt;
&lt;div class=&quot;admonition warning&quot;&gt;&lt;p class=&quot;admonition-title&quot;&gt;warning&lt;/p&gt;&lt;p&gt;本文章为博主原创文章。遵循 &lt;a href=&quot;https://c</summary>
      
    
    
    
    <category term="Linux" scheme="https://blog.godmao.top/categories/Linux/"/>
    
    <category term="内核编程" scheme="https://blog.godmao.top/categories/Linux/%E5%86%85%E6%A0%B8%E7%BC%96%E7%A8%8B/"/>
    
    
    <category term="内核" scheme="https://blog.godmao.top/Tags/%E5%86%85%E6%A0%B8/"/>
    
    <category term="内核编程" scheme="https://blog.godmao.top/Tags/%E5%86%85%E6%A0%B8%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>WSL-Archlinux安装后应该做什么？</title>
    <link href="https://blog.godmao.top/posts/17327/"/>
    <id>https://blog.godmao.top/posts/17327/</id>
    <published>2025-09-18T12:21:15.000Z</published>
    <updated>2025-09-29T14:42:37.877Z</updated>
    
    <content type="html"><![CDATA[<details><summary>版权信息</summary><div class="admonition warning"><p class="admonition-title">warning</p><p>本文章为博主原创文章。遵循 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh-hans">CC 4.0 BY-SA</a> 版权协议，转载请附上原文出处链接和本声明。</p></div></details><hr /><ul><li><a href="#1-%E5%9C%A8wsl%E4%B8%8A%E5%AE%89%E8%A3%85archlinux">1. 在WSL上安装Archlinux</a></li><li><a href="#2-%E6%9B%B4%E6%96%B0%E7%B3%BB%E7%BB%9F">2. 更新系统</a></li><li><a href="#3-%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE">3. 基础配置</a><ul><li><a href="#31-%E8%AE%BE%E7%BD%AEroot%E5%AF%86%E7%A0%81">3.1. 设置root密码</a></li><li><a href="#32-%E5%88%9B%E5%BB%BA%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7%E5%B9%B6%E5%8A%A0%E5%85%A5-wheel-%E7%BB%84%E6%96%B9%E4%BE%BF%E5%90%8E%E7%BB%AD-sudo-%E6%9D%83%E9%99%90">3.2. 创建普通用户并加入 <code>wheel</code> 组（方便后续 sudo 权限）：</a></li><li><a href="#33-%E7%BC%96%E8%BE%91-sudo-%E6%9D%83%E9%99%90">3.3. 编辑 sudo 权限</a></li><li><a href="#34-%E8%AE%BE%E5%AE%9A%E9%BB%98%E8%AE%A4%E7%94%A8%E6%88%B7">3.4. 设定默认用户</a></li><li><a href="#35-%E8%AE%BE%E7%BD%AE%E8%AF%AD%E8%A8%80%E5%92%8C%E5%9C%B0%E5%8C%BA">3.5. 设置语言和地区</a></li><li><a href="#36-aur-%E6%94%AF%E6%8C%81">3.6. AUR 支持</a></li><li><a href="#37-%E5%85%B3%E4%BA%8E%E6%8D%A2%E6%BA%90">3.7. 关于换源</a></li></ul></li><li><a href="#4-%E4%B8%AA%E6%80%A7%E5%8C%96%E8%AE%BE%E7%BD%AE">4. 个性化设置</a><ul><li><a href="#41-%E4%BD%BF%E7%94%A8zsh%E6%9B%BF%E4%BB%A3bash">4.1. 使用zsh替代bash</a></li><li><a href="#42-%E4%BD%BF%E7%94%A8oh-my-zsh%E4%B8%BAzsh%E6%8F%90%E4%BE%9B%E6%8F%92%E4%BB%B6%E6%9C%8D%E5%8A%A1">4.2. 使用oh-my-zsh为zsh提供插件服务</a></li><li><a href="#43-%E4%BD%BF%E7%94%A8oh-my-posh%E4%B8%BAzsh%E6%8F%90%E4%BE%9B%E4%B8%BB%E9%A2%98">4.3. 使用oh-my-posh为zsh提供主题</a></li></ul></li></ul><h2 id="1-在wsl上安装archlinux"><a class="markdownIt-Anchor" href="#1-在wsl上安装archlinux"></a> 1. 在WSL上安装Archlinux</h2><p>请参见—— <a href="https://wiki.archlinuxcn.org/wiki/%E5%9C%A8_WSL_%E4%B8%8A%E5%AE%89%E8%A3%85_Arch_Linux">在 WSL 上安装 Arch Linux - Arch Linux 中文维基</a></p><h2 id="2-更新系统"><a class="markdownIt-Anchor" href="#2-更新系统"></a> 2. 更新系统</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> pacman <span class="token parameter variable">-Syu</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="3-基础配置"><a class="markdownIt-Anchor" href="#3-基础配置"></a> 3. 基础配置</h2><h3 id="31-设置root密码"><a class="markdownIt-Anchor" href="#31-设置root密码"></a> 3.1. 设置root密码</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">passwd</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="32-创建普通用户并加入-wheel-组方便后续-sudo-权限"><a class="markdownIt-Anchor" href="#32-创建普通用户并加入-wheel-组方便后续-sudo-权限"></a> 3.2. 创建普通用户并加入 <code>wheel</code> 组（方便后续 sudo 权限）：</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">useradd</span> <span class="token parameter variable">-m</span> <span class="token parameter variable">-G</span> wheel <span class="token parameter variable">-s</span> /bin/bash yourname<span class="token function">passwd</span> yourname<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><code>-m</code>：自动创建用户目录<br /><code>-G</code>：指定用户组<br /><code>-s</code>：指定shell</p><h3 id="33-编辑-sudo-权限"><a class="markdownIt-Anchor" href="#33-编辑-sudo-权限"></a> 3.3. 编辑 sudo 权限</h3><p>安装 <code>sudo</code>，再启用 <code>wheel</code> 组：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pacman <span class="token parameter variable">-S</span> <span class="token function">sudo</span> <span class="token function">nano</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">nano</span> /etc/sudoers<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>去掉 <code># %wheel ALL=(ALL:ALL) ALL</code> 前的注释</p><blockquote><p>前面带%(如%wheel)则表示这是一个用户组，不带则表示这是一个用户。</p></blockquote><h3 id="34-设定默认用户"><a class="markdownIt-Anchor" href="#34-设定默认用户"></a> 3.4. 设定默认用户</h3><p>不能总是用root用户登录。<br />首先确保该用户已被创建，然后将以下行添加到 <code>/etc/wsl.conf</code>：</p><pre class="line-numbers language-none"><code class="language-none">[user]default&#x3D;username<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="35-设置语言和地区"><a class="markdownIt-Anchor" href="#35-设置语言和地区"></a> 3.5. 设置语言和地区</h3><p>目的是正确显示中文字符</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">locale-gen<span class="token builtin class-name">echo</span> <span class="token string">"LANG=en_US.UTF-8"</span> <span class="token operator">></span> /etc/locale.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>请参见——<a href="https://wiki.archlinuxcn.org/wiki/%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87%E6%9C%AC%E5%9C%B0%E5%8C%96">简体中文本地化 - Arch Linux 中文维基</a></p><h3 id="36-aur-支持"><a class="markdownIt-Anchor" href="#36-aur-支持"></a> 3.6. AUR 支持</h3><p>可以下载来自社区的软件包，这里选用AUR助手 yay<br />选择一个指定目录然后执行：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pacman <span class="token parameter variable">-S</span> <span class="token function">git</span> base-devel <span class="token parameter variable">--needed</span>  <span class="token comment">#&lt;-这是基本的开发工具包，如gcc、make</span><span class="token function">git</span> clone https://aur.archlinux.org/yay-bin.git<span class="token builtin class-name">cd</span> yay-binmakepkg <span class="token parameter variable">-si</span> <span class="token comment"># 构建包</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><code>-s</code>：自动安装依赖<br /><code>-i</code>：编译完成后自动安装生成的包</p><p>请参见——<a href="https://wiki.archlinuxcn.org/wiki/Yay">yay - Arch Linux 中文维基</a></p><h3 id="37-关于换源"><a class="markdownIt-Anchor" href="#37-关于换源"></a> 3.7. 关于换源</h3><p>打开<code>WSL-setting</code>（直接在win11里搜索）的网络设置，将网络模式由<code>NAT</code> 改为 <code>mirror</code>， 则可直接继承宿主机的网络环境。在宿主机使用网络安全工具即可，因此暂时没有换源。</p><h2 id="4-个性化设置"><a class="markdownIt-Anchor" href="#4-个性化设置"></a> 4. 个性化设置</h2><h3 id="41-使用zsh替代bash"><a class="markdownIt-Anchor" href="#41-使用zsh替代bash"></a> 4.1. 使用zsh替代bash</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> pacman <span class="token parameter variable">-S</span> <span class="token function">zsh</span>chsh <span class="token parameter variable">-s</span> /bin/zsh <span class="token comment"># 改变默认shell</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="42-使用oh-my-zsh为zsh提供插件服务"><a class="markdownIt-Anchor" href="#42-使用oh-my-zsh为zsh提供插件服务"></a> 4.2. 使用oh-my-zsh为zsh提供插件服务</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yay <span class="token parameter variable">-S</span> oh-my-zsh.git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>安装完成后 可以在 <code>/usr/share/oh-my-zsh</code> 中查看主题文件和插件以及其提供的<code>zshrc</code>配置模板，直接使用配置模板。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cp</span> /usr/share/oh-my-zsh/zshrc ~/.zshrc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>进入<code>/usr/share/oh-my-zsh\plugins</code>目录 安装自动补全与语法高亮插件（不自带）</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/zsh-users/zsh-autosuggestions<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/zsh-users/zsh-syntax-highlighting.git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在 <code>.zshrc</code> 里添加：</p><pre class="line-numbers language-none"><code class="language-none">plugins&#x3D;(git zsh-autosuggestions zsh-syntax-highlighting)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="43-使用oh-my-posh为zsh提供主题"><a class="markdownIt-Anchor" href="#43-使用oh-my-posh为zsh提供主题"></a> 4.3. 使用oh-my-posh为zsh提供主题</h3><p>你也可以使用<code>oh-my-zsh</code>的主题，只不过我更喜欢<code>oh-my-posh</code>的主题</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yay <span class="token parameter variable">-S</span> oh-my-posh-bin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>同样，安装完成后 可以在 <code>/usr/share/oh-my-posh</code> 中查看主题文件，<br />编辑<code>~/.zshrc</code>：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#注释掉ZSH_THEME="robbyrussell"</span><span class="token builtin class-name">eval</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span>oh-my-posh init <span class="token function">zsh</span> <span class="token parameter variable">--config</span> <span class="token string">'amro'</span><span class="token variable">)</span></span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p>建议不要使用类似于 <code>--config ~/.poshthemes/mytheme.omp.json</code>的选项，这可能会出现问题。</p></blockquote><p>重新加载：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">source</span> ~/.zshrc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;details&gt;
&lt;summary&gt;版权信息&lt;/summary&gt;
&lt;div class=&quot;admonition warning&quot;&gt;&lt;p class=&quot;admonition-title&quot;&gt;warning&lt;/p&gt;&lt;p&gt;本文章为博主原创文章。遵循 &lt;a href=&quot;https://c</summary>
      
    
    
    
    <category term="Linux" scheme="https://blog.godmao.top/categories/Linux/"/>
    
    <category term="记录" scheme="https://blog.godmao.top/categories/Linux/%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="WSL2" scheme="https://blog.godmao.top/Tags/WSL2/"/>
    
    <category term="ArchLinux" scheme="https://blog.godmao.top/Tags/ArchLinux/"/>
    
  </entry>
  
</feed>
